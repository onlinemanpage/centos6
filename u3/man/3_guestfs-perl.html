<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Fri Nov 18 04:21:50 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>guestfs-perl(3) Virtualization Support
guestfs-perl(3)</p>

<p>NAME guestfs-perl - How to use libguestfs from Perl</p>

<p>SYNOPSIS use Sys::Guestfs;</p>

<p>my $h = Sys::Guestfs-&gt;new (); $h-&gt;add_drive_opts
(&rsquo;guest.img&rsquo;, format =&gt; &rsquo;raw&rsquo;);
$h-&gt;launch (); $h-&gt;mount_options (&rsquo;&rsquo;,
&rsquo;/dev/sda1&rsquo;, &rsquo;/&rsquo;); $h-&gt;touch
(&rsquo;/hello&rsquo;); $h-&gt;sync ();</p>

<p>DESCRIPTION This manual page documents how to call
libguestfs from the Perl programming language. This page
just documents the differences from the C API and gives some
examples. If you are not familiar with using libguestfs, you
also need to read guestfs(3). To read the full Perl API, see
Sys::Guestfs(3).</p>

<p>ERRORS Errors from libguestfs functions turn into calls
to &quot;croak&quot; (see Carp(3)).</p>

<p>EXAMPLE 1: CREATE A DISK IMAGE #!/usr/bin/perl -w</p>

<p># Example showing how to create a disk image.</p>

<p>use strict; use Sys::Guestfs;</p>

<p>my $output = &quot;disk.img&quot;;</p>

<p>my $g = new Sys::Guestfs ();</p>

<p># Create a raw-format sparse disk image, 512 MB in size.
open FILE, &quot;&gt;$output&quot; or die &quot;$output:
$!&quot;; truncate FILE, 512 * 1024 * 1024 or die
&quot;$output: truncate: $!&quot;; close FILE or die
&quot;$output: $!&quot;;</p>

<p># Set the trace flag so that we can see each libguestfs
call. $g-&gt;set_trace (1);</p>

<p># Set the autosync flag so that the disk will be
synchronized # automatically when the libguestfs handle is
closed. $g-&gt;set_autosync (1);</p>

<p># Attach the disk image to libguestfs.
$g-&gt;add_drive_opts ($output, format =&gt;
&quot;raw&quot;, readonly =&gt; 0);</p>

<p># Run the libguestfs back-end. $g-&gt;launch ();</p>

<p># Get the list of devices. Because we only added one
drive # above, we expect that this list should contain a
single # element. my @devices = $g-&gt;list_devices (); if
(@devices != 1) { die &quot;error: expected a single device
from list-devices&quot;; }</p>

<p># Partition the disk as one single MBR partition.
$g-&gt;part_disk ($devices[0], &quot;mbr&quot;);</p>

<p># Get the list of partitions. We expect a single
element, which # is the partition we have just created. my
@partitions = $g-&gt;list_partitions (); if (@partitions !=
1) { die &quot;error: expected a single partition from
list-partitions&quot;; }</p>

<p># Create a filesystem on the partition. $g-&gt;mkfs
(&quot;ext4&quot;, $partitions[0]);</p>

<p># Now mount the filesystem so that we can add files.
$g-&gt;mount_options (&quot;&quot;, $partitions[0],
&quot;/&quot;);</p>

<p># Create some files and directories. $g-&gt;touch
(&quot;/empty&quot;); my $message = &quot;Hello, world0;
$g-&gt;write (&quot;/hello&quot;, $message); $g-&gt;mkdir
(&quot;/foo&quot;);</p>

<p># This one uploads the local file /etc/resolv.conf into
# the disk image. $g-&gt;upload
(&quot;/etc/resolv.conf&quot;,
&quot;/foo/resolv.conf&quot;);</p>

<p># Because &rsquo;autosync&rsquo; was set (above) we can
just exit here # and the disk contents will be synchronized.
You can also do # this manually by calling $g-&gt;umount_all
and $g-&gt;sync. exit 0</p>

<p>EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE
#!/usr/bin/perl -w</p>

<p># Example showing how to inspect a virtual machine
disk.</p>

<p>use strict; use Sys::Guestfs;</p>

<p>if (@ARGV &lt; 1) { die &quot;usage: inspect_vm
disk.img&quot; }</p>

<p>my $disk = $ARGV[0];</p>

<p>my $g = new Sys::Guestfs ();</p>

<p># Attach the disk image read-only to libguestfs. # You
could also add an optional format =&gt; ... argument here.
This is # advisable since automatic format detection is
insecure. $g-&gt;add_drive_opts ($disk, readonly =&gt;
1);</p>

<p># Run the libguestfs back-end. $g-&gt;launch ();</p>

<p># Ask libguestfs to inspect for operating systems. my
@roots = $g-&gt;inspect_os (); if (@roots == 0) { die
&quot;inspect_vm: no operating systems found&quot;; }</p>

<p>for my $root (@roots) { printf &quot;Root device: %s0,
$root;</p>

<p># Print basic information about the operating system.
printf &quot; Product name: %s0,
$g-&gt;inspect_get_product_name ($root); printf &quot;
Version: %d.%d0, $g-&gt;inspect_get_major_version ($root),
$g-&gt;inspect_get_minor_version ($root); printf &quot;
Type: %s0, $g-&gt;inspect_get_type ($root); printf &quot;
Distro: %s0, $g-&gt;inspect_get_distro ($root);</p>

<p># Mount up the disks, like guestfish -i. # # Sort keys
by length, shortest first, so that we end up # mounting the
filesystems in the correct order. my %mps =
$g-&gt;inspect_get_mountpoints ($root); my @mps = sort {
length $a &lt;=&gt; length $b } (keys %mps); for my $mp
(@mps) { eval { $g-&gt;mount_ro ($mps{$mp}, $mp) }; if ($@)
{ print &quot;$@ (ignored)0 } }</p>

<p># If /etc/issue.net file exists, print up to 3 lines. my
$filename = &quot;/etc/issue.net&quot;; if ($g-&gt;is_file
($filename)) { printf &quot;--- %s ---0, $filename; my
@lines = $g-&gt;head_n (3, $filename); print &quot;$_0
foreach @lines; }</p>

<p># Unmount everything. $g-&gt;umount_all () }</p>

<p>SEE ALSO Sys::Guestfs(3), guestfs(3),
guestfs-examples(3), guestfs-erlang(3), guestfs-java(3),
guestfs-ocaml(3), guestfs-python(3), guestfs-recipes(1),
guestfs-ruby(3), &lt;http://libguestfs.org/&gt;.</p>

<p>AUTHORS Richard W.M. Jones (&quot;rjones at redhat dot
com&quot;)</p>

<p>COPYRIGHT Copyright (C) 2011 Red Hat Inc.
&lt;http://libguestfs.org/&gt;</p>

<p>The examples in this manual page may be freely copied,
modified and distributed without any restrictions.</p>

<p>This library is free software; you can redistribute it
and/or modify it under the terms of the GNU Lesser General
Public License as published by the Free Software Foundation;
either version 2 of the License, or (at your option) any
later version.</p>

<p>This library is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU Lesser General Public License for more
details.</p>

<p>You should have received a copy of the GNU Lesser
General Public License along with this library; if not,
write to the Free Software Foundation, Inc., 51 Franklin
Street, Fifth Floor, Boston, MA 02110-1301 USA</p>

<p>libguestfs-1.16.19 2012-04-18 guestfs-perl(3)</p>
<hr>
</body>
</html>
