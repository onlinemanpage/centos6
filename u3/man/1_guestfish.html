<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Fri Nov 18 04:21:49 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>guestfish(1) Virtualization Support guestfish(1)</p>

<p>NAME guestfish - the libguestfs Filesystem Interactive
SHell</p>

<p>SYNOPSIS guestfish [--options] [commands]</p>

<p>guestfish</p>

<p>guestfish [--ro|--rw] -a disk.img</p>

<p>guestfish [--ro|--rw] -a disk.img -m
dev[:mountpoint]</p>

<p>guestfish -d libvirt-domain</p>

<p>guestfish [--ro|--rw] -a disk.img -i</p>

<p>guestfish -d libvirt-domain -i</p>

<p>WARNING Using guestfish in read/write mode on live
virtual machines can be dangerous, potentially causing disk
corruption. Use the --ro (read- only) option to use
guestfish safely if the disk image or virtual machine might
be live.</p>

<p>DESCRIPTION Guestfish is a shell and command-line tool
for examining and modifying virtual machine filesystems. It
uses libguestfs and exposes all of the functionality of the
guestfs API, see guestfs(3).</p>

<p>Guestfish gives you structured access to the libguestfs
API, from shell scripts or the command line or
interactively. If you want to rescue a broken virtual
machine image, you should look at the virt-rescue(1)
command.</p>

<p>EXAMPLES As an interactive shell $ guestfish</p>

<p>Welcome to guestfish, the libguestfs filesystem
interactive shell for editing virtual machine
filesystems.</p>

<p>Type: &rsquo;help&rsquo; for a list of commands
&rsquo;man&rsquo; to read the manual &rsquo;quit&rsquo; to
quit the shell</p>

<p>&gt;&lt;fs&gt; add-ro disk.img &gt;&lt;fs&gt; run
&gt;&lt;fs&gt; list-filesystems /dev/sda1: ext4
/dev/vg_guest/lv_root: ext4 /dev/vg_guest/lv_swap: swap
&gt;&lt;fs&gt; mount /dev/vg_guest/lv_root / &gt;&lt;fs&gt;
cat /etc/fstab # /etc/fstab # Created by anaconda [...]
&gt;&lt;fs&gt; exit</p>

<p>From shell scripts Create a new &quot;/etc/motd&quot;
file in a guest or disk image:</p>

<p>guestfish &lt;&lt;_EOF_ add disk.img run mount
/dev/vg_guest/lv_root / write /etc/motd &quot;Welcome, new
users&quot; _EOF_</p>

<p>List the LVM logical volumes in a disk image:</p>

<p>guestfish -a disk.img --ro &lt;&lt;_EOF_ run lvs
_EOF_</p>

<p>List all the filesystems in a disk image:</p>

<p>guestfish -a disk.img --ro &lt;&lt;_EOF_ run
list-filesystems _EOF_</p>

<p>On one command line Update &quot;/etc/resolv.conf&quot;
in a guest:</p>

<p>guestfish add disk.img : run : mount
/dev/vg_guest/lv_root / : write /etc/resolv.conf
&quot;nameserver 1.2.3.4&quot;</p>

<p>Edit &quot;/boot/grub/grub.conf&quot; interactively:</p>

<p>guestfish --rw --add disk.img --mount
/dev/vg_guest/lv_root --mount /dev/sda1:/boot edit
/boot/grub/grub.conf</p>

<p>Mount disks automatically Use the -i option to
automatically mount the disks from a virtual machine:</p>

<p>guestfish --ro -a disk.img -i cat /etc/group</p>

<p>guestfish --ro -d libvirt-domain -i cat /etc/group</p>

<p>Another way to edit &quot;/boot/grub/grub.conf&quot;
interactively is:</p>

<p>guestfish --rw -a disk.img -i edit
/boot/grub/grub.conf</p>

<p>As a script interpreter Create a 100MB disk containing
an ext2-formatted partition:</p>

<p>#!/usr/bin/guestfish -f sparse test1.img 100M run
part-disk /dev/sda mbr mkfs ext2 /dev/sda1</p>

<p>Start with a prepared disk An alternate way to create a
100MB disk called &quot;test1.img&quot; containing a single
ext2-formatted partition:</p>

<p>guestfish -N fs</p>

<p>To list what is available do:</p>

<p>guestfish -N help | less</p>

<p>Remote control eval &quot;&lsquo;guestfish
--listen&lsquo;&quot; guestfish --remote add-ro disk.img
guestfish --remote run guestfish --remote lvs</p>

<p>OPTIONS --help Displays general help on options.</p>

<p>-h --cmd-help Lists all available guestfish
commands.</p>

<p>-h cmd --cmd-help cmd Displays detailed help on a single
command &quot;cmd&quot;.</p>

<p>-a image --add image Add a block device or virtual
machine image to the shell.</p>

<p>The format of the disk image is auto-detected. To
override this and force a particular format use the
--format=.. option.</p>

<p>Using this flag is mostly equivalent to using the
&quot;add&quot; command, with &quot;readonly:true&quot; if
the --ro flag was given, and with &quot;format:...&quot; if
the --format=... flag was given.</p>

<p>-c URI --connect URI When used in conjunction with the
-d option, this specifies the libvirt URI to use. The
default is to use the default libvirt connection.</p>

<p>--csh If using the --listen option and a csh-like shell,
use this option. See section &quot;REMOTE CONTROL AND
CSH&quot; below.</p>

<p>-d libvirt-domain --domain libvirt-domain Add disks from
the named libvirt domain. If the --ro option is also used,
then any libvirt domain can be used. However in write mode,
only libvirt domains which are shut down can be named
here.</p>

<p>Domain UUIDs can be used instead of names.</p>

<p>Using this flag is mostly equivalent to using the
&quot;add-domain&quot; command, with
&quot;readonly:true&quot; if the --ro flag was given, and
with &quot;format:...&quot; if the --format=... flag was
given.</p>

<p>-D --no-dest-paths Dont tab-complete paths on the guest
filesystem. It is useful to be able to hit the tab key to
complete paths on the guest filesystem, but this causes
extra &quot;hidden&quot; guestfs calls to be made, so this
option is here to allow this feature to be disabled.</p>

<p>--echo-keys When prompting for keys and passphrases,
guestfish normally turns echoing off so you cannot see what
you are typing. If you are not worried about Tempest attacks
and there is no one else in the room you can specify this
flag to see what you are typing.</p>

<p>-f file --file file Read commands from &quot;file&quot;.
To write pure guestfish scripts, use:</p>

<p>#!/usr/bin/guestfish -f</p>

<p>--format=raw|qcow2|.. --format The default for the -a
option is to auto-detect the format of the disk image. Using
this forces the disk format for -a options which follow on
the command line. Using --format with no argument switches
back to auto-detection for subsequent -a options.</p>

<p>For example:</p>

<p>guestfish --format=raw -a disk.img</p>

<p>forces raw format (no auto-detection) for
&quot;disk.img&quot;.</p>

<p>guestfish --format=raw -a disk.img --format -a
another.img</p>

<p>forces raw format (no auto-detection) for
&quot;disk.img&quot; and reverts to auto-detection for
&quot;another.img&quot;.</p>

<p>If you have untrusted raw-format guest disk images, you
should use this option to specify the disk format. This
avoids a possible security problem with malicious guests
(CVE-2010-3851). See also &quot;add-drive-opts&quot;.</p>

<p>-i --inspector Using virt-inspector(1) code, inspect the
disks looking for an operating system and mount filesystems
as they would be mounted on the real virtual machine.</p>

<p>Typical usage is either:</p>

<p>guestfish -d myguest -i</p>

<p>(for an inactive libvirt domain called myguest), or:</p>

<p>guestfish --ro -d myguest -i</p>

<p>(for active domains, readonly), or specify the block
device directly:</p>

<p>guestfish --rw -a /dev/Guests/MyGuest -i</p>

<p>Note that the command line syntax changed slightly over
older versions of guestfish. You can still use the old
syntax:</p>

<p>guestfish [--ro] -i disk.img</p>

<p>guestfish [--ro] -i libvirt-domain</p>

<p>Using this flag is mostly equivalent to using the
&quot;inspect-os&quot; command and then using other commands
to mount the filesystems that were found.</p>

<p>--keys-from-stdin Read key or passphrase parameters from
stdin. The default is to try to read passphrases from the
user by opening &quot;/dev/tty&quot;.</p>

<p>--listen Fork into the background and listen for remote
commands. See section &quot;REMOTE CONTROL GUESTFISH OVER A
SOCKET&quot; below.</p>

<p>--live Connect to a live virtual machine. (Experimental,
see &quot;ATTACHING TO RUNNING DAEMONS&quot; in
guestfs(3)).</p>

<p>-m dev[:mountpoint[:options]] --mount
dev[:mountpoint[:options]] Mount the named partition or
logical volume on the given mountpoint.</p>

<p>If the mountpoint is omitted, it defaults to
&quot;/&quot;.</p>

<p>You have to mount something on &quot;/&quot; before most
commands will work.</p>

<p>If any -m or --mount options are given, the guest is
automatically launched.</p>

<p>If you don t know what filesystems a disk image
contains, you can either run guestfish without this option,
then list the partitions, filesystems and LVs available (see
&quot;list-partitions&quot;, &quot;list- filesystems&quot;
and &quot;lvs&quot; commands), or you can use the
virt-filesystems(1) program.</p>

<p>The third (and rarely used) part of the mount parameter
is the list of mount options used to mount the underlying
filesystem. If this is not given, then the mount options are
either the empty string or &quot;ro&quot; (the latter if the
--ro flag is used). By specifying the mount options, you
override this default choice. Probably the only time you
would use this is to enable ACLs and/or extended attributes
if the filesystem can support them:</p>

<p>-m /dev/sda1:/:acl,user_xattr</p>

<p>Using this flag is equivalent to using the
&quot;mount-options&quot; command.</p>

<p>-n --no-sync Disable autosync. This is enabled by
default. See the discussion of autosync in the guestfs(3)
manpage.</p>

<p>-N type --new type -N help Prepare a fresh disk image
formatted as &quot;type&quot;. This is an alternative to the
-a option: whereas -a adds an existing disk, -N creates a
preformatted disk with a filesystem and adds it. See
&quot;PREPARED DISK IMAGES&quot; below.</p>

<p>--progress-bars Enable progress bars, even when
guestfish is used non- interactively.</p>

<p>Progress bars are enabled by default when guestfish is
used as an interactive shell.</p>

<p>--no-progress-bars Disable progress bars.</p>

<p>--remote[=pid] Send remote commands to $GUESTFISH_PID or
&quot;pid&quot;. See section &quot;REMOTE CONTROL GUESTFISH
OVER A SOCKET&quot; below.</p>

<p>-r --ro This changes the -a, -d and -m options so that
disks are added and mounts are done read-only.</p>

<p>The option must always be used if the disk image or
virtual machine might be running, and is generally
recommended in cases where you dont need write access to the
disk.</p>

<p>Note that prepared disk images created with -N are not
affected by this option. Also commands like &quot;add&quot;
are not affected - you have to specify the
&quot;readonly:true&quot; option explicitly if you need
it.</p>

<p>See also &quot;OPENING DISKS FOR READ AND WRITE&quot;
below.</p>

<p>--selinux Enable SELinux support for the guest. See
&quot;SELINUX&quot; in guestfs(3).</p>

<p>-v --verbose Enable very verbose messages. This is
particularly useful if you find a bug.</p>

<p>-V --version Display the guestfish / libguestfs version
number and exit.</p>

<p>-w --rw This changes the -a, -d and -m options so that
disks are added and mounts are done read-write.</p>

<p>See &quot;OPENING DISKS FOR READ AND WRITE&quot;
below.</p>

<p>-x Echo each command before executing it.</p>

<p>COMMANDS ON COMMAND LINE Any additional (non-option)
arguments are treated as commands to execute.</p>

<p>Commands to execute should be separated by a colon
(&quot;:&quot;), where the colon is a separate parameter.
Thus:</p>

<p>guestfish cmd [args...] : cmd [args...] : cmd [args...]
...</p>

<p>If there are no additional arguments, then we enter a
shell, either an interactive shell with a prompt (if the
input is a terminal) or a non- interactive shell.</p>

<p>In either command line mode or non-interactive shell,
the first command that gives an error causes the whole shell
to exit. In interactive mode (with a prompt) if a command
fails, you can continue to enter commands.</p>

<p>USING launch (OR run) As with guestfs(3), you must first
configure your guest by adding disks, then launch it, then
mount any disks you need, and finally issue
actions/commands. So the general order of the day is:</p>

<p>&middot; add or -a/--add</p>

<p>&middot; launch (aka run)</p>

<p>&middot; mount or -m/--mount</p>

<p>&middot; any other commands</p>

<p>&quot;run&quot; is a synonym for &quot;launch&quot;. You
must &quot;launch&quot; (or &quot;run&quot;) your guest
before mounting or performing any other commands.</p>

<p>The only exception is that if any of the -i, -m,
--mount, -N or --new options were given then &quot;run&quot;
is done automatically, simply because guestfish cant perform
the action you asked for without doing this.</p>

<p>OPENING DISKS FOR READ AND WRITE The guestfish,
guestmount(1) and virt-rescue(1) options --ro and --rw
affect whether the other command line options -a, -c, -d, -i
and -m open disk images read-only or for writing.</p>

<p>In libguestfs 1.10, guestfish, guestmount and
virt-rescue defaulted to opening disk images supplied on the
command line for write. To open a disk image read-only you
have to do -a image --ro.</p>

<p>This matters: If you accidentally open a live VM disk
image writable then you will cause irreversible disk
corruption.</p>

<p>In a future libguestfs we intend to change the default
the other way. Disk images will be opened read-only. You
will have to either specify guestfish --rw, guestmount --rw,
virt-rescue --rw, or change the configuration file
&quot;/etc/libguestfs-tools.conf&quot; in order to get write
access for disk images specified by those other command line
options.</p>

<p>This version of guestfish, guestmount and virt-rescue
has a --rw option which does nothing (it is already the
default). However it is highly recommended that you use this
option to indicate that you need write access, and prepare
your scripts for the day when this option will be required
for write access.</p>

<p>Note: This does not affect commands like &quot;add&quot;
and &quot;mount&quot;, or any other libguestfs program apart
from guestfish and guestmount.</p>

<p>QUOTING You can quote ordinary parameters using either
single or double quotes. For example:</p>

<p>add &quot;file with a space.img&quot;</p>

<p>rm &rsquo;/file name&rsquo;</p>

<p>rm &rsquo;/&quot;&rsquo;</p>

<p>A few commands require a list of strings to be passed.
For these, use a whitespace-separated list, enclosed in
quotes. Strings containing whitespace to be passed through
must be enclosed in single quotes. A literal single quote
must be escaped with a backslash.</p>

<p>vgcreate VG &quot;/dev/sda1 /dev/sdb1&quot; command
&quot;/bin/echo &rsquo;foo bar&rsquo;&quot; command
&quot;/bin/echo &acute;foo&acute;&quot;</p>

<p>ESCAPE SEQUENCES IN DOUBLE QUOTED ARGUMENTS In
double-quoted arguments (only) use backslash to insert
special characters:</p>

<p>&quot;&quot; Alert (bell) character.</p>

<p>&quot; Backspace character.</p>

<p>&quot; Form feed character.</p>

<p>&quot;0 Newline character.</p>

<p>&quot; &quot; Carriage return character.</p>

<p>&quot;&quot; Horizontal tab character.</p>

<p>&quot; Vertical tab character.</p>

<p>&quot; A literal double quote character.</p>

<p>&quot;&quot; A character with octal value ooo. There
must be precisely 3 octal digits (unlike C).</p>

<p>&quot;&quot; A character with hex value hh. There must
be precisely 2 hex digits.</p>

<p>In the current implementation &quot; 00&quot; and
&quot;0&quot; cannot be used in strings.</p>

<p>&quot;\&quot; A literal backslash character.</p>

<p>OPTIONAL ARGUMENTS Some commands take optional
arguments. These arguments appear in this documentation as
&quot;[argname:..]&quot;. You can use them as in these
examples:</p>

<p>add-drive-opts filename</p>

<p>add-drive-opts filename readonly:true</p>

<p>add-drive-opts filename format:qcow2 readonly:false</p>

<p>Each optional argument can appear at most once. All
optional arguments must appear after the required ones.</p>

<p>NUMBERS This section applies to all commands which can
take integers as parameters.</p>

<p>SIZE SUFFIX When the command takes a parameter measured
in bytes, you can use one of the following suffixes to
specify kilobytes, megabytes and larger sizes:</p>

<p>k or K or KiB The size in kilobytes (multiplied by
1024).</p>

<p>KB The size in SI 1000 byte units.</p>

<p>M or MiB The size in megabytes (multiplied by
1048576).</p>

<p>MB The size in SI 1000000 byte units.</p>

<p>G or GiB The size in gigabytes (multiplied by
2**30).</p>

<p>GB The size in SI 10**9 byte units.</p>

<p>T or TiB The size in terabytes (multiplied by
2**40).</p>

<p>TB The size in SI 10**12 byte units.</p>

<p>P or PiB The size in petabytes (multiplied by
2**50).</p>

<p>PB The size in SI 10**15 byte units.</p>

<p>E or EiB The size in exabytes (multiplied by 2**60).</p>

<p>EB The size in SI 10**18 byte units.</p>

<p>Z or ZiB The size in zettabytes (multiplied by
2**70).</p>

<p>ZB The size in SI 10**21 byte units.</p>

<p>Y or YiB The size in yottabytes (multiplied by
2**80).</p>

<p>YB The size in SI 10**24 byte units.</p>

<p>For example:</p>

<p>truncate-size /file 1G</p>

<p>would truncate the file to 1 gigabyte.</p>

<p>Be careful because a few commands take sizes in
kilobytes or megabytes (eg. the parameter to
&quot;memsize&quot; is specified in megabytes already).
Adding a suffix will probably not do what you expect.</p>

<p>OCTAL AND HEXADECIMAL NUMBERS For specifying the radix
(base) use the C convention: 0 to prefix an octal number or
&quot;0x&quot; to prefix a hexadecimal number. For
example:</p>

<p>1234 decimal number 1234 02322 octal number, equivalent
to decimal 1234 0x4d2 hexadecimal number, equivalent to
decimal 1234</p>

<p>When using the &quot;chmod&quot; command, you almost
always want to specify an octal number for the mode, and you
must prefix it with 0 (unlike the Unix chmod(1)
program):</p>

<p>chmod 0777 /public # OK chmod 777 /public # WRONG! This
is mode 777 decimal = 01411 octal.</p>

<p>Commands that return numbers usually print them in
decimal, but some commands print numbers in other radices
(eg. &quot;umask&quot; prints the mode in octal, preceeded
by 0).</p>

<p>WILDCARDS AND GLOBBING Neither guestfish nor the
underlying guestfs API performs wildcard expansion
(globbing) by default. So for example the following will not
do what you expect:</p>

<p>rm-rf /home/*</p>

<p>Assuming you don t have a directory called literally
&quot;/home/*&quot; then the above command will return an
error.</p>

<p>To perform wildcard expansion, use the &quot;glob&quot;
command.</p>

<p>glob rm-rf /home/*</p>

<p>runs &quot;rm-rf&quot; on each path that matches (ie.
potentially running the command many times), equivalent
to:</p>

<p>rm-rf /home/jim rm-rf /home/joe rm-rf /home/mary</p>

<p>&quot;glob&quot; only works on simple guest paths and
not on device names.</p>

<p>If you have several parameters, each containing a
wildcard, then glob will perform a Cartesian product.</p>

<p>COMMENTS Any line which starts with a # character is
treated as a comment and ignored. The # can optionally be
preceeded by whitespace, but not by a command. For
example:</p>

<p># this is a comment # this is a comment foo # NOT a
comment</p>

<p>Blank lines are also ignored.</p>

<p>RUNNING COMMANDS LOCALLY Any line which starts with a !
character is treated as a command sent to the local shell
(&quot;/bin/sh&quot; or whatever system(3) uses). For
example:</p>

<p>!mkdir local tgz-out /remote
local/remote-data.tar.gz</p>

<p>will create a directory &quot;local&quot; on the host,
and then export the contents of &quot;/remote&quot; on the
mounted filesystem to &quot;local/remote-data.tar.gz&quot;.
(See &quot;tgz-out&quot;).</p>

<p>To change the local directory, use the &quot;lcd&quot;
command. &quot;!cd&quot; will have no effect, due to the way
that subprocesses work in Unix.</p>

<p>LOCAL COMMANDS WITH INLINE EXECUTION If a line starts
with &lt;! then the shell command is executed (as for !),
but subsequently any output (stdout) of the shell command is
parsed and executed as guestfish commands.</p>

<p>Thus you can use shell script to construct arbitrary
guestfish commands which are then parsed by guestfish.</p>

<p>For example it is tedious to create a sequence of files
(eg. &quot;/foo.1&quot; through &quot;/foo.100&quot;) using
guestfish commands alone. However this is simple if we use a
shell script to create the guestfish commands for us:</p>

<p>&lt;! for n in &lsquo;seq 1 100&lsquo;; do echo write
/foo.$n $n; done</p>

<p>or with names like &quot;/foo.001&quot;:</p>

<p>&lt;! for n in &lsquo;seq 1 100&lsquo;; do printf
&quot;write /foo.%03d %d0 $n $n; done</p>

<p>When using guestfish interactively it can be helpful to
just run the shell script first (ie. remove the initial
&quot;&lt;&quot; character so it is just an ordinary ! local
command), see what guestfish commands it would run, and when
you are happy with those prepend the &quot;&lt;&quot;
character to run the guestfish commands for real.</p>

<p>PIPES Use &quot;command &lt;space&gt; | command&quot; to
pipe the output of the first command (a guestfish command)
to the second command (any host command). For example:</p>

<p>cat /etc/passwd | awk -F: &rsquo;$3 == 0 { print
}&rsquo;</p>

<p>(where &quot;cat&quot; is the guestfish cat command, but
&quot;awk&quot; is the host awk program). The above command
would list all accounts in the guest filesystem which have
UID 0, ie. root accounts including backdoors. Other
examples:</p>

<p>hexdump /bin/ls | head list-devices | tail -1 tgz-out /
- | tar ztf -</p>

<p>The space before the pipe symbol is required, any space
after the pipe symbol is optional. Everything after the pipe
symbol is just passed straight to the host shell, so it can
contain redirections, globs and anything else that makes
sense on the host side.</p>

<p>To use a literal argument which begins with a pipe
symbol, you have to quote it, eg:</p>

<p>echo &quot;|&quot;</p>

<p>HOME DIRECTORIES If a parameter starts with the
character &quot;~&quot; then the tilde may be expanded as a
home directory path (either &quot;~&quot; for the current
users home directory, or &quot;~user&quot; for another
user).</p>

<p>Note that home directory expansion happens for users
known on the host, not in the guest filesystem.</p>

<p>To use a literal argument which begins with a tilde, you
have to quote it, eg:</p>

<p>echo &quot;~&quot;</p>

<p>ENCRYPTED DISKS Libguestfs has some support for Linux
guests encrypted according to the Linux Unified Key Setup
(LUKS) standard, which includes nearly all whole disk
encryption systems used by modern Linux guests. Currently
only LVM-on-LUKS is supported.</p>

<p>Identify encrypted block devices and partitions using
&quot;vfs-type&quot;:</p>

<p>&gt;&lt;fs&gt; vfs-type /dev/sda2 crypto_LUKS</p>

<p>Then open those devices using &quot;luks-open&quot;.
This creates a device- mapper device called
&quot;/dev/mapper/luksdev&quot;.</p>

<p>&gt;&lt;fs&gt; luks-open /dev/sda2 luksdev Enter key or
passphrase (&quot;key&quot;): &lt;enter the
passphrase&gt;</p>

<p>Finally you have to tell LVM to scan for volume groups
on the newly created mapper device:</p>

<p>vgscan vg-activate-all true</p>

<p>The logical volume(s) can now be mounted in the usual
way.</p>

<p>Before closing a LUKS device you must unmount any
logical volumes on it and deactivate the volume groups by
calling &quot;vg-activate false VG&quot; on each one. Then
you can close the mapper device:</p>

<p>vg-activate false /dev/VG luks-close
/dev/mapper/luksdev</p>

<p>WINDOWS PATHS If a path is prefixed with
&quot;win:&quot; then you can use Windows-style drive
letters and paths (with some limitations). The following
commands are equivalent:</p>

<p>file /WINDOWS/system32/config/system.LOG</p>

<p>file win:312gtem.log</p>

<p>file WIN:C:WindowsTEM32G</p>

<p>The parameter is rewritten &quot;behind the scenes&quot;
by looking up the position where the drive is mounted,
prepending that to the path, changing all backslash
characters to forward slash, then resolving the result using
&quot;case-sensitive-path&quot;. For example if the E: drive
was mounted on &quot;/e&quot; then the parameter might be
rewritten like this:</p>

<p>r = &gt; / e win:e:o/r F O O / b</p>

<p>This only works in argument positions that expect a
path.</p>

<p>UPLOADING AND DOWNLOADING FILES For commands such as
&quot;upload&quot;, &quot;download&quot;,
&quot;tar-in&quot;, &quot;tar-out&quot; and others which
upload from or download to a local file, you can use the
special filename &quot;-&quot; to mean &quot;from
stdin&quot; or &quot;to stdout&quot;. For example:</p>

<p>upload - /foo</p>

<p>reads stdin and creates from that a file
&quot;/foo&quot; in the disk image, and:</p>

<p>tar-out /etc - | tar tf -</p>

<p>writes the tarball to stdout and then pipes that into
the external &quot;tar&quot; command (see
&quot;PIPES&quot;).</p>

<p>When using &quot;-&quot; to read from stdin, the input
is read up to the end of stdin. You can also use a special
&quot;heredoc&quot;-like syntax to read up to some arbitrary
end marker:</p>

<p>upload -&lt;&lt;END /foo input line 1 input line 2 input
line 3 END</p>

<p>Any string of characters can be used instead of
&quot;END&quot;. The end marker must appear on a line of its
own, without any preceeding or following characters (not
even spaces).</p>

<p>Note that the &quot;-&lt;&lt;&quot; syntax only applies
to parameters used to upload local files (so-called
&quot;FileIn&quot; parameters in the generator).</p>

<p>EXIT ON ERROR BEHAVIOUR By default, guestfish will
ignore any errors when in interactive mode (ie. taking
commands from a human over a tty), and will exit on the
first error in non-interactive mode (scripts, commands given
on the command line).</p>

<p>If you prefix a command with a - character, then that
command will not cause guestfish to exit, even if that (one)
command returns an error.</p>

<p>REMOTE CONTROL GUESTFISH OVER A SOCKET Guestfish can be
remote-controlled over a socket. This is useful particularly
in shell scripts where you want to make several different
changes to a filesystem, but you dont want the overhead of
starting up a guestfish process each time.</p>

<p>Start a guestfish server process using:</p>

<p>eval &quot;&lsquo;guestfish --listen&lsquo;&quot;</p>

<p>and then send it commands by doing:</p>

<p>guestfish --remote cmd [...]</p>

<p>To cause the server to exit, send it the exit
command:</p>

<p>guestfish --remote exit</p>

<p>Note that the server will normally exit if there is an
error in a command. You can change this in the usual way.
See section &quot;EXIT ON ERROR BEHAVIOUR&quot;.</p>

<p>CONTROLLING MULTIPLE GUESTFISH PROCESSES The
&quot;eval&quot; statement sets the environment variable
$GUESTFISH_PID, which is how the --remote option knows where
to send the commands. You can have several guestfish
listener processes running using:</p>

<p>eval &quot;&lsquo;guestfish --listen&lsquo;&quot;
pid1=$GUESTFISH_PID eval &quot;&lsquo;guestfish
--listen&lsquo;&quot; pid2=$GUESTFISH_PID ... guestfish
--remote=$pid1 cmd guestfish --remote=$pid2 cmd</p>

<p>REMOTE CONTROL AND CSH When using csh-like shells (csh,
tcsh etc) you have to add the --csh option:</p>

<p>eval &quot;&lsquo;guestfish --listen
--csh&lsquo;&quot;</p>

<p>REMOTE CONTROL DETAILS Remote control happens over a
Unix domain socket called
&quot;/tmp/.guestfish-$UID/socket-$PID&quot;, where $UID is
the effective user ID of the process, and $PID is the
process ID of the server.</p>

<p>Guestfish client and server versions must match
exactly.</p>

<p>USING REMOTE CONTROL ROBUSTLY FROM SHELL SCRIPTS From
Bash, you can use the following code which creates a
guestfish instance, correctly quotes the command line,
handles failure to start, and cleans up guestfish when the
script exits:</p>

<p>#!/bin/bash -</p>

<p>set -e</p>

<p>guestfish[0]=&quot;guestfish&quot;
guestfish[1]=&quot;--listen&quot;
guestfish[2]=&quot;--ro&quot; guestfish[3]=&quot;-a&quot;
guestfish[4]=&quot;disk.img&quot;</p>

<p>GUESTFISH_PID= eval $(&quot;${guestfish[@]}&quot;) if [
-z &quot;$GUESTFISH_PID&quot; ]; then echo &quot;error:
guestfish didn&rsquo;t start up, see error messages
above&quot; exit 1 fi</p>

<p>cleanup_guestfish () { guestfish --remote -- exit
&gt;/dev/null 2&gt;&amp;1 ||: } trap cleanup_guestfish EXIT
ERR</p>

<p>guestfish --remote -- run</p>

<p># ...</p>

<p>REMOTE CONTROL RUN COMMAND HANGING Using the
&quot;run&quot; (or &quot;launch&quot;) command remotely in
a command substitution context hangs, ie. don t do (note the
backquotes):</p>

<p>a=&lsquo;guestfish --remote run&lsquo;</p>

<p>Since the &quot;run&quot; command produces no output on
stdout, this is not useful anyway. For further information
see
&lt;https://bugzilla.redhat.com/show_bug.cgi?id=592910&gt;.</p>

<p>PREPARED DISK IMAGES Use the -N type or --new type
parameter to select one of a set of preformatted disk images
that guestfish can make for you to save typing. This is
particularly useful for testing purposes. This option is
used instead of the -a option, and like -a can appear
multiple times (and can be mixed with -a).</p>

<p>The new disk is called &quot;test1.img&quot; for the
first -N, &quot;test2.img&quot; for the second and so on.
Existing files in the current directory are overwritten.</p>

<p>The type briefly describes how the disk should be sized,
partitioned, how filesystem(s) should be created, and how
content should be added. Optionally the type can be followed
by extra parameters, separated by &quot;:&quot; (colon)
characters. For example, -N fs creates a default 100MB,
sparsely-allocated disk, containing a single partition, with
the partition formatted as ext2. -N fs:ext4:1G is the same,
but for an ext4 filesystem on a 1GB disk instead.</p>

<p>To list the available types and any extra parameters
they take, run:</p>

<p>guestfish -N help | less</p>

<p>Note that the prepared filesystem is not mounted. You
would usually have to use the &quot;mount /dev/sda1 /&quot;
command or add the -m /dev/sda1 option.</p>

<p>If any -N or --new options are given, the guest is
automatically launched.</p>

<p>EXAMPLES Create a 100MB disk with an ext4-formatted
partition:</p>

<p>guestfish -N fs:ext4</p>

<p>Create a 32MB disk with a VFAT-formatted partition, and
mount it:</p>

<p>guestfish -N fs:vfat:32M -m /dev/sda1</p>

<p>Create a blank 200MB disk:</p>

<p>guestfish -N disk:200M</p>

<p>PROGRESS BARS Some (not all) long-running commands send
progress notification messages as they are running.
Guestfish turns these messages into progress bars.</p>

<p>When a command that supports progress bars takes longer
than two seconds to run, and if progress bars are enabled,
then you will see one appearing below the command:</p>

<p>&gt;&lt;fs&gt; copy-size /large-file /another-file 2048M
/ 10% [#####-----------------------------------------]
00:30</p>

<p>The spinner on the left hand side moves round once for
every progress notification received from the backend. This
is a (reasonably) golden assurance that the command is
&quot;doing something&quot; even if the progress bar is not
moving, because the command is able to send the progress
notifications. When the bar reaches 100% and the command
finishes, the spinner disappears.</p>

<p>Progress bars are enabled by default when guestfish is
used interactively. You can enable them even for
non-interactive modes using --progress-bars, and you can
disable them completely using --no-progress-bars.</p>

<p>GUESTFISH COMMANDS The commands in this section are
guestfish convenience commands, in other words, they are not
part of the guestfs(3) API.</p>

<p>help help help cmd</p>

<p>Without any parameter, this provides general help.</p>

<p>With a &quot;cmd&quot; parameter, this displays detailed
help for that command.</p>

<p>quit | exit This exits guestfish. You can also use
&quot;^D&quot; key.</p>

<p>alloc allocate alloc filename size</p>

<p>This creates an empty (zeroed) file of the given size,
and then adds so it can be further examined.</p>

<p>For more advanced image creation, see qemu-img(1)
utility.</p>

<p>Size can be specified using standard suffixes, eg.
&quot;1M&quot;.</p>

<p>To create a sparse file, use &quot;sparse&quot; instead.
To create a prepared disk image, see &quot;PREPARED DISK
IMAGES&quot;.</p>

<p>copy-in copy-in local [local ...] /remotedir</p>

<p>&quot;copy-in&quot; copies local files or directories
recursively into the disk image, placing them in the
directory called &quot;/remotedir&quot; (which must exist).
This guestfish meta-command turns into a sequence of
&quot;tar-in&quot; and other commands as necessary.</p>

<p>Multiple local files and directories can be specified,
but the last parameter must always be a remote directory.
Wildcards cannot be used.</p>

<p>copy-out copy-out remote [remote ...] localdir</p>

<p>&quot;copy-out&quot; copies remote files or directories
recursively out of the disk image, placing them on the host
disk in a local directory called &quot;localdir&quot; (which
must exist). This guestfish meta-command turns into a
sequence of &quot;download&quot;, &quot;tar-out&quot; and
other commands as necessary.</p>

<p>Multiple remote files and directories can be specified,
but the last parameter must always be a local directory. To
download to the current directory, use &quot;.&quot; as
in:</p>

<p>copy-out /home .</p>

<p>Wildcards cannot be used in the ordinary command, but
you can use them with the help of &quot;glob&quot; like
this:</p>

<p>glob copy-out /home/* .</p>

<p>delete-event delete-event name</p>

<p>Delete the event handler which was previously registered
as &quot;name&quot;. If multiple event handlers were
registered with the same name, they are all deleted.</p>

<p>See also the guestfish commands &quot;event&quot; and
&quot;list-events&quot;.</p>

<p>display display filename</p>

<p>Use &quot;display&quot; (a graphical display program) to
display an image file. It downloads the file, and runs
&quot;display&quot; on it.</p>

<p>To use an alternative program, set the
&quot;GUESTFISH_DISPLAY_IMAGE&quot; environment variable.
For example to use the GNOME display program:</p>

<p>export GUESTFISH_DISPLAY_IMAGE=eog</p>

<p>See also display(1).</p>

<p>echo echo [params ...]</p>

<p>This echos the parameters to the terminal.</p>

<p>edit vi emacs edit filename</p>

<p>This is used to edit a file. It downloads the file,
edits it locally using your editor, then uploads the
result.</p>

<p>The editor is $EDITOR. However if you use the alternate
commands &quot;vi&quot; or &quot;emacs&quot; you will get
those corresponding editors.</p>

<p>event event name eventset &quot;shell script
...&quot;</p>

<p>Register a shell script fragment which is executed when
an event is raised. See
&quot;guestfs_set_event_callback&quot; in guestfs(3) for a
discussion of the event API in libguestfs.</p>

<p>The &quot;name&quot; parameter is a name that you give
to this event handler. It can be any string (even the empty
string) and is simply there so you can delete the handler
using the guestfish &quot;delete-event&quot; command.</p>

<p>The &quot;eventset&quot; parameter is a comma-separated
list of one or more events, for example &quot;close&quot; or
&quot;close,trace&quot;. The special value &quot;*&quot;
means all events.</p>

<p>The third and final parameter is the shell script
fragment (or any external command) that is executed when any
of the events in the eventset occurs. It is executed using
&quot;$SHELL -c&quot;, or if $SHELL is not set then
&quot;/bin/sh -c&quot;.</p>

<p>The shell script fragment receives callback parameters
as arguments $1, $2 etc. The actual event that was called is
available in the environment variable $EVENT.</p>

<p>event &quot;&quot; close &quot;echo closed&quot; event
messages appliance,library,trace &quot;echo $@&quot; event
&quot;&quot; progress &quot;echo progress: $3/$4&quot; event
&quot;&quot; * &quot;echo $EVENT $@&quot;</p>

<p>See also the guestfish commands &quot;delete-event&quot;
and &quot;list-events&quot;.</p>

<p>glob glob command args...</p>

<p>Expand wildcards in any paths in the args list, and run
&quot;command&quot; repeatedly on each matching path.</p>

<p>See &quot;WILDCARDS AND GLOBBING&quot;.</p>

<p>hexedit hexedit &lt;filename|device&gt; hexedit
&lt;filename|device&gt; &lt;max&gt; hexedit
&lt;filename|device&gt; &lt;start&gt; &lt;max&gt;</p>

<p>Use a hex editor to edit all or part of a binary file or
block device.</p>

<p>This command works by downloading potentially the whole
file or device, editing it locally, then uploading it. If
the file or device is large, you have to specify which part
you wish to edit by using &quot;max&quot; and/or
&quot;start&quot; &quot;max&quot; parameters.
&quot;start&quot; and &quot;max&quot; are specified in
bytes, with the usual modifiers allowed such as
&quot;1M&quot; (1 megabyte).</p>

<p>For example to edit the first few sectors of a disk you
might do:</p>

<p>hexedit /dev/sda 1M</p>

<p>which would allow you to edit anywhere within the first
megabyte of the disk.</p>

<p>To edit the superblock of an ext2 filesystem on
&quot;/dev/sda1&quot;, do:</p>

<p>hexedit /dev/sda1 0x400 0x400</p>

<p>(assuming the superblock is in the standard
location).</p>

<p>This command requires an external hexeditor program. You
can specify the program to use by setting the
&quot;HEXEDITOR&quot; environment variable. If
&quot;HEXEDITOR&quot; is not set then this prints an
error.</p>

<p>See also &quot;hexdump&quot;.</p>

<p>lcd lcd directory</p>

<p>Change the local directory, ie. the current directory of
guestfish itself.</p>

<p>Note that &quot;!cd&quot; wont do what you might
expect.</p>

<p>list-events list-events</p>

<p>List the event handlers registered using the guestfish
&quot;event&quot; command.</p>

<p>man manual man</p>

<p>Opens the manual page for guestfish.</p>

<p>more less more filename</p>

<p>less filename</p>

<p>This is used to view a file.</p>

<p>The default viewer is $PAGER. However if you use the
alternate command &quot;less&quot; you will get the
&quot;less&quot; command specifically.</p>

<p>reopen reopen</p>

<p>Close and reopen the libguestfs handle. It is not
necessary to use this normally, because the handle is closed
properly when guestfish exits. However this is occasionally
useful for testing.</p>

<p>setenv setenv VAR value</p>

<p>Set the environment variable &quot;VAR&quot; to the
string &quot;value&quot;.</p>

<p>To print the value of an environment variable use a
shell command such as:</p>

<p>!echo $VAR</p>

<p>sparse sparse filename size</p>

<p>This creates an empty sparse file of the given size, and
then adds so it can be further examined.</p>

<p>In all respects it works the same as the
&quot;alloc&quot; command, except that the image file is
allocated sparsely, which means that disk blocks are not
assigned to the file until they are needed. Sparse disk
files only use space when written to, but they are slower
and there is a danger you could run out of real disk space
during a write operation.</p>

<p>For more advanced image creation, see qemu-img(1)
utility.</p>

<p>Size can be specified using standard suffixes, eg.
&quot;1M&quot;.</p>

<p>supported supported</p>

<p>This command returns a list of the optional groups known
to the daemon, and indicates which ones are supported by
this build of the libguestfs appliance.</p>

<p>See also &quot;AVAILABILITY&quot; in guestfs(3).</p>

<p>time time command args...</p>

<p>Run the command as usual, but print the elapsed time
afterwards. This can be useful for benchmarking
operations.</p>

<p>unsetenv unsetenv VAR</p>

<p>Remove &quot;VAR&quot; from the environment.</p>

<p>COMMANDS add-cdrom add-cdrom filename</p>

<p>This function adds a virtual CD-ROM disk image to the
guest.</p>

<p>This is equivalent to the qemu parameter -cdrom
filename.</p>

<p>Notes:</p>

<p>&middot; This call checks for the existence of
&quot;filename&quot;. This stops you from specifying other
types of drive which are supported by qemu such as
&quot;nbd:&quot; and &quot;http:&quot; URLs. To specify
those, use the general &quot;config&quot; call instead.</p>

<p>&middot; If you just want to add an ISO file (often you
use this as an efficient way to transfer large files into
the guest), then you should probably use
&quot;add-drive-ro&quot; instead.</p>

<p>This function is deprecated. In new code, use the
&quot;add_drive_opts&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>add-domain domain add-domain dom [libvirturi:..]
[readonly:true|false] [iface:..] [live:true|false]
[allowuuid:true|false] [readonlydisk:..]</p>

<p>This function adds the disk(s) attached to the named
libvirt domain &quot;dom&quot;. It works by connecting to
libvirt, requesting the domain and domain XML from libvirt,
parsing it for disks, and calling &quot;add-drive-
opts&quot; on each one.</p>

<p>The number of disks added is returned. This operation is
atomic: if an error is returned, then no disks are
added.</p>

<p>This function does some minimal checks to make sure the
libvirt domain is not running (unless &quot;readonly&quot;
is true). In a future version we will try to acquire the
libvirt lock on each disk.</p>

<p>Disks must be accessible locally. This often means that
adding disks from a remote libvirt connection (see
&lt;http://libvirt.org/remote.html&gt;) will fail unless
those disks are accessible via the same device path locally
too.</p>

<p>The optional &quot;libvirturi&quot; parameter sets the
libvirt URI (see &lt;http://libvirt.org/uri.html&gt;). If
this is not set then we connect to the default libvirt URI
(or one set through an environment variable, see the libvirt
documentation for full details).</p>

<p>The optional &quot;live&quot; flag controls whether this
call will try to connect to a running virtual machine
&quot;guestfsd&quot; process if it sees a suitable
&lt;channel&gt; element in the libvirt XML definition. The
default (if the flag is omitted) is never to try. See
&quot;ATTACHING TO RUNNING DAEMONS&quot; in guestfs(3) for
more information.</p>

<p>If the &quot;allowuuid&quot; flag is true (default is
false) then a UUID may be passed instead of the domain name.
The &quot;dom&quot; string is treated as a UUID first and
looked up, and if that lookup fails then we treat
&quot;dom&quot; as a name as usual.</p>

<p>The optional &quot;readonlydisk&quot; parameter controls
what we do for disks which are marked &lt;readonly/&gt; in
the libvirt XML. Possible values are:</p>

<p>readonlydisk = &quot;error&quot; If &quot;readonly&quot;
is false:</p>

<p>The whole call is aborted with an error if any disk with
the &lt;readonly/&gt; flag is found.</p>

<p>If &quot;readonly&quot; is true:</p>

<p>Disks with the &lt;readonly/&gt; flag are added
read-only.</p>

<p>readonlydisk = &quot;read&quot; If &quot;readonly&quot;
is false:</p>

<p>Disks with the &lt;readonly/&gt; flag are added
read-only. Other disks are added read/write.</p>

<p>If &quot;readonly&quot; is true:</p>

<p>Disks with the &lt;readonly/&gt; flag are added
read-only.</p>

<p>readonlydisk = &quot;write&quot; (default) If
&quot;readonly&quot; is false:</p>

<p>Disks with the &lt;readonly/&gt; flag are added
read/write.</p>

<p>If &quot;readonly&quot; is true:</p>

<p>Disks with the &lt;readonly/&gt; flag are added
read-only.</p>

<p>readonlydisk = &quot;ignore&quot; If
&quot;readonly&quot; is true or false:</p>

<p>Disks with the &lt;readonly/&gt; flag are skipped.</p>

<p>The other optional parameters are passed directly
through to &quot;add- drive-opts&quot;.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>add-drive add-drive filename</p>

<p>This function is the equivalent of calling
&quot;add-drive-opts&quot; with no optional parameters, so
the disk is added writable, with the format being detected
automatically.</p>

<p>Automatic detection of the format opens you up to a
potential security hole when dealing with untrusted
raw-format images. See CVE-2010-3851 and RHBZ#642934.
Specifying the format closes this security hole. Therefore
you should think about replacing calls to this function with
calls to &quot;add-drive-opts&quot;, and specifying the
format.</p>

<p>add-drive-opts add add-drive-opts filename
[readonly:true|false] [format:..] [iface:..] [name:..]</p>

<p>This function adds a virtual machine disk image
&quot;filename&quot; to libguestfs. The first time you call
this function, the disk appears as &quot;/dev/sda&quot;, the
second time as &quot;/dev/sdb&quot;, and so on.</p>

<p>You don t necessarily need to be root when using
libguestfs. However you obviously do need sufficient
permissions to access the filename for whatever operations
you want to perform (ie. read access if you just want to
read the image or write access if you want to modify the
image).</p>

<p>This call checks that &quot;filename&quot; exists.</p>

<p>The optional arguments are:</p>

<p>&quot;readonly&quot; If true then the image is treated
as read-only. Writes are still allowed, but they are stored
in a temporary snapshot overlay which is discarded at the
end. The disk that you add is not modified.</p>

<p>&quot;format&quot; This forces the image format. If you
omit this (or use &quot;add-drive&quot; or
&quot;add-drive-ro&quot;) then the format is automatically
detected. Possible formats include &quot;raw&quot; and
&quot;qcow2&quot;.</p>

<p>Automatic detection of the format opens you up to a
potential security hole when dealing with untrusted
raw-format images. See CVE-2010-3851 and RHBZ#642934.
Specifying the format closes this security hole.</p>

<p>&quot;iface&quot; This rarely-used option lets you
emulate the behaviour of the deprecated
&quot;add-drive-with-if&quot; call (q.v.)</p>

<p>&quot;name&quot; The name the drive had in the original
guest, e.g. /dev/sdb. This is used as a hint to the guest
inspection process if it is available.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>add-drive-ro add-ro add-drive-ro filename</p>

<p>This function is the equivalent of calling
&quot;add-drive-opts&quot; with the optional parameter
&quot;GUESTFS_ADD_DRIVE_OPTS_READONLY&quot; set to 1, so the
disk is added read-only, with the format being detected
automatically.</p>

<p>add-drive-ro-with-if add-drive-ro-with-if filename
iface</p>

<p>This is the same as &quot;add-drive-ro&quot; but it
allows you to specify the QEMU interface emulation to use at
run time.</p>

<p>This function is deprecated. In new code, use the
&quot;add_drive_opts&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>add-drive-with-if add-drive-with-if filename iface</p>

<p>This is the same as &quot;add-drive&quot; but it allows
you to specify the QEMU interface emulation to use at run
time.</p>

<p>This function is deprecated. In new code, use the
&quot;add_drive_opts&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>aug-clear aug-clear augpath</p>

<p>Set the value associated with &quot;path&quot; to
&quot;NULL&quot;. This is the same as the augtool(1)
&quot;clear&quot; command.</p>

<p>aug-close aug-close</p>

<p>Close the current Augeas handle and free up any
resources used by it. After calling this, you have to call
&quot;aug-init&quot; again before you can use any other
Augeas functions.</p>

<p>aug-defnode aug-defnode name expr val</p>

<p>Defines a variable &quot;name&quot; whose value is the
result of evaluating &quot;expr&quot;.</p>

<p>If &quot;expr&quot; evaluates to an empty nodeset, a
node is created, equivalent to calling &quot;aug-set&quot;
&quot;expr&quot;, &quot;value&quot;. &quot;name&quot; will
be the nodeset containing that single node.</p>

<p>On success this returns a pair containing the number of
nodes in the nodeset, and a boolean flag if a node was
created.</p>

<p>aug-defvar aug-defvar name expr</p>

<p>Defines an Augeas variable &quot;name&quot; whose value
is the result of evaluating &quot;expr&quot;. If
&quot;expr&quot; is NULL, then &quot;name&quot; is
undefined.</p>

<p>On success this returns the number of nodes in
&quot;expr&quot;, or 0 if &quot;expr&quot; evaluates to
something which is not a nodeset.</p>

<p>aug-get aug-get augpath</p>

<p>Look up the value associated with &quot;path&quot;. If
&quot;path&quot; matches exactly one node, the
&quot;value&quot; is returned.</p>

<p>aug-init aug-init root flags</p>

<p>Create a new Augeas handle for editing configuration
files. If there was any previous Augeas handle associated
with this guestfs session, then it is closed.</p>

<p>You must call this before using any other
&quot;aug-*&quot; commands.</p>

<p>&quot;root&quot; is the filesystem root.
&quot;root&quot; must not be NULL, use &quot;/&quot;
instead.</p>

<p>The flags are the same as the flags defined in
&lt;augeas.h&gt;, the logical or of the following
integers:</p>

<p>&quot;AUG_SAVE_BACKUP&quot; = 1 Keep the original file
with a &quot;.augsave&quot; extension.</p>

<p>&quot;AUG_SAVE_NEWFILE&quot; = 2 Save changes into a
file with extension &quot;.augnew&quot;, and do not
overwrite original. Overrides
&quot;AUG_SAVE_BACKUP&quot;.</p>

<p>&quot;AUG_TYPE_CHECK&quot; = 4 Typecheck lenses.</p>

<p>This option is only useful when debugging Augeas lenses.
Use of this option may require additional memory for the
libguestfs appliance. You may need to set the
&quot;LIBGUESTFS_MEMSIZE&quot; environment variable or call
&quot;set-memsize&quot;.</p>

<p>&quot;AUG_NO_STDINC&quot; = 8 Do not use standard load
path for modules.</p>

<p>&quot;AUG_SAVE_NOOP&quot; = 16 Make save a no-op, just
record what would have been changed.</p>

<p>&quot;AUG_NO_LOAD&quot; = 32 Do not load the tree in
&quot;aug-init&quot;.</p>

<p>To close the handle, you can call
&quot;aug-close&quot;.</p>

<p>To find out more about Augeas, see
&lt;http://augeas.net/&gt;.</p>

<p>aug-insert aug-insert augpath label true|false</p>

<p>Create a new sibling &quot;label&quot; for
&quot;path&quot;, inserting it into the tree before or after
&quot;path&quot; (depending on the boolean flag
&quot;before&quot;).</p>

<p>&quot;path&quot; must match exactly one existing node in
the tree, and &quot;label&quot; must be a label, ie. not
contain &quot;/&quot;, &quot;*&quot; or end with a bracketed
index &quot;[N]&quot;.</p>

<p>aug-load aug-load</p>

<p>Load files into the tree.</p>

<p>See &quot;aug_load&quot; in the Augeas documentation for
the full gory details.</p>

<p>aug-ls aug-ls augpath</p>

<p>This is just a shortcut for listing
&quot;aug-match&quot; &quot;path/*&quot; and sorting the
resulting nodes into alphabetical order.</p>

<p>aug-match aug-match augpath</p>

<p>Returns a list of paths which match the path expression
&quot;path&quot;. The returned paths are sufficiently
qualified so that they match exactly one node in the current
tree.</p>

<p>aug-mv aug-mv src dest</p>

<p>Move the node &quot;src&quot; to &quot;dest&quot;.
&quot;src&quot; must match exactly one node.
&quot;dest&quot; is overwritten if it exists.</p>

<p>aug-rm aug-rm augpath</p>

<p>Remove &quot;path&quot; and all of its children.</p>

<p>On success this returns the number of entries which were
removed.</p>

<p>aug-save aug-save</p>

<p>This writes all pending changes to disk.</p>

<p>The flags which were passed to &quot;aug-init&quot;
affect exactly how files are saved.</p>

<p>aug-set aug-set augpath val</p>

<p>Set the value associated with &quot;path&quot; to
&quot;val&quot;.</p>

<p>In the Augeas API, it is possible to clear a node by
setting the value to NULL. Due to an oversight in the
libguestfs API you cannot do that with this call. Instead
you must use the &quot;aug-clear&quot; call.</p>

<p>available available &rsquo;groups ...&rsquo;</p>

<p>This command is used to check the availability of some
groups of functionality in the appliance, which not all
builds of the libguestfs appliance will be able to
provide.</p>

<p>The libguestfs groups, and the functions that those
groups correspond to, are listed in &quot;AVAILABILITY&quot;
in guestfs(3). You can also fetch this list at runtime by
calling &quot;available-all-groups&quot;.</p>

<p>The argument &quot;groups&quot; is a list of group
names, eg: &quot;[&quot;inotify&quot;,
&quot;augeas&quot;]&quot; would check for the availability
of the Linux inotify functions and Augeas (configuration
file editing) functions.</p>

<p>The command returns no error if all requested groups are
available.</p>

<p>It fails with an error if one or more of the requested
groups is unavailable in the appliance.</p>

<p>If an unknown group name is included in the list of
groups then an error is always returned.</p>

<p>Notes:</p>

<p>&middot; You must call &quot;launch&quot; before calling
this function.</p>

<p>The reason is because we dont know what groups are
supported by the appliance/daemon until it is running and
can be queried.</p>

<p>&middot; If a group of functions is available, this does
not necessarily mean that they will work. You still have to
check for errors when calling individual API functions even
if they are available.</p>

<p>&middot; It is usually the job of distro packagers to
build complete functionality into the libguestfs appliance.
Upstream libguestfs, if built from source with all
requirements satisfied, will support everything.</p>

<p>&middot; This call was added in version 1.0.80. In
previous versions of libguestfs all you could do would be to
speculatively execute a command to find out if the daemon
implemented it. See also &quot;version&quot;.</p>

<p>available-all-groups available-all-groups</p>

<p>This command returns a list of all optional groups that
this daemon knows about. Note this returns both supported
and unsupported groups. To find out which ones the daemon
can actually support you have to call &quot;available&quot;
on each member of the returned list.</p>

<p>See also &quot;available&quot; and
&quot;AVAILABILITY&quot; in guestfs(3).</p>

<p>base64-in base64-in (base64file|-) filename</p>

<p>This command uploads base64-encoded data from
&quot;base64file&quot; to &quot;filename&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>base64-out base64-out filename (base64file|-)</p>

<p>This command downloads the contents of
&quot;filename&quot;, writing it out to local file
&quot;base64file&quot; encoded as base64.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>blkid blkid device</p>

<p>This command returns block device attributes for
&quot;device&quot;. The following fields are usually present
in the returned hash. Other fields may also be present.</p>

<p>&quot;UUID&quot; The uuid of this device.</p>

<p>&quot;LABEL&quot; The label of this device.</p>

<p>&quot;VERSION&quot; The version of blkid command.</p>

<p>&quot;TYPE&quot; The filesystem type or RAID of this
device.</p>

<p>&quot;USAGE&quot; The usage of this device, for example
&quot;filesystem&quot; or &quot;raid&quot;.</p>

<p>blockdev-flushbufs blockdev-flushbufs device</p>

<p>This tells the kernel to flush internal buffers
associated with &quot;device&quot;.</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-getbsz blockdev-getbsz device</p>

<p>This returns the block size of a device.</p>

<p>(Note this is different from both size in blocks and
filesystem block size).</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-getro blockdev-getro device</p>

<p>Returns a boolean indicating if the block device is
read-only (true if read-only, false if not).</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-getsize64 blockdev-getsize64 device</p>

<p>This returns the size of the device in bytes.</p>

<p>See also &quot;blockdev-getsz&quot;.</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-getss blockdev-getss device</p>

<p>This returns the size of sectors on a block device.
Usually 512, but can be larger for modern devices.</p>

<p>(Note, this is not the size in sectors, use
&quot;blockdev-getsz&quot; for that).</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-getsz blockdev-getsz device</p>

<p>This returns the size of the device in units of 512-byte
sectors (even if the sectorsize isnt 512 bytes ...
weird).</p>

<p>See also &quot;blockdev-getss&quot; for the real sector
size of the device, and &quot;blockdev-getsize64&quot; for
the more useful size in bytes.</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-rereadpt blockdev-rereadpt device</p>

<p>Reread the partition table on &quot;device&quot;.</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-setbsz blockdev-setbsz device blocksize</p>

<p>This sets the block size of a device.</p>

<p>(Note this is different from both size in blocks and
filesystem block size).</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-setro blockdev-setro device</p>

<p>Sets the block device named &quot;device&quot; to
read-only.</p>

<p>This uses the blockdev(8) command.</p>

<p>blockdev-setrw blockdev-setrw device</p>

<p>Sets the block device named &quot;device&quot; to
read-write.</p>

<p>This uses the blockdev(8) command.</p>

<p>btrfs-filesystem-resize btrfs-filesystem-resize
mountpoint [size:N]</p>

<p>This command resizes a btrfs filesystem.</p>

<p>Note that unlike other resize calls, the filesystem has
to be mounted and the parameter is the mountpoint not the
device (this is a requirement of btrfs itself).</p>

<p>The optional parameters are:</p>

<p>&quot;size&quot; The new size (in bytes) of the
filesystem. If omitted, the filesystem is resized to the
maximum size.</p>

<p>See also btrfs(8).</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>case-sensitive-path case-sensitive-path path</p>

<p>This can be used to resolve case insensitive paths on a
filesystem which is case sensitive. The use case is to
resolve paths which you have read from Windows configuration
files or the Windows Registry, to the true path.</p>

<p>The command handles a peculiarity of the Linux ntfs-3g
filesystem driver (and probably others), which is that
although the underlying filesystem is case-insensitive, the
driver exports the filesystem to Linux as
case-sensitive.</p>

<p>One consequence of this is that special directories such
as &quot;c:912ndows&quot; (or other things) depending on the
precise details of how they were created. In Windows itself
this would not be a problem.</p>

<p>Bug or feature? You decide:
&lt;http://www.tuxera.com/community/ntfs-3g-faq/#posixfilenames1&gt;</p>

<p>This function resolves the true case of each element in
the path and returns the case-sensitive path.</p>

<p>Thus &quot;case-sensitive-path&quot;
(&quot;/Windows/System32&quot;) might return
&quot;/WINDOWS/system32&quot; (the exact return value would
depend on details of how the directories were originally
created under Windows).</p>

<p>Note: This function does not handle drive names,
backslashes etc.</p>

<p>See also &quot;realpath&quot;.</p>

<p>cat cat path</p>

<p>Return the contents of the file named
&quot;path&quot;.</p>

<p>Note that this function cannot correctly handle binary
files (specifically, files containing &quot; &quot;
character which is treated as end of string). For those you
need to use the &quot;read-file&quot; or
&quot;download&quot; functions which have a more complex
interface.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>checksum checksum csumtype path</p>

<p>This call computes the MD5, SHAx or CRC checksum of the
file named &quot;path&quot;.</p>

<p>The type of checksum to compute is given by the
&quot;csumtype&quot; parameter which must have one of the
following values:</p>

<p>&quot;crc&quot; Compute the cyclic redundancy check
(CRC) specified by POSIX for the &quot;cksum&quot;
command.</p>

<p>&quot;md5&quot; Compute the MD5 hash (using the
&quot;md5sum&quot; program).</p>

<p>&quot;sha1&quot; Compute the SHA1 hash (using the
&quot;sha1sum&quot; program).</p>

<p>&quot;sha224&quot; Compute the SHA224 hash (using the
&quot;sha224sum&quot; program).</p>

<p>&quot;sha256&quot; Compute the SHA256 hash (using the
&quot;sha256sum&quot; program).</p>

<p>&quot;sha384&quot; Compute the SHA384 hash (using the
&quot;sha384sum&quot; program).</p>

<p>&quot;sha512&quot; Compute the SHA512 hash (using the
&quot;sha512sum&quot; program).</p>

<p>The checksum is returned as a printable string.</p>

<p>To get the checksum for a device, use
&quot;checksum-device&quot;.</p>

<p>To get the checksums for many files, use
&quot;checksums-out&quot;.</p>

<p>checksum-device checksum-device csumtype device</p>

<p>This call computes the MD5, SHAx or CRC checksum of the
contents of the device named &quot;device&quot;. For the
types of checksums supported see the &quot;checksum&quot;
command.</p>

<p>checksums-out checksums-out csumtype directory
(sumsfile|-)</p>

<p>This command computes the checksums of all regular files
in &quot;directory&quot; and then emits a list of those
checksums to the local output file &quot;sumsfile&quot;.</p>

<p>This can be used for verifying the integrity of a
virtual machine. However to be properly secure you should
pay attention to the output of the checksum command (it uses
the ones from GNU coreutils). In particular when the
filename is not printable, coreutils uses a special
backslash syntax. For more information, see the GNU
coreutils info file.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>chmod chmod mode path</p>

<p>Change the mode (permissions) of &quot;path&quot; to
&quot;mode&quot;. Only numeric modes are supported.</p>

<p>Note: When using this command from guestfish,
&quot;mode&quot; by default would be decimal, unless you
prefix it with 0 to get octal, ie. use 0700 not 700.</p>

<p>The mode actually set is affected by the umask.</p>

<p>chown chown owner group path</p>

<p>Change the file owner to &quot;owner&quot; and group to
&quot;group&quot;.</p>

<p>Only numeric uid and gid are supported. If you want to
use names, you will need to locate and parse the password
file yourself (Augeas support makes this relatively
easy).</p>

<p>command command &rsquo;arguments ...&rsquo;</p>

<p>This call runs a command from the guest filesystem. The
filesystem must be mounted, and must contain a compatible
operating system (ie. something Linux, with the same or
compatible processor architecture).</p>

<p>The single parameter is an argv-style list of arguments.
The first element is the name of the program to run.
Subsequent elements are parameters. The list must be
non-empty (ie. must contain a program name). Note that the
command runs directly, and is not invoked via the shell (see
&quot;sh&quot;).</p>

<p>The return value is anything printed to stdout by the
command.</p>

<p>If the command returns a non-zero exit status, then this
function returns an error message. The error message string
is the content of stderr from the command.</p>

<p>The $PATH environment variable will contain at least
&quot;/usr/bin&quot; and &quot;/bin&quot;. If you require a
program from another location, you should provide the full
path in the first parameter.</p>

<p>Shared libraries and data files required by the program
must be available on filesystems which are mounted in the
correct places. It is the callers responsibility to ensure
all filesystems that are needed are mounted at the right
locations.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>command-lines command-lines &rsquo;arguments
...&rsquo;</p>

<p>This is the same as &quot;command&quot;, but splits the
result into a list of lines.</p>

<p>See also: &quot;sh-lines&quot;</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>compress-device-out compress-device-out ctype device
(zdevice|-) [level:N]</p>

<p>This command compresses &quot;device&quot; and writes it
out to the local file &quot;zdevice&quot;.</p>

<p>The &quot;ctype&quot; and optional &quot;level&quot;
parameters have the same meaning as in
&quot;compress-out&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>compress-out compress-out ctype file (zfile|-)
[level:N]</p>

<p>This command compresses &quot;file&quot; and writes it
out to the local file &quot;zfile&quot;.</p>

<p>The compression program used is controlled by the
&quot;ctype&quot; parameter. Currently this includes:
&quot;compress&quot;, &quot;gzip&quot;, &quot;bzip2&quot;,
&quot;xz&quot; or &quot;lzop&quot;. Some compression types
may not be supported by particular builds of libguestfs, in
which case you will get an error containing the substring
&quot;not supported&quot;.</p>

<p>The optional &quot;level&quot; parameter controls
compression level. The meaning and default for this
parameter depends on the compression program being used.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>config config qemuparam qemuvalue</p>

<p>This can be used to add arbitrary qemu command line
parameters of the form -param value. Actually its not quite
arbitrary - we prevent you from setting some parameters
which would interfere with parameters that we use.</p>

<p>The first character of &quot;param&quot; string must be
a &quot;-&quot; (dash).</p>

<p>&quot;value&quot; can be NULL.</p>

<p>copy-device-to-device copy-device-to-device src dest
[srcoffset:N] [destoffset:N] [size:N]</p>

<p>The four calls &quot;copy-device-to-device&quot;,
&quot;copy-device-to-file&quot;, &quot;copy-
file-to-device&quot;, and &quot;copy-file-to-file&quot; let
you copy from a source (device|file) to a destination
(device|file).</p>

<p>Partial copies can be made since you can specify
optionally the source offset, destination offset and size to
copy. These values are all specified in bytes. If not given,
the offsets both default to zero, and the size defaults to
copying as much as possible until we hit the end of the
source.</p>

<p>The source and destination may be the same object.
However overlapping regions may not be copied correctly.</p>

<p>If the destination is a file, it is created if required.
If the destination file is not large enough, it is
extended.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>copy-device-to-file copy-device-to-file src dest
[srcoffset:N] [destoffset:N] [size:N]</p>

<p>See &quot;copy-device-to-device&quot; for a general
overview of this call.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>copy-file-to-device copy-file-to-device src dest
[srcoffset:N] [destoffset:N] [size:N]</p>

<p>See &quot;copy-device-to-device&quot; for a general
overview of this call.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>copy-file-to-file copy-file-to-file src dest
[srcoffset:N] [destoffset:N] [size:N]</p>

<p>See &quot;copy-device-to-device&quot; for a general
overview of this call.</p>

<p>This is not the function you want for copying files.
This is for copying blocks within existing files. See
&quot;cp&quot;, &quot;cp-a&quot; and &quot;mv&quot; for
general file copying and moving functions.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>copy-size copy-size src dest size</p>

<p>This command copies exactly &quot;size&quot; bytes from
one source device or file &quot;src&quot; to another
destination device or file &quot;dest&quot;.</p>

<p>Note this will fail if the source is too short or if the
destination is not large enough.</p>

<p>This function is deprecated. In new code, use the
&quot;copy_device_to_device&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>cp cp src dest</p>

<p>This copies a file from &quot;src&quot; to
&quot;dest&quot; where &quot;dest&quot; is either a
destination filename or destination directory.</p>

<p>cp-a cp-a src dest</p>

<p>This copies a file or directory from &quot;src&quot; to
&quot;dest&quot; recursively using the &quot;cp -a&quot;
command.</p>

<p>dd dd src dest</p>

<p>This command copies from one source device or file
&quot;src&quot; to another destination device or file
&quot;dest&quot;. Normally you would use this to copy to or
from a device or partition, for example to duplicate a
filesystem.</p>

<p>If the destination is a device, it must be as large or
larger than the source file or device, otherwise the copy
will fail. This command cannot do partial copies (see
&quot;copy-device-to-device&quot;).</p>

<p>This function is deprecated. In new code, use the
&quot;copy_device_to_device&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>df df</p>

<p>This command runs the &quot;df&quot; command to report
disk space used.</p>

<p>This command is mostly useful for interactive sessions.
It is not intended that you try to parse the output string.
Use &quot;statvfs&quot; from programs.</p>

<p>df-h df-h</p>

<p>This command runs the &quot;df -h&quot; command to
report disk space used in human-readable format.</p>

<p>This command is mostly useful for interactive sessions.
It is not intended that you try to parse the output string.
Use &quot;statvfs&quot; from programs.</p>

<p>dmesg dmesg</p>

<p>This returns the kernel messages (&quot;dmesg&quot;
output) from the guest kernel. This is sometimes useful for
extended debugging of problems.</p>

<p>Another way to get the same information is to enable
verbose messages with &quot;set-verbose&quot; or by setting
the environment variable &quot;LIBGUESTFS_DEBUG=1&quot;
before running the program.</p>

<p>download download remotefilename (filename|-)</p>

<p>Download file &quot;remotefilename&quot; and save it as
&quot;filename&quot; on the local machine.</p>

<p>&quot;filename&quot; can also be a named pipe.</p>

<p>See also &quot;upload&quot;, &quot;cat&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>download-offset download-offset remotefilename
(filename|-) offset size</p>

<p>Download file &quot;remotefilename&quot; and save it as
&quot;filename&quot; on the local machine.</p>

<p>&quot;remotefilename&quot; is read for &quot;size&quot;
bytes starting at &quot;offset&quot; (this region must be
within the file or device).</p>

<p>Note that there is no limit on the amount of data that
can be downloaded with this call, unlike with
&quot;pread&quot;, and this call always reads the full
amount unless an error occurs.</p>

<p>See also &quot;download&quot;, &quot;pread&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>drop-caches drop-caches whattodrop</p>

<p>This instructs the guest kernel to drop its page cache,
and/or dentries and inode caches. The parameter
&quot;whattodrop&quot; tells the kernel what precisely to
drop, see &lt;http://linux-mm.org/Drop_Caches&gt;</p>

<p>Setting &quot;whattodrop&quot; to 3 should drop
everything.</p>

<p>This automatically calls sync(2) before the operation,
so that the maximum guest memory is freed.</p>

<p>du du path</p>

<p>This command runs the &quot;du -s&quot; command to
estimate file space usage for &quot;path&quot;.</p>

<p>&quot;path&quot; can be a file or a directory. If
&quot;path&quot; is a directory then the estimate includes
the contents of the directory and all subdirectories
(recursively).</p>

<p>The result is the estimated size in kilobytes (ie. units
of 1024 bytes).</p>

<p>e2fsck e2fsck device [correct:true|false]
[forceall:true|false]</p>

<p>This runs the ext2/ext3 filesystem checker on
&quot;device&quot;. It can take the following optional
arguments:</p>

<p>&quot;correct&quot; Automatically repair the file
system. This option will cause e2fsck to automatically fix
any filesystem problems that can be safely fixed without
human intervention.</p>

<p>This option may not be specified at the same time as the
&quot;forceall&quot; option.</p>

<p>&quot;forceall&quot; Assume an answer of yes to all
questions; allows e2fsck to be used non-interactively.</p>

<p>This option may not be specified at the same time as the
&quot;correct&quot; option.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>e2fsck-f e2fsck-f device</p>

<p>This runs &quot;e2fsck -p -f device&quot;, ie. runs the
ext2/ext3 filesystem checker on &quot;device&quot;,
noninteractively (-p), even if the filesystem appears to be
clean (-f).</p>

<p>This command is only needed because of
&quot;resize2fs&quot; (q.v.). Normally you should use
&quot;fsck&quot;.</p>

<p>echo-daemon echo-daemon &rsquo;words ...&rsquo;</p>

<p>This command concatenates the list of &quot;words&quot;
passed with single spaces between them and returns the
resulting string.</p>

<p>You can use this command to test the connection through
to the daemon.</p>

<p>See also &quot;ping-daemon&quot;.</p>

<p>egrep egrep regex path</p>

<p>This calls the external &quot;egrep&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>egrepi egrepi regex path</p>

<p>This calls the external &quot;egrep -i&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>equal equal file1 file2</p>

<p>This compares the two files &quot;file1&quot; and
&quot;file2&quot; and returns true if their content is
exactly equal, or false otherwise.</p>

<p>The external cmp(1) program is used for the
comparison.</p>

<p>exists exists path</p>

<p>This returns &quot;true&quot; if and only if there is a
file, directory (or anything) with the given
&quot;path&quot; name.</p>

<p>See also &quot;is-file&quot;, &quot;is-dir&quot;,
&quot;stat&quot;.</p>

<p>fallocate fallocate path len</p>

<p>This command preallocates a file (containing zero bytes)
named &quot;path&quot; of size &quot;len&quot; bytes. If the
file exists already, it is overwritten.</p>

<p>Do not confuse this with the guestfish-specific
&quot;alloc&quot; command which allocates a file in the host
and attaches it as a device.</p>

<p>This function is deprecated. In new code, use the
&quot;fallocate64&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>fallocate64 fallocate64 path len</p>

<p>This command preallocates a file (containing zero bytes)
named &quot;path&quot; of size &quot;len&quot; bytes. If the
file exists already, it is overwritten.</p>

<p>Note that this call allocates disk blocks for the file.
To create a sparse file use &quot;truncate-size&quot;
instead.</p>

<p>The deprecated call &quot;fallocate&quot; does the same,
but owing to an oversight it only allowed 30 bit lengths to
be specified, effectively limiting the maximum size of files
created through that call to 1GB.</p>

<p>Do not confuse this with the guestfish-specific
&quot;alloc&quot; and &quot;sparse&quot; commands which
create a file in the host and attach it as a device.</p>

<p>fgrep fgrep pattern path</p>

<p>This calls the external &quot;fgrep&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>fgrepi fgrepi pattern path</p>

<p>This calls the external &quot;fgrep -i&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>file file path</p>

<p>This call uses the standard file(1) command to determine
the type or contents of the file.</p>

<p>This call will also transparently look inside various
types of compressed file.</p>

<p>The exact command which runs is &quot;file -zb
path&quot;. Note in particular that the filename is not
prepended to the output (the -b option).</p>

<p>The output depends on the output of the underlying
file(1) command and it can change in future in ways beyond
our control. In other words, the output is not guaranteed by
the ABI.</p>

<p>See also: file(1), &quot;vfs-type&quot;,
&quot;lstat&quot;, &quot;is-file&quot;,
&quot;is-blockdev&quot; (etc), &quot;is-zero&quot;.</p>

<p>file-architecture file-architecture filename</p>

<p>This detects the architecture of the binary
&quot;filename&quot;, and returns it if known.</p>

<p>Currently defined architectures are:</p>

<p>&quot;i386&quot; This string is returned for all 32 bit
i386, i486, i586, i686 binaries irrespective of the precise
processor requirements of the binary.</p>

<p>&quot;x86_64&quot; 64 bit x86-64.</p>

<p>&quot;sparc&quot; 32 bit SPARC.</p>

<p>&quot;sparc64&quot; 64 bit SPARC V9 and above.</p>

<p>&quot;ia64&quot; Intel Itanium.</p>

<p>&quot;ppc&quot; 32 bit Power PC.</p>

<p>&quot;ppc64&quot; 64 bit Power PC.</p>

<p>Libguestfs may return other architecture strings in
future.</p>

<p>The function works on at least the following types of
files:</p>

<p>&middot; many types of Un*x and Linux binary</p>

<p>&middot; many types of Un*x and Linux shared library</p>

<p>&middot; Windows Win32 and Win64 binaries</p>

<p>&middot; Windows Win32 and Win64 DLLs</p>

<p>Win32 binaries and DLLs return &quot;i386&quot;.</p>

<p>Win64 binaries and DLLs return &quot;x86_64&quot;.</p>

<p>&middot; Linux kernel modules</p>

<p>&middot; Linux new-style initrd images</p>

<p>&middot; some non-x86 Linux vmlinuz kernels</p>

<p>What it cant do currently:</p>

<p>&middot; static libraries (libfoo.a)</p>

<p>&middot; Linux old-style initrd as compressed ext2
filesystem (RHEL 3)</p>

<p>&middot; x86 Linux vmlinuz kernels</p>

<p>x86 vmlinuz images (bzImage format) consist of a mix of
16-, 32- and compressed code, and are horribly hard to
unpack. If you want to find the architecture of a kernel,
use the architecture of the associated initrd or kernel
module(s) instead.</p>

<p>filesize filesize file</p>

<p>This command returns the size of &quot;file&quot; in
bytes.</p>

<p>To get other stats about a file, use &quot;stat&quot;,
&quot;lstat&quot;, &quot;is-dir&quot;, &quot;is- file&quot;
etc. To get the size of block devices, use
&quot;blockdev-getsize64&quot;.</p>

<p>fill fill c len path</p>

<p>This command creates a new file called &quot;path&quot;.
The initial content of the file is &quot;len&quot; octets of
&quot;c&quot;, where &quot;c&quot; must be a number in the
range &quot;[0..255]&quot;.</p>

<p>To fill a file with zero bytes (sparsely), it is much
more efficient to use &quot;truncate-size&quot;. To create a
file with a pattern of repeating bytes use
&quot;fill-pattern&quot;.</p>

<p>fill-pattern fill-pattern pattern len path</p>

<p>This function is like &quot;fill&quot; except that it
creates a new file of length &quot;len&quot; containing the
repeating pattern of bytes in &quot;pattern&quot;. The
pattern is truncated if necessary to ensure the length of
the file is exactly &quot;len&quot; bytes.</p>

<p>find find directory</p>

<p>This command lists out all files and directories,
recursively, starting at &quot;directory&quot;. It is
essentially equivalent to running the shell command
&quot;find directory -print&quot; but some post-processing
happens on the output, described below.</p>

<p>This returns a list of strings without any prefix. Thus
if the directory structure was:</p>

<p>/tmp/a /tmp/b /tmp/c/d</p>

<p>then the returned list from &quot;find&quot;
&quot;/tmp&quot; would be 4 elements:</p>

<p>a b c c/d</p>

<p>If &quot;directory&quot; is not a directory, then this
command returns an error.</p>

<p>The returned list is sorted.</p>

<p>See also &quot;find0&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>find0 find0 directory (files|-)</p>

<p>This command lists out all files and directories,
recursively, starting at &quot;directory&quot;, placing the
resulting list in the external file called
&quot;files&quot;.</p>

<p>This command works the same way as &quot;find&quot; with
the following exceptions:</p>

<p>&middot; The resulting list is written to an external
file.</p>

<p>&middot; Items (filenames) in the result are separated
by &quot; &quot; characters. See find(1) option -print0.</p>

<p>&middot; This command is not limited in the number of
names that it can return.</p>

<p>&middot; The result list is not sorted.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>findfs-label findfs-label label</p>

<p>This command searches the filesystems and returns the
one which has the given label. An error is returned if no
such filesystem can be found.</p>

<p>To find the label of a filesystem, use
&quot;vfs-label&quot;.</p>

<p>findfs-uuid findfs-uuid uuid</p>

<p>This command searches the filesystems and returns the
one which has the given UUID. An error is returned if no
such filesystem can be found.</p>

<p>To find the UUID of a filesystem, use
&quot;vfs-uuid&quot;.</p>

<p>fsck fsck fstype device</p>

<p>This runs the filesystem checker (fsck) on
&quot;device&quot; which should have filesystem type
&quot;fstype&quot;.</p>

<p>The returned integer is the status. See fsck(8) for the
list of status codes from &quot;fsck&quot;.</p>

<p>Notes:</p>

<p>&middot; Multiple status codes can be summed
together.</p>

<p>&middot; A non-zero return code can mean
&quot;success&quot;, for example if errors have been
corrected on the filesystem.</p>

<p>&middot; Checking or repairing NTFS volumes is not
supported (by linux- ntfs).</p>

<p>This command is entirely equivalent to running
&quot;fsck -a -t fstype device&quot;.</p>

<p>get-append get-append</p>

<p>Return the additional kernel options which are added to
the guest kernel command line.</p>

<p>If &quot;NULL&quot; then no options are added.</p>

<p>get-attach-method get-attach-method</p>

<p>Return the current attach method. See
&quot;set-attach-method&quot;.</p>

<p>get-autosync get-autosync</p>

<p>Get the autosync flag.</p>

<p>get-direct get-direct</p>

<p>Return the direct appliance mode flag.</p>

<p>get-e2label get-e2label device</p>

<p>This returns the ext2/3/4 filesystem label of the
filesystem on &quot;device&quot;.</p>

<p>This function is deprecated. In new code, use the
&quot;vfs_label&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>get-e2uuid get-e2uuid device</p>

<p>This returns the ext2/3/4 filesystem UUID of the
filesystem on &quot;device&quot;.</p>

<p>This function is deprecated. In new code, use the
&quot;vfs_uuid&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>get-memsize get-memsize</p>

<p>This gets the memory size in megabytes allocated to the
qemu subprocess.</p>

<p>If &quot;set-memsize&quot; was not called on this
handle, and if &quot;LIBGUESTFS_MEMSIZE&quot; was not set,
then this returns the compiled-in default value for
memsize.</p>

<p>For more information on the architecture of libguestfs,
see guestfs(3).</p>

<p>get-network get-network</p>

<p>This returns the enable network flag.</p>

<p>get-path get-path</p>

<p>Return the current search path.</p>

<p>This is always non-NULL. If it wasnt set already, then
this will return the default path.</p>

<p>get-pgroup get-pgroup</p>

<p>This returns the process group flag.</p>

<p>get-pid pid get-pid</p>

<p>Return the process ID of the qemu subprocess. If there
is no qemu subprocess, then this will return an error.</p>

<p>This is an internal call used for debugging and
testing.</p>

<p>get-qemu get-qemu</p>

<p>Return the current qemu binary.</p>

<p>This is always non-NULL. If it wasnt set already, then
this will return the default qemu binary name.</p>

<p>get-recovery-proc get-recovery-proc</p>

<p>Return the recovery process enabled flag.</p>

<p>get-selinux get-selinux</p>

<p>This returns the current setting of the selinux flag
which is passed to the appliance at boot time. See
&quot;set-selinux&quot;.</p>

<p>For more information on the architecture of libguestfs,
see guestfs(3).</p>

<p>get-smp get-smp</p>

<p>This returns the number of virtual CPUs assigned to the
appliance.</p>

<p>get-state get-state</p>

<p>This returns the current state as an opaque integer.
This is only useful for printing debug and internal error
messages.</p>

<p>For more information on states, see guestfs(3).</p>

<p>get-trace get-trace</p>

<p>Return the command trace flag.</p>

<p>get-umask get-umask</p>

<p>Return the current umask. By default the umask is 022
unless it has been set by calling &quot;umask&quot;.</p>

<p>get-verbose get-verbose</p>

<p>This returns the verbose messages flag.</p>

<p>getcon getcon</p>

<p>This gets the SELinux security context of the
daemon.</p>

<p>See the documentation about SELINUX in guestfs(3), and
&quot;setcon&quot;</p>

<p>getxattr getxattr path name</p>

<p>Get a single extended attribute from file
&quot;path&quot; named &quot;name&quot;. This call follows
symlinks. If you want to lookup an extended attribute for
the symlink itself, use &quot;lgetxattr&quot;.</p>

<p>Normally it is better to get all extended attributes
from a file in one go by calling &quot;getxattrs&quot;.
However some Linux filesystem implementations are buggy and
do not provide a way to list out attributes. For these
filesystems (notably ntfs-3g) you have to know the names of
the extended attributes you want in advance and call this
function.</p>

<p>Extended attribute values are blobs of binary data. If
there is no extended attribute named &quot;name&quot;, this
returns an error.</p>

<p>See also: &quot;getxattrs&quot;, &quot;lgetxattr&quot;,
attr(5).</p>

<p>getxattrs getxattrs path</p>

<p>This call lists the extended attributes of the file or
directory &quot;path&quot;.</p>

<p>At the system call level, this is a combination of the
listxattr(2) and getxattr(2) calls.</p>

<p>See also: &quot;lgetxattrs&quot;, attr(5).</p>

<p>glob-expand glob-expand pattern</p>

<p>This command searches for all the pathnames matching
&quot;pattern&quot; according to the wildcard expansion
rules used by the shell.</p>

<p>If no paths match, then this returns an empty list
(note: not an error).</p>

<p>It is just a wrapper around the C glob(3) function with
flags &quot;GLOB_MARK|GLOB_BRACE&quot;. See that manual page
for more details.</p>

<p>grep grep regex path</p>

<p>This calls the external &quot;grep&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>grepi grepi regex path</p>

<p>This calls the external &quot;grep -i&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>grub-install grub-install root device</p>

<p>This command installs GRUB 1 (the Grand Unified
Bootloader) on &quot;device&quot;, with the root directory
being &quot;root&quot;.</p>

<p>Notes:</p>

<p>&middot; There is currently no way in the API to install
grub2, which is used by most modern Linux guests. It is
possible to run the grub2 command from the guest, although
see the caveats in &quot;RUNNING COMMANDS&quot; in
guestfs(3).</p>

<p>&middot; This uses &quot;grub-install&quot; from the
host. Unfortunately grub is not always compatible with
itself, so this only works in rather narrow circumstances.
Careful testing with each guest version is advisable.</p>

<p>&middot; If grub-install reports the error &quot;No
suitable drive was found in the generated device map.&quot;
it may be that you need to create a
&quot;/boot/grub/device.map&quot; file first that contains
the mapping between grub device names and Linux device
names. It is usually sufficient to create a file
containing:</p>

<p>(hd0) /dev/vda</p>

<p>replacing &quot;/dev/vda&quot; with the name of the
installation device.</p>

<p>head head path</p>

<p>This command returns up to the first 10 lines of a file
as a list of strings.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>head-n head-n nrlines path</p>

<p>If the parameter &quot;nrlines&quot; is a positive
number, this returns the first &quot;nrlines&quot; lines of
the file &quot;path&quot;.</p>

<p>If the parameter &quot;nrlines&quot; is a negative
number, this returns lines from the file &quot;path&quot;,
excluding the last &quot;nrlines&quot; lines.</p>

<p>If the parameter &quot;nrlines&quot; is zero, this
returns an empty list.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>hexdump hexdump path</p>

<p>This runs &quot;hexdump -C&quot; on the given
&quot;path&quot;. The result is the human- readable,
canonical hex dump of the file.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>initrd-cat initrd-cat initrdpath filename</p>

<p>This command unpacks the file &quot;filename&quot; from
the initrd file called &quot;initrdpath&quot;. The filename
must be given without the initial &quot;/&quot;
character.</p>

<p>For example, in guestfish you could use the following
command to examine the boot script (usually called
&quot;/init&quot;) contained in a Linux initrd or initramfs
image:</p>

<p>initrd-cat /boot/initrd-&lt;version&gt;.img init</p>

<p>See also &quot;initrd-list&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>initrd-list initrd-list path</p>

<p>This command lists out files contained in an initrd.</p>

<p>The files are listed without any initial &quot;/&quot;
character. The files are listed in the order they appear
(not necessarily alphabetical). Directory names are listed
as separate items.</p>

<p>Old Linux kernels (2.4 and earlier) used a compressed
ext2 filesystem as initrd. We only support the newer
initramfs format (compressed cpio files).</p>

<p>inotify-add-watch inotify-add-watch path mask</p>

<p>Watch &quot;path&quot; for the events listed in
&quot;mask&quot;.</p>

<p>Note that if &quot;path&quot; is a directory then events
within that directory are watched, but this does not happen
recursively (in subdirectories).</p>

<p>Note for non-C or non-Linux callers: the inotify events
are defined by the Linux kernel ABI and are listed in
&quot;/usr/include/sys/inotify.h&quot;.</p>

<p>inotify-close inotify-close</p>

<p>This closes the inotify handle which was previously
opened by inotify_init. It removes all watches, throws away
any pending events, and deallocates all resources.</p>

<p>inotify-files inotify-files</p>

<p>This function is a helpful wrapper around
&quot;inotify-read&quot; which just returns a list of
pathnames of objects that were touched. The returned
pathnames are sorted and deduplicated.</p>

<p>inotify-init inotify-init maxevents</p>

<p>This command creates a new inotify handle. The inotify
subsystem can be used to notify events which happen to
objects in the guest filesystem.</p>

<p>&quot;maxevents&quot; is the maximum number of events
which will be queued up between calls to
&quot;inotify-read&quot; or &quot;inotify-files&quot;. If
this is passed as 0, then the kernel (or previously set)
default is used. For Linux 2.6.29 the default was 16384
events. Beyond this limit, the kernel throws away events,
but records the fact that it threw them away by setting a
flag &quot;IN_Q_OVERFLOW&quot; in the returned structure
list (see &quot;inotify-read&quot;).</p>

<p>Before any events are generated, you have to add some
watches to the internal watch list. See:
&quot;inotify-add-watch&quot; and
&quot;inotify-rm-watch&quot;.</p>

<p>Queued up events should be read periodically by calling
&quot;inotify-read&quot; (or &quot;inotify-files&quot; which
is just a helpful wrapper around &quot;inotify- read&quot;).
If you dont read the events out often enough then you risk
the internal queue overflowing.</p>

<p>The handle should be closed after use by calling
&quot;inotify-close&quot;. This also removes any watches
automatically.</p>

<p>See also inotify(7) for an overview of the inotify
interface as exposed by the Linux kernel, which is roughly
what we expose via libguestfs. Note that there is one global
inotify handle per libguestfs instance.</p>

<p>inotify-read inotify-read</p>

<p>Return the complete queue of events that have happened
since the previous read call.</p>

<p>If no events have happened, this returns an empty
list.</p>

<p>Note: In order to make sure that all events have been
read, you must call this function repeatedly until it
returns an empty list. The reason is that the call will read
events up to the maximum appliance- to-host message size and
leave remaining events in the queue.</p>

<p>inotify-rm-watch inotify-rm-watch wd</p>

<p>Remove a previously defined inotify watch. See
&quot;inotify-add-watch&quot;.</p>

<p>inspect-get-arch inspect-get-arch root</p>

<p>This returns the architecture of the inspected operating
system. The possible return values are listed under
&quot;file-architecture&quot;.</p>

<p>If the architecture could not be determined, then the
string &quot;unknown&quot; is returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-distro inspect-get-distro root</p>

<p>This returns the distro (distribution) of the inspected
operating system.</p>

<p>Currently defined distros are:</p>

<p>&quot;archlinux&quot; Arch Linux.</p>

<p>&quot;centos&quot; CentOS.</p>

<p>&quot;debian&quot; Debian.</p>

<p>&quot;fedora&quot; Fedora.</p>

<p>&quot;gentoo&quot; Gentoo.</p>

<p>&quot;linuxmint&quot; Linux Mint.</p>

<p>&quot;mageia&quot; Mageia.</p>

<p>&quot;mandriva&quot; Mandriva.</p>

<p>&quot;meego&quot; MeeGo.</p>

<p>&quot;opensuse&quot; OpenSUSE.</p>

<p>&quot;pardus&quot; Pardus.</p>

<p>&quot;redhat-based&quot; Some Red Hat-derived
distro.</p>

<p>&quot;rhel&quot; Red Hat Enterprise Linux.</p>

<p>&quot;scientificlinux&quot; Scientific Linux.</p>

<p>&quot;slackware&quot; Slackware.</p>

<p>&quot;ttylinux&quot; ttylinux.</p>

<p>&quot;ubuntu&quot; Ubuntu.</p>

<p>&quot;unknown&quot; The distro could not be
determined.</p>

<p>&quot;windows&quot; Windows does not have distributions.
This string is returned if the OS type is Windows.</p>

<p>Future versions of libguestfs may return other strings
here. The caller should be prepared to handle any
string.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-drive-mappings inspect-get-drive-mappings
root</p>

<p>This call is useful for Windows which uses a primitive
system of assigning drive letters (like &quot;C:&quot;) to
partitions. This inspection API examines the Windows
Registry to find out how disks/partitions are mapped to
drive letters, and returns a hash table as in the example
below:</p>

<p>C =&gt; /dev/vda2 E =&gt; /dev/vdb1 F =&gt;
/dev/vdc1</p>

<p>Note that keys are drive letters. For Windows, the key
is case insensitive and just contains the drive letter,
without the customary colon separator character.</p>

<p>In future we may support other operating systems that
also used drive letters, but the keys for those might not be
case insensitive and might be longer than 1 character. For
example in OS-9, hard drives were named &quot;h0&quot;,
&quot;h1&quot; etc.</p>

<p>For Windows guests, currently only hard drive mappings
are returned. Removable disks (eg. DVD-ROMs) are
ignored.</p>

<p>For guests that do not use drive mappings, or if the
drive mappings could not be determined, this returns an
empty hash table.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details. See also &quot;inspect-get-mountpoints&quot;,
&quot;inspect-get-filesystems&quot;.</p>

<p>inspect-get-filesystems inspect-get-filesystems root</p>

<p>This returns a list of all the filesystems that we think
are associated with this operating system. This includes the
root filesystem, other ordinary filesystems, and non-mounted
devices like swap partitions.</p>

<p>In the case of a multi-boot virtual machine, it is
possible for a filesystem to be shared between operating
systems.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details. See also
&quot;inspect-get-mountpoints&quot;.</p>

<p>inspect-get-format inspect-get-format root</p>

<p>This returns the format of the inspected operating
system. You can use it to detect install images, live CDs
and similar.</p>

<p>Currently defined formats are:</p>

<p>&quot;installed&quot; This is an installed operating
system.</p>

<p>&quot;installer&quot; The disk image being inspected is
not an installed operating system, but a bootable install
disk, live CD, or similar.</p>

<p>&quot;unknown&quot; The format of this disk image is not
known.</p>

<p>Future versions of libguestfs may return other strings
here. The caller should be prepared to handle any
string.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-hostname inspect-get-hostname root</p>

<p>This function returns the hostname of the operating
system as found by inspection of the guests configuration
files.</p>

<p>If the hostname could not be determined, then the string
&quot;unknown&quot; is returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-icon inspect-get-icon root
[favicon:true|false] [highquality:true|false]</p>

<p>This function returns an icon corresponding to the
inspected operating system. The icon is returned as a buffer
containing a PNG image (re- encoded to PNG if
necessary).</p>

<p>If it was not possible to get an icon this function
returns a zero- length (non-NULL) buffer. Callers must check
for this case.</p>

<p>Libguestfs will start by looking for a file called
&quot;/etc/favicon.png&quot; or &quot;C:\tcvicon.png&quot;
and if it has the correct format, the contents of this file
will be returned. You can disable favicons by passing the
optional &quot;favicon&quot; boolean as false (default is
true).</p>

<p>If finding the favicon fails, then we look in other
places in the guest for a suitable icon.</p>

<p>If the optional &quot;highquality&quot; boolean is true
then only high quality icons are returned, which means only
icons of high resolution with an alpha channel. The default
(false) is to return any icon we can, even if it is of
substandard quality.</p>

<p>Notes:</p>

<p>&middot; Unlike most other inspection API calls, the
guest s disks must be mounted up before you call this, since
it needs to read information from the guest filesystem
during the call.</p>

<p>&middot; Security: The icon data comes from the
untrusted guest, and should be treated with caution. PNG
files have been known to contain exploits. Ensure that
libpng (or other relevant libraries) are fully up to date
before trying to process or display the icon.</p>

<p>&middot; The PNG image returned can be any size. It
might not be square. Libguestfs tries to return the largest,
highest quality icon available. The application must scale
the icon to the required size.</p>

<p>&middot; Extracting icons from Windows guests requires
the external &quot;wrestool&quot; program from the
&quot;icoutils&quot; package, and several programs
(&quot;bmptopnm&quot;, &quot;pnmtopng&quot;,
&quot;pamcut&quot;) from the &quot;netpbm&quot; package.
These must be installed separately.</p>

<p>&middot; Operating system icons are usually trademarks.
Seek legal advice before using trademarks in
applications.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>inspect-get-major-version inspect-get-major-version
root</p>

<p>This returns the major version number of the inspected
operating system.</p>

<p>Windows uses a consistent versioning scheme which is not
reflected in the popular public names used by the operating
system. Notably the operating system known as &quot;Windows
7&quot; is really version 6.1 (ie. major = 6, minor = 1).
You can find out the real versions corresponding to releases
of Windows by consulting Wikipedia or MSDN.</p>

<p>If the version could not be determined, then 0 is
returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-minor-version inspect-get-minor-version
root</p>

<p>This returns the minor version number of the inspected
operating system.</p>

<p>If the version could not be determined, then 0 is
returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details. See also
&quot;inspect-get-major-version&quot;.</p>

<p>inspect-get-mountpoints inspect-get-mountpoints root</p>

<p>This returns a hash of where we think the filesystems
associated with this operating system should be mounted.
Callers should note that this is at best an educated guess
made by reading configuration files such as
&quot;/etc/fstab&quot;. In particular note that this may
return filesystems which are non-existent or not mountable
and callers should be prepared to handle or ignore failures
if they try to mount them.</p>

<p>Each element in the returned hashtable has a key which
is the path of the mountpoint (eg. &quot;/boot&quot;) and a
value which is the filesystem that would be mounted there
(eg. &quot;/dev/sda1&quot;).</p>

<p>Non-mounted devices such as swap devices are not
returned in this list.</p>

<p>For operating systems like Windows which still use drive
letters, this call will only return an entry for the first
drive &quot;mounted on&quot; &quot;/&quot;. For information
about the mapping of drive letters to partitions, see
&quot;inspect-get-drive-mappings&quot;.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details. See also
&quot;inspect-get-filesystems&quot;.</p>

<p>inspect-get-package-format inspect-get-package-format
root</p>

<p>This function and
&quot;inspect-get-package-management&quot; return the
package format and package management tool used by the
inspected operating system. For example for Fedora these
functions would return &quot;rpm&quot; (package format) and
&quot;yum&quot; (package management).</p>

<p>This returns the string &quot;unknown&quot; if we could
not determine the package format or if the operating system
does not have a real packaging system (eg. Windows).</p>

<p>Possible strings include: &quot;rpm&quot;,
&quot;deb&quot;, &quot;ebuild&quot;, &quot;pisi&quot;,
&quot;pacman&quot;, &quot;pkgsrc&quot;. Future versions of
libguestfs may return other strings.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-package-management
inspect-get-package-management root</p>

<p>&quot;inspect-get-package-format&quot; and this function
return the package format and package management tool used
by the inspected operating system. For example for Fedora
these functions would return &quot;rpm&quot; (package
format) and &quot;yum&quot; (package management).</p>

<p>This returns the string &quot;unknown&quot; if we could
not determine the package management tool or if the
operating system does not have a real packaging system (eg.
Windows).</p>

<p>Possible strings include: &quot;yum&quot;,
&quot;up2date&quot;, &quot;apt&quot; (for all Debian
derivatives), &quot;portage&quot;, &quot;pisi&quot;,
&quot;pacman&quot;, &quot;urpmi&quot;, &quot;zypper&quot;.
Future versions of libguestfs may return other strings.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-product-name inspect-get-product-name
root</p>

<p>This returns the product name of the inspected operating
system. The product name is generally some freeform string
which can be displayed to the user, but should not be parsed
by programs.</p>

<p>If the product name could not be determined, then the
string &quot;unknown&quot; is returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-product-variant inspect-get-product-variant
root</p>

<p>This returns the product variant of the inspected
operating system.</p>

<p>For Windows guests, this returns the contents of the
Registry key &quot;HKLMtwarecrosoftWindows
NT&quot;InstallationType&quot; which is usually a string
such as &quot;Client&quot; or &quot;Server&quot; (other
values are possible). This can be used to distinguish
consumer and enterprise versions of Windows that have the
same version number (for example, Windows 7 and Windows 2008
Server are both version 6.1, but the former is
&quot;Client&quot; and the latter is
&quot;Server&quot;).</p>

<p>For enterprise Linux guests, in future we intend this to
return the product variant such as &quot;Desktop&quot;,
&quot;Server&quot; and so on. But this is not implemented at
present.</p>

<p>If the product variant could not be determined, then the
string &quot;unknown&quot; is returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details. See also &quot;inspect-get-product-name&quot;,
&quot;inspect-get-major-version&quot;.</p>

<p>inspect-get-roots inspect-get-roots</p>

<p>This function is a convenient way to get the list of
root devices, as returned from a previous call to
&quot;inspect-os&quot;, but without redoing the whole
inspection process.</p>

<p>This returns an empty list if either no root devices
were found or the caller has not called
&quot;inspect-os&quot;.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-type inspect-get-type root</p>

<p>This returns the type of the inspected operating system.
Currently defined types are:</p>

<p>&quot;linux&quot; Any Linux-based operating system.</p>

<p>&quot;windows&quot; Any Microsoft Windows operating
system.</p>

<p>&quot;freebsd&quot; FreeBSD.</p>

<p>&quot;netbsd&quot; NetBSD.</p>

<p>&quot;hurd&quot; GNU/Hurd.</p>

<p>&quot;unknown&quot; The operating system type could not
be determined.</p>

<p>Future versions of libguestfs may return other strings
here. The caller should be prepared to handle any
string.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-windows-current-control-set
inspect-get-windows-current-control-set root</p>

<p>This returns the Windows CurrentControlSet of the
inspected guest. The CurrentControlSet is a registry key
name such as &quot;ControlSet001&quot;.</p>

<p>This call assumes that the guest is Windows and that the
Registry could be examined by inspection. If this is not the
case then an error is returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-get-windows-systemroot
inspect-get-windows-systemroot root</p>

<p>This returns the Windows systemroot of the inspected
guest. The systemroot is a directory path such as
&quot;/WINDOWS&quot;.</p>

<p>This call assumes that the guest is Windows and that the
systemroot could be determined by inspection. If this is not
the case then an error is returned.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-is-live inspect-is-live root</p>

<p>If &quot;inspect-get-format&quot; returns
&quot;installer&quot; (this is an install disk), then this
returns true if a live image was detected on the disk.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-is-multipart inspect-is-multipart root</p>

<p>If &quot;inspect-get-format&quot; returns
&quot;installer&quot; (this is an install disk), then this
returns true if the disk is part of a set.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-is-netinst inspect-is-netinst root</p>

<p>If &quot;inspect-get-format&quot; returns
&quot;installer&quot; (this is an install disk), then this
returns true if the disk is a network installer, ie. not a
self-contained install CD but one which is likely to require
network access to complete the install.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-list-applications inspect-list-applications
root</p>

<p>Return the list of applications installed in the
operating system.</p>

<p>Note: This call works differently from other parts of
the inspection API. You have to call &quot;inspect-os&quot;,
then &quot;inspect-get-mountpoints&quot;, then mount up the
disks, before calling this. Listing applications is a
significantly more difficult operation which requires access
to the full filesystem. Also note that unlike the other
&quot;inspect-get-*&quot; calls which are just returning
data cached in the libguestfs handle, this call actually
reads parts of the mounted filesystems during the call.</p>

<p>This returns an empty list if the inspection code was
not able to determine the list of applications.</p>

<p>The application structure contains the following
fields:</p>

<p>&quot;app_name&quot; The name of the application. For
Red Hat-derived and Debian- derived Linux guests, this is
the package name.</p>

<p>&quot;app_display_name&quot; The display name of the
application, sometimes localized to the install language of
the guest operating system.</p>

<p>If unavailable this is returned as an empty string
&quot;&quot;. Callers needing to display something can use
&quot;app_name&quot; instead.</p>

<p>&quot;app_epoch&quot; For package managers which use
epochs, this contains the epoch of the package (an integer).
If unavailable, this is returned as 0.</p>

<p>&quot;app_version&quot; The version string of the
application or package. If unavailable this is returned as
an empty string &quot;&quot;.</p>

<p>&quot;app_release&quot; The release string of the
application or package, for package managers that use this.
If unavailable this is returned as an empty string
&quot;&quot;.</p>

<p>&quot;app_install_path&quot; The installation path of
the application (on operating systems such as Windows which
use installation paths). This path is in the format used by
the guest operating system, it is not a libguestfs path.</p>

<p>If unavailable this is returned as an empty string
&quot;&quot;.</p>

<p>&quot;app_trans_path&quot; The install path translated
into a libguestfs path. If unavailable this is returned as
an empty string &quot;&quot;.</p>

<p>&quot;app_publisher&quot; The name of the publisher of
the application, for package managers that use this. If
unavailable this is returned as an empty string
&quot;&quot;.</p>

<p>&quot;app_url&quot; The URL (eg. upstream URL) of the
application. If unavailable this is returned as an empty
string &quot;&quot;.</p>

<p>&quot;app_source_package&quot; For packaging systems
which support this, the name of the source package. If
unavailable this is returned as an empty string
&quot;&quot;.</p>

<p>&quot;app_summary&quot; A short (usually one line)
description of the application or package. If unavailable
this is returned as an empty string &quot;&quot;.</p>

<p>&quot;app_description&quot; A longer description of the
application or package. If unavailable this is returned as
an empty string &quot;&quot;.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>inspect-os inspect-os</p>

<p>This function uses other libguestfs functions and
certain heuristics to inspect the disk(s) (usually disks
belonging to a virtual machine), looking for operating
systems.</p>

<p>The list returned is empty if no operating systems were
found.</p>

<p>If one operating system was found, then this returns a
list with a single element, which is the name of the root
filesystem of this operating system. It is also possible for
this function to return a list containing more than one
element, indicating a dual-boot or multi- boot virtual
machine, with each element being the root filesystem of one
of the operating systems.</p>

<p>You can pass the root string(s) returned to other
&quot;inspect-get-*&quot; functions in order to query
further information about each operating system, such as the
name and version.</p>

<p>This function uses other libguestfs features such as
&quot;mount-ro&quot; and &quot;umount-all&quot; in order to
mount and unmount filesystems and look at the contents. This
should be called with no disks currently mounted. The
function may also use Augeas, so any existing Augeas handle
will be closed.</p>

<p>This function cannot decrypt encrypted disks. The caller
must do that first (supplying the necessary keys) if the
disk is encrypted.</p>

<p>Please read &quot;INSPECTION&quot; in guestfs(3) for
more details.</p>

<p>See also &quot;list-filesystems&quot;.</p>

<p>is-blockdev is-blockdev path</p>

<p>This returns &quot;true&quot; if and only if there is a
block device with the given &quot;path&quot; name.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-busy is-busy</p>

<p>This returns true iff this handle is busy processing a
command (in the &quot;BUSY&quot; state).</p>

<p>For more information on states, see guestfs(3).</p>

<p>is-chardev is-chardev path</p>

<p>This returns &quot;true&quot; if and only if there is a
character device with the given &quot;path&quot; name.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-config is-config</p>

<p>This returns true iff this handle is being configured
(in the &quot;CONFIG&quot; state).</p>

<p>For more information on states, see guestfs(3).</p>

<p>is-dir is-dir path</p>

<p>This returns &quot;true&quot; if and only if there is a
directory with the given &quot;path&quot; name. Note that it
returns false for other objects like files.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-fifo is-fifo path</p>

<p>This returns &quot;true&quot; if and only if there is a
FIFO (named pipe) with the given &quot;path&quot; name.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-file is-file path</p>

<p>This returns &quot;true&quot; if and only if there is a
regular file with the given &quot;path&quot; name. Note that
it returns false for other objects like directories.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-launching is-launching</p>

<p>This returns true iff this handle is launching the
subprocess (in the &quot;LAUNCHING&quot; state).</p>

<p>For more information on states, see guestfs(3).</p>

<p>is-lv is-lv device</p>

<p>This command tests whether &quot;device&quot; is a
logical volume, and returns true iff this is the case.</p>

<p>is-ready is-ready</p>

<p>This returns true iff this handle is ready to accept
commands (in the &quot;READY&quot; state).</p>

<p>For more information on states, see guestfs(3).</p>

<p>is-socket is-socket path</p>

<p>This returns &quot;true&quot; if and only if there is a
Unix domain socket with the given &quot;path&quot; name.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-symlink is-symlink path</p>

<p>This returns &quot;true&quot; if and only if there is a
symbolic link with the given &quot;path&quot; name.</p>

<p>See also &quot;stat&quot;.</p>

<p>is-zero is-zero path</p>

<p>This returns true iff the file exists and the file is
empty or it contains all zero bytes.</p>

<p>is-zero-device is-zero-device device</p>

<p>This returns true iff the device exists and contains all
zero bytes.</p>

<p>Note that for large devices this can take a long time to
run.</p>

<p>kill-subprocess kill-subprocess</p>

<p>This kills the qemu subprocess. You should never need to
call this.</p>

<p>launch run launch</p>

<p>Internally libguestfs is implemented by running a
virtual machine using qemu(1).</p>

<p>You should call this after configuring the handle (eg.
adding drives) but before performing any actions.</p>

<p>lchown lchown owner group path</p>

<p>Change the file owner to &quot;owner&quot; and group to
&quot;group&quot;. This is like &quot;chown&quot; but if
&quot;path&quot; is a symlink then the link itself is
changed, not the target.</p>

<p>Only numeric uid and gid are supported. If you want to
use names, you will need to locate and parse the password
file yourself (Augeas support makes this relatively
easy).</p>

<p>lgetxattr lgetxattr path name</p>

<p>Get a single extended attribute from file
&quot;path&quot; named &quot;name&quot;. If &quot;path&quot;
is a symlink, then this call returns an extended attribute
from the symlink.</p>

<p>Normally it is better to get all extended attributes
from a file in one go by calling &quot;getxattrs&quot;.
However some Linux filesystem implementations are buggy and
do not provide a way to list out attributes. For these
filesystems (notably ntfs-3g) you have to know the names of
the extended attributes you want in advance and call this
function.</p>

<p>Extended attribute values are blobs of binary data. If
there is no extended attribute named &quot;name&quot;, this
returns an error.</p>

<p>See also: &quot;lgetxattrs&quot;, &quot;getxattr&quot;,
attr(5).</p>

<p>lgetxattrs lgetxattrs path</p>

<p>This is the same as &quot;getxattrs&quot;, but if
&quot;path&quot; is a symbolic link, then it returns the
extended attributes of the link itself.</p>

<p>list-9p list-9p</p>

<p>List all 9p filesystems attached to the guest. A list of
mount tags is returned.</p>

<p>list-devices list-devices</p>

<p>List all the block devices.</p>

<p>The full block device names are returned, eg.
&quot;/dev/sda&quot;.</p>

<p>See also &quot;list-filesystems&quot;.</p>

<p>list-dm-devices list-dm-devices</p>

<p>List all device mapper devices.</p>

<p>The returned list contains &quot;/dev/mapper/*&quot;
devices, eg. ones created by a previous call to
&quot;luks-open&quot;.</p>

<p>Device mapper devices which correspond to logical
volumes are not returned in this list. Call &quot;lvs&quot;
if you want to list logical volumes.</p>

<p>list-filesystems list-filesystems</p>

<p>This inspection command looks for filesystems on
partitions, block devices and logical volumes, returning a
list of devices containing filesystems and their type.</p>

<p>The return value is a hash, where the keys are the
devices containing filesystems, and the values are the
filesystem types. For example:</p>

<p>&quot;/dev/sda1&quot; =&gt; &quot;ntfs&quot;
&quot;/dev/sda2&quot; =&gt; &quot;ext2&quot;
&quot;/dev/vg_guest/lv_root&quot; =&gt; &quot;ext4&quot;
&quot;/dev/vg_guest/lv_swap&quot; =&gt; &quot;swap&quot;</p>

<p>The value can have the special value
&quot;unknown&quot;, meaning the content of the device is
undetermined or empty. &quot;swap&quot; means a Linux swap
partition.</p>

<p>This command runs other libguestfs commands, which might
include &quot;mount&quot; and &quot;umount&quot;, and
therefore you should use this soon after launch and only
when nothing is mounted.</p>

<p>Not all of the filesystems returned will be mountable.
In particular, swap partitions are returned in the list.
Also this command does not check that each filesystem found
is valid and mountable, and some filesystems might be
mountable but require special options. Filesystems may not
all belong to a single logical operating system (use
&quot;inspect-os&quot; to look for OSes).</p>

<p>list-md-devices list-md-devices</p>

<p>List all Linux md devices.</p>

<p>list-partitions list-partitions</p>

<p>List all the partitions detected on all block
devices.</p>

<p>The full partition device names are returned, eg.
&quot;/dev/sda1&quot;</p>

<p>This does not return logical volumes. For that you will
need to call &quot;lvs&quot;.</p>

<p>See also &quot;list-filesystems&quot;.</p>

<p>ll ll directory</p>

<p>List the files in &quot;directory&quot; (relative to the
root directory, there is no cwd) in the format of ls
-la.</p>

<p>This command is mostly useful for interactive sessions.
It is not intended that you try to parse the output
string.</p>

<p>ln ln target linkname</p>

<p>This command creates a hard link using the
&quot;ln&quot; command.</p>

<p>ln-f ln-f target linkname</p>

<p>This command creates a hard link using the &quot;ln
-f&quot; command. The -f option removes the link
(&quot;linkname&quot;) if it exists already.</p>

<p>ln-s ln-s target linkname</p>

<p>This command creates a symbolic link using the &quot;ln
-s&quot; command.</p>

<p>ln-sf ln-sf target linkname</p>

<p>This command creates a symbolic link using the &quot;ln
-sf&quot; command, The -f option removes the link
(&quot;linkname&quot;) if it exists already.</p>

<p>lremovexattr lremovexattr xattr path</p>

<p>This is the same as &quot;removexattr&quot;, but if
&quot;path&quot; is a symbolic link, then it removes an
extended attribute of the link itself.</p>

<p>ls ls directory</p>

<p>List the files in &quot;directory&quot; (relative to the
root directory, there is no cwd). The . and .. entries are
not returned, but hidden files are shown.</p>

<p>This command is mostly useful for interactive sessions.
Programs should probably use &quot;readdir&quot;
instead.</p>

<p>lsetxattr lsetxattr xattr val vallen path</p>

<p>This is the same as &quot;setxattr&quot;, but if
&quot;path&quot; is a symbolic link, then it sets an
extended attribute of the link itself.</p>

<p>lstat lstat path</p>

<p>Returns file information for the given
&quot;path&quot;.</p>

<p>This is the same as &quot;stat&quot; except that if
&quot;path&quot; is a symbolic link, then the link is
stat-ed, not the file it refers to.</p>

<p>This is the same as the lstat(2) system call.</p>

<p>lstatlist lstatlist path &rsquo;names ...&rsquo;</p>

<p>This call allows you to perform the &quot;lstat&quot;
operation on multiple files, where all files are in the
directory &quot;path&quot;. &quot;names&quot; is the list of
files from this directory.</p>

<p>On return you get a list of stat structs, with a
one-to-one correspondence to the &quot;names&quot; list. If
any name did not exist or could not be lstatd, then the
&quot;ino&quot; field of that structure is set to
&quot;-1&quot;.</p>

<p>This call is intended for programs that want to
efficiently list a directory contents without making many
round-trips. See also &quot;lxattrlist&quot; for a similarly
efficient call for getting extended attributes. Very long
directory listings might cause the protocol message size to
be exceeded, causing this call to fail. The caller must
split up such requests into smaller groups of names.</p>

<p>luks-add-key luks-add-key device keyslot</p>

<p>This command adds a new key on LUKS device
&quot;device&quot;. &quot;key&quot; is any existing key, and
is used to access the device. &quot;newkey&quot; is the new
key to add. &quot;keyslot&quot; is the key slot that will be
replaced.</p>

<p>Note that if &quot;keyslot&quot; already contains a key,
then this command will fail. You have to use
&quot;luks-kill-slot&quot; first to remove that key.</p>

<p>This command has one or more key or passphrase
parameters. Guestfish will prompt for these separately.</p>

<p>luks-close luks-close device</p>

<p>This closes a LUKS device that was created earlier by
&quot;luks-open&quot; or &quot;luks-open-ro&quot;. The
&quot;device&quot; parameter must be the name of the LUKS
mapping device (ie. &quot;/dev/mapper/mapname&quot;) and not
the name of the underlying block device.</p>

<p>luks-format luks-format device keyslot</p>

<p>This command erases existing data on &quot;device&quot;
and formats the device as a LUKS encrypted device.
&quot;key&quot; is the initial key, which is added to key
slot &quot;slot&quot;. (LUKS supports 8 key slots, numbered
0-7).</p>

<p>This command has one or more key or passphrase
parameters. Guestfish will prompt for these separately.</p>

<p>luks-format-cipher luks-format-cipher device keyslot
cipher</p>

<p>This command is the same as &quot;luks-format&quot; but
it also allows you to set the &quot;cipher&quot; used.</p>

<p>This command has one or more key or passphrase
parameters. Guestfish will prompt for these separately.</p>

<p>luks-kill-slot luks-kill-slot device keyslot</p>

<p>This command deletes the key in key slot
&quot;keyslot&quot; from the encrypted LUKS device
&quot;device&quot;. &quot;key&quot; must be one of the other
keys.</p>

<p>This command has one or more key or passphrase
parameters. Guestfish will prompt for these separately.</p>

<p>luks-open luks-open device mapname</p>

<p>This command opens a block device which has been
encrypted according to the Linux Unified Key Setup (LUKS)
standard.</p>

<p>&quot;device&quot; is the encrypted block device or
partition.</p>

<p>The caller must supply one of the keys associated with
the LUKS block device, in the &quot;key&quot; parameter.</p>

<p>This creates a new block device called
&quot;/dev/mapper/mapname&quot;. Reads and writes to this
block device are decrypted from and encrypted to the
underlying &quot;device&quot; respectively.</p>

<p>If this block device contains LVM volume groups, then
calling &quot;vgscan&quot; followed by
&quot;vg-activate-all&quot; will make them visible.</p>

<p>Use &quot;list-dm-devices&quot; to list all device
mapper devices.</p>

<p>This command has one or more key or passphrase
parameters. Guestfish will prompt for these separately.</p>

<p>luks-open-ro luks-open-ro device mapname</p>

<p>This is the same as &quot;luks-open&quot; except that a
read-only mapping is created.</p>

<p>This command has one or more key or passphrase
parameters. Guestfish will prompt for these separately.</p>

<p>lvcreate lvcreate logvol volgroup mbytes</p>

<p>This creates an LVM logical volume called
&quot;logvol&quot; on the volume group &quot;volgroup&quot;,
with &quot;size&quot; megabytes.</p>

<p>lvm-canonical-lv-name lvm-canonical-lv-name lvname</p>

<p>This converts alternative naming schemes for LVs that
you might find to the canonical name. For example,
&quot;/dev/mapper/VG-LV&quot; is converted to
&quot;/dev/VG/LV&quot;.</p>

<p>This command returns an error if the &quot;lvname&quot;
parameter does not refer to a logical volume.</p>

<p>See also &quot;is-lv&quot;.</p>

<p>lvm-clear-filter lvm-clear-filter</p>

<p>This undoes the effect of &quot;lvm-set-filter&quot;.
LVM will be able to see every block device.</p>

<p>This command also clears the LVM cache and performs a
volume group scan.</p>

<p>lvm-remove-all lvm-remove-all</p>

<p>This command removes all LVM logical volumes, volume
groups and physical volumes.</p>

<p>lvm-set-filter lvm-set-filter &rsquo;devices
...&rsquo;</p>

<p>This sets the LVM device filter so that LVM will only be
able to &quot;see&quot; the block devices in the list
&quot;devices&quot;, and will ignore all other attached
block devices.</p>

<p>Where disk image(s) contain duplicate PVs or VGs, this
command is useful to get LVM to ignore the duplicates,
otherwise LVM can get confused. Note also there are two
types of duplication possible: either cloned PVs/VGs which
have identical UUIDs; or VGs that are not cloned but just
happen to have the same name. In normal operation you cannot
create this situation, but you can do it outside LVM, eg. by
cloning disk images or by bit twiddling inside the LVM
metadata.</p>

<p>This command also clears the LVM cache and performs a
volume group scan.</p>

<p>You can filter whole block devices or individual
partitions.</p>

<p>You cannot use this if any VG is currently in use (eg.
contains a mounted filesystem), even if you are not
filtering out that VG.</p>

<p>lvremove lvremove device</p>

<p>Remove an LVM logical volume &quot;device&quot;, where
&quot;device&quot; is the path to the LV, such as
&quot;/dev/VG/LV&quot;.</p>

<p>You can also remove all LVs in a volume group by
specifying the VG name, &quot;/dev/VG&quot;.</p>

<p>lvrename lvrename logvol newlogvol</p>

<p>Rename a logical volume &quot;logvol&quot; with the new
name &quot;newlogvol&quot;.</p>

<p>lvresize lvresize device mbytes</p>

<p>This resizes (expands or shrinks) an existing LVM
logical volume to &quot;mbytes&quot;. When reducing, data in
the reduced part is lost.</p>

<p>lvresize-free lvresize-free lv percent</p>

<p>This expands an existing logical volume &quot;lv&quot;
so that it fills &quot;pc&quot;% of the remaining free space
in the volume group. Commonly you would call this with pc =
100 which expands the logical volume as much as possible,
using all remaining free space in the volume group.</p>

<p>lvs lvs</p>

<p>List all the logical volumes detected. This is the
equivalent of the lvs(8) command.</p>

<p>This returns a list of the logical volume device names
(eg. &quot;/dev/VolGroup00/LogVol00&quot;).</p>

<p>See also &quot;lvs-full&quot;,
&quot;list-filesystems&quot;.</p>

<p>lvs-full lvs-full</p>

<p>List all the logical volumes detected. This is the
equivalent of the lvs(8) command. The &quot;full&quot;
version includes all fields.</p>

<p>lvuuid lvuuid device</p>

<p>This command returns the UUID of the LVM LV
&quot;device&quot;.</p>

<p>lxattrlist lxattrlist path &rsquo;names ...&rsquo;</p>

<p>This call allows you to get the extended attributes of
multiple files, where all files are in the directory
&quot;path&quot;. &quot;names&quot; is the list of files
from this directory.</p>

<p>On return you get a flat list of xattr structs which
must be interpreted sequentially. The first xattr struct
always has a zero- length &quot;attrname&quot;.
&quot;attrval&quot; in this struct is zero-length to
indicate there was an error doing &quot;lgetxattr&quot; for
this file, or is a C string which is a decimal number (the
number of following attributes for this file, which could be
&quot;0&quot;). Then after the first xattr struct are the
zero or more attributes for the first named file. This
repeats for the second and subsequent files.</p>

<p>This call is intended for programs that want to
efficiently list a directory contents without making many
round-trips. See also &quot;lstatlist&quot; for a similarly
efficient call for getting standard stats. Very long
directory listings might cause the protocol message size to
be exceeded, causing this call to fail. The caller must
split up such requests into smaller groups of names.</p>

<p>md-create md-create name &rsquo;devices ...&rsquo;
[missingbitmap:N] [nrdevices:N] [spare:N] [chunk:N]
[level:..]</p>

<p>Create a Linux md (RAID) device named &quot;name&quot;
on the devices in the list &quot;devices&quot;.</p>

<p>The optional parameters are:</p>

<p>&quot;missingbitmap&quot; A bitmap of missing devices.
If a bit is set it means that a missing device is added to
the array. The least significant bit corresponds to the
first device in the array.</p>

<p>As examples:</p>

<p>If &quot;devices = [&quot;/dev/sda&quot;]&quot; and
&quot;missingbitmap = 0x1&quot; then the resulting array
would be &quot;[&lt;missing&gt;,
&quot;/dev/sda&quot;]&quot;.</p>

<p>If &quot;devices = [&quot;/dev/sda&quot;]&quot; and
&quot;missingbitmap = 0x2&quot; then the resulting array
would be &quot;[&quot;/dev/sda&quot;,
&lt;missing&gt;]&quot;.</p>

<p>This defaults to 0 (no missing devices).</p>

<p>The length of &quot;devices&quot; + the number of bits
set in &quot;missingbitmap&quot; must equal
&quot;nrdevices&quot; + &quot;spare&quot;.</p>

<p>&quot;nrdevices&quot; The number of active RAID
devices.</p>

<p>If not set, this defaults to the length of
&quot;devices&quot; plus the number of bits set in
&quot;missingbitmap&quot;.</p>

<p>&quot;spare&quot; The number of spare devices.</p>

<p>If not set, this defaults to 0.</p>

<p>&quot;chunk&quot; The chunk size in bytes.</p>

<p>&quot;level&quot; The RAID level, which can be one of:
linear, raid0, 0, stripe, raid1, 1, mirror, raid4, 4, raid5,
5, raid6, 6, raid10, 10. Some of these are synonymous, and
more levels may be added in future.</p>

<p>If not set, this defaults to &quot;raid1&quot;.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>md-detail md-detail md</p>

<p>This command exposes the output of mdadm -DY &lt;md&gt;
. The following fields are usually present in the returned
hash. Other fields may also be present.</p>

<p>&quot;level&quot; The raid level of the MD device.</p>

<p>&quot;devices&quot; The number of underlying devices in
the MD device.</p>

<p>&quot;metadata&quot; The metadata version used.</p>

<p>&quot;uuid&quot; The UUID of the MD device.</p>

<p>&quot;name&quot; The name of the MD device.</p>

<p>md-stop md-stop md</p>

<p>This command deactivates the MD array named
&quot;md&quot;. The device is stopped, but it is not
destroyed or zeroed.</p>

<p>mkdir mkdir path</p>

<p>Create a directory named &quot;path&quot;.</p>

<p>mkdir-mode mkdir-mode path mode</p>

<p>This command creates a directory, setting the initial
permissions of the directory to &quot;mode&quot;.</p>

<p>For common Linux filesystems, the actual mode which is
set will be &quot;mode &amp; ~umask &amp; 01777&quot;.
Non-native-Linux filesystems may interpret the mode in other
ways.</p>

<p>See also &quot;mkdir&quot;, &quot;umask&quot;</p>

<p>mkdir-p mkdir-p path</p>

<p>Create a directory named &quot;path&quot;, creating any
parent directories as necessary. This is like the
&quot;mkdir -p&quot; shell command.</p>

<p>mkdtemp mkdtemp tmpl</p>

<p>This command creates a temporary directory. The
&quot;tmpl&quot; parameter should be a full pathname for the
temporary directory name with the final six characters being
&quot;XXXXXX&quot;.</p>

<p>For example: &quot;/tmp/myprogXXXXXX&quot; or
&quot;/Temp/myprogXXXXXX&quot;, the second one being
suitable for Windows filesystems.</p>

<p>The name of the temporary directory that was created is
returned.</p>

<p>The temporary directory is created with mode 0700 and is
owned by root.</p>

<p>The caller is responsible for deleting the temporary
directory and its contents after use.</p>

<p>See also: mkdtemp(3)</p>

<p>mke2fs-J mke2fs-J fstype blocksize device journal</p>

<p>This creates an ext2/3/4 filesystem on
&quot;device&quot; with an external journal on
&quot;journal&quot;. It is equivalent to the command:</p>

<p>mke2fs -t fstype -b blocksize -J device=&lt;journal&gt;
&lt;device&gt;</p>

<p>See also &quot;mke2journal&quot;.</p>

<p>mke2fs-JL mke2fs-JL fstype blocksize device label</p>

<p>This creates an ext2/3/4 filesystem on
&quot;device&quot; with an external journal on the journal
labeled &quot;label&quot;.</p>

<p>See also &quot;mke2journal-L&quot;.</p>

<p>mke2fs-JU mke2fs-JU fstype blocksize device uuid</p>

<p>This creates an ext2/3/4 filesystem on
&quot;device&quot; with an external journal on the journal
with UUID &quot;uuid&quot;.</p>

<p>See also &quot;mke2journal-U&quot;.</p>

<p>mke2journal mke2journal blocksize device</p>

<p>This creates an ext2 external journal on
&quot;device&quot;. It is equivalent to the command:</p>

<p>mke2fs -O journal_dev -b blocksize device</p>

<p>mke2journal-L mke2journal-L blocksize label device</p>

<p>This creates an ext2 external journal on
&quot;device&quot; with label &quot;label&quot;.</p>

<p>mke2journal-U mke2journal-U blocksize uuid device</p>

<p>This creates an ext2 external journal on
&quot;device&quot; with UUID &quot;uuid&quot;.</p>

<p>mkfifo mkfifo mode path</p>

<p>This call creates a FIFO (named pipe) called
&quot;path&quot; with mode &quot;mode&quot;. It is just a
convenient wrapper around &quot;mknod&quot;.</p>

<p>The mode actually set is affected by the umask.</p>

<p>mkfs mkfs fstype device</p>

<p>This creates a filesystem on &quot;device&quot; (usually
a partition or LVM logical volume). The filesystem type is
&quot;fstype&quot;, for example &quot;ext3&quot;.</p>

<p>mkfs-b mkfs-b fstype blocksize device</p>

<p>This call is similar to &quot;mkfs&quot;, but it allows
you to control the block size of the resulting filesystem.
Supported block sizes depend on the filesystem type, but
typically they are 1024, 2048 or 4096 only.</p>

<p>For VFAT and NTFS the &quot;blocksize&quot; parameter is
treated as the requested cluster size.</p>

<p>This function is deprecated. In new code, use the
&quot;mkfs_opts&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>mkfs-opts mkfs-opts fstype device [blocksize:N]
[features:..] [inode:N] [sectorsize:N]</p>

<p>This function creates a filesystem on
&quot;device&quot;. The filesystem type is
&quot;fstype&quot;, for example &quot;ext3&quot;.</p>

<p>The optional arguments are:</p>

<p>&quot;blocksize&quot; The filesystem block size.
Supported block sizes depend on the filesystem type, but
typically they are 1024, 2048 or 4096 for Linux ext2/3
filesystems.</p>

<p>For VFAT and NTFS the &quot;blocksize&quot; parameter is
treated as the requested cluster size.</p>

<p>For UFS block sizes, please see mkfs.ufs(8).</p>

<p>&quot;features&quot; This passes the -O parameter to the
external mkfs program.</p>

<p>For certain filesystem types, this allows extra
filesystem features to be selected. See mke2fs(8) and
mkfs.ufs(8) for more details.</p>

<p>You cannot use this optional parameter with the
&quot;gfs&quot; or &quot;gfs2&quot; filesystem type.</p>

<p>&quot;inode&quot; This passes the -I parameter to the
external mke2fs(8) program which sets the inode size (only
for ext2/3/4 filesystems at present).</p>

<p>&quot;sectorsize&quot; This passes the -S parameter to
external mkfs.ufs(8) program, which sets sector size for ufs
filesystem.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>mkmountpoint mkmountpoint exemptpath</p>

<p>&quot;mkmountpoint&quot; and &quot;rmmountpoint&quot;
are specialized calls that can be used to create extra
mountpoints before mounting the first filesystem.</p>

<p>These calls are only necessary in some very limited
circumstances, mainly the case where you want to mount a mix
of unrelated and/or read- only filesystems together.</p>

<p>For example, live CDs often contain a &quot;Russian
doll&quot; nest of filesystems, an ISO outer layer, with a
squashfs image inside, with an ext2/3 image inside that. You
can unpack this as follows in guestfish:</p>

<p>add-ro Fedora-11-i686-Live.iso run mkmountpoint /cd
mkmountpoint /sqsh mkmountpoint /ext3fs mount /dev/sda /cd
mount-loop /cd/LiveOS/squashfs.img /sqsh mount-loop
/sqsh/LiveOS/ext3fs.img /ext3fs</p>

<p>The inner filesystem is now unpacked under the /ext3fs
mountpoint.</p>

<p>&quot;mkmountpoint&quot; is not compatible with
&quot;umount-all&quot;. You may get unexpected errors if you
try to mix these calls. It is safest to manually unmount
filesystems and remove mountpoints after use.</p>

<p>&quot;umount-all&quot; unmounts filesystems by sorting
the paths longest first, so for this to work for manual
mountpoints, you must ensure that the innermost mountpoints
have the longest pathnames, as in the example code
above.</p>

<p>For more details see
&lt;https://bugzilla.redhat.com/show_bug.cgi?id=599503&gt;</p>

<p>Autosync [see &quot;set-autosync&quot;, this is set by
default on handles] can cause &quot;umount-all&quot; to be
called when the handle is closed which can also trigger
these issues.</p>

<p>mknod mknod mode devmajor devminor path</p>

<p>This call creates block or character special devices, or
named pipes (FIFOs).</p>

<p>The &quot;mode&quot; parameter should be the mode, using
the standard constants. &quot;devmajor&quot; and
&quot;devminor&quot; are the device major and minor numbers,
only used when creating block and character special
devices.</p>

<p>Note that, just like mknod(2), the mode must be bitwise
OR d with S_IFBLK, S_IFCHR, S_IFIFO or S_IFSOCK (otherwise
this call just creates a regular file). These constants are
available in the standard Linux header files, or you can use
&quot;mknod-b&quot;, &quot;mknod-c&quot; or
&quot;mkfifo&quot; which are wrappers around this command
which bitwise OR in the appropriate constant for you.</p>

<p>The mode actually set is affected by the umask.</p>

<p>mknod-b mknod-b mode devmajor devminor path</p>

<p>This call creates a block device node called
&quot;path&quot; with mode &quot;mode&quot; and device
major/minor &quot;devmajor&quot; and &quot;devminor&quot;.
It is just a convenient wrapper around
&quot;mknod&quot;.</p>

<p>The mode actually set is affected by the umask.</p>

<p>mknod-c mknod-c mode devmajor devminor path</p>

<p>This call creates a char device node called
&quot;path&quot; with mode &quot;mode&quot; and device
major/minor &quot;devmajor&quot; and &quot;devminor&quot;.
It is just a convenient wrapper around
&quot;mknod&quot;.</p>

<p>The mode actually set is affected by the umask.</p>

<p>mkswap mkswap device</p>

<p>Create a swap partition on &quot;device&quot;.</p>

<p>mkswap-L mkswap-L label device</p>

<p>Create a swap partition on &quot;device&quot; with label
&quot;label&quot;.</p>

<p>Note that you cannot attach a swap label to a block
device (eg. &quot;/dev/sda&quot;), just to a partition. This
appears to be a limitation of the kernel or swap tools.</p>

<p>mkswap-U mkswap-U uuid device</p>

<p>Create a swap partition on &quot;device&quot; with UUID
&quot;uuid&quot;.</p>

<p>mkswap-file mkswap-file path</p>

<p>Create a swap file.</p>

<p>This command just writes a swap file signature to an
existing file. To create the file itself, use something like
&quot;fallocate&quot;.</p>

<p>modprobe modprobe modulename</p>

<p>This loads a kernel module in the appliance.</p>

<p>The kernel module must have been whitelisted when
libguestfs was built (see
&quot;appliance/kmod.whitelist.in&quot; in the source).</p>

<p>mount mount device mountpoint</p>

<p>Mount a guest disk at a position in the filesystem.
Block devices are named &quot;/dev/sda&quot;,
&quot;/dev/sdb&quot; and so on, as they were added to the
guest. If those block devices contain partitions, they will
have the usual names (eg. &quot;/dev/sda1&quot;). Also LVM
&quot;/dev/VG/LV&quot;-style names can be used.</p>

<p>The rules are the same as for mount(2): A filesystem
must first be mounted on &quot;/&quot; before others can be
mounted. Other filesystems can only be mounted on
directories which already exist.</p>

<p>The mounted filesystem is writable, if we have
sufficient permissions on the underlying device.</p>

<p>Before libguestfs 1.13.16, this call implicitly added
the options &quot;sync&quot; and &quot;noatime&quot;. The
&quot;sync&quot; option greatly slowed writes and caused
many problems for users. If your program might need to work
with older versions of libguestfs, use
&quot;mount-options&quot; instead (using an empty string for
the first parameter if you don t want any options).</p>

<p>mount-9p mount-9p mounttag mountpoint [options:..]</p>

<p>Mount the virtio-9p filesystem with the tag
&quot;mounttag&quot; on the directory
&quot;mountpoint&quot;.</p>

<p>If required, &quot;trans=virtio&quot; will be
automatically added to the options. Any other options
required can be passed in the optional &quot;options&quot;
parameter.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>mount-loop mount-loop file mountpoint</p>

<p>This command lets you mount &quot;file&quot; (a
filesystem image in a file) on a mount point. It is entirely
equivalent to the command &quot;mount -o loop file
mountpoint&quot;.</p>

<p>mount-options mount-options options device
mountpoint</p>

<p>This is the same as the &quot;mount&quot; command, but
it allows you to set the mount options as for the mount(8)
-o flag.</p>

<p>If the &quot;options&quot; parameter is an empty string,
then no options are passed (all options default to whatever
the filesystem uses).</p>

<p>mount-ro mount-ro device mountpoint</p>

<p>This is the same as the &quot;mount&quot; command, but
it mounts the filesystem with the read-only (-o ro)
flag.</p>

<p>mount-vfs mount-vfs options vfstype device
mountpoint</p>

<p>This is the same as the &quot;mount&quot; command, but
it allows you to set both the mount options and the vfstype
as for the mount(8) -o and -t flags.</p>

<p>mountpoints mountpoints</p>

<p>This call is similar to &quot;mounts&quot;. That call
returns a list of devices. This one returns a hash table
(map) of device name to directory where the device is
mounted.</p>

<p>mounts mounts</p>

<p>This returns the list of currently mounted filesystems.
It returns the list of devices (eg. &quot;/dev/sda1&quot;,
&quot;/dev/VG/LV&quot;).</p>

<p>Some internal mounts are not shown.</p>

<p>See also: &quot;mountpoints&quot;</p>

<p>mv mv src dest</p>

<p>This moves a file from &quot;src&quot; to
&quot;dest&quot; where &quot;dest&quot; is either a
destination filename or destination directory.</p>

<p>ntfs-3g-probe ntfs-3g-probe true|false device</p>

<p>This command runs the ntfs-3g.probe(8) command which
probes an NTFS &quot;device&quot; for mountability. (Not all
NTFS volumes can be mounted read- write, and some cannot be
mounted at all).</p>

<p>&quot;rw&quot; is a boolean flag. Set it to true if you
want to test if the volume can be mounted read-write. Set it
to false if you want to test if the volume can be mounted
read-only.</p>

<p>The return value is an integer which 0 if the operation
would succeed, or some non-zero value documented in the
ntfs-3g.probe(8) manual page.</p>

<p>ntfsresize ntfsresize device</p>

<p>This command resizes an NTFS filesystem, expanding or
shrinking it to the size of the underlying device.</p>

<p>Note: After the resize operation, the filesystem is
marked as requiring a consistency check (for safety). You
have to boot into Windows to perform this check and clear
this condition. Furthermore, ntfsresize refuses to resize
filesystems which have been marked in this way. So in effect
it is not possible to call ntfsresize multiple times on a
single filesystem without booting into Windows between each
resize.</p>

<p>See also ntfsresize(8).</p>

<p>This function is deprecated. In new code, use the
&quot;ntfsresize_opts&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>ntfsresize-opts ntfsresize-opts device [size:N]
[force:true|false]</p>

<p>This command resizes an NTFS filesystem, expanding or
shrinking it to the size of the underlying device.</p>

<p>The optional parameters are:</p>

<p>&quot;size&quot; The new size (in bytes) of the
filesystem. If omitted, the filesystem is resized to fit the
container (eg. partition).</p>

<p>&quot;force&quot; If this option is true, then force the
resize of the filesystem even if the filesystem is marked as
requiring a consistency check.</p>

<p>After the resize operation, the filesystem is always
marked as requiring a consistency check (for safety). You
have to boot into Windows to perform this check and clear
this condition. If you dont set the &quot;force&quot; option
then it is not possible to call &quot;ntfsresize-opts&quot;
multiple times on a single filesystem without booting into
Windows between each resize.</p>

<p>See also ntfsresize(8).</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>ntfsresize-size ntfsresize-size device size</p>

<p>This command is the same as &quot;ntfsresize&quot;
except that it allows you to specify the new size (in bytes)
explicitly.</p>

<p>This function is deprecated. In new code, use the
&quot;ntfsresize_opts&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>part-add part-add device prlogex startsect endsect</p>

<p>This command adds a partition to &quot;device&quot;. If
there is no partition table on the device, call
&quot;part-init&quot; first.</p>

<p>The &quot;prlogex&quot; parameter is the type of
partition. Normally you should pass &quot;p&quot; or
&quot;primary&quot; here, but MBR partition tables also
support &quot;l&quot; (or &quot;logical&quot;) and
&quot;e&quot; (or &quot;extended&quot;) partition types.</p>

<p>&quot;startsect&quot; and &quot;endsect&quot; are the
start and end of the partition in sectors.
&quot;endsect&quot; may be negative, which means it counts
backwards from the end of the disk (&quot;-1&quot; is the
last sector).</p>

<p>Creating a partition which covers the whole disk is not
so easy. Use &quot;part-disk&quot; to do that.</p>

<p>part-del part-del device partnum</p>

<p>This command deletes the partition numbered
&quot;partnum&quot; on &quot;device&quot;.</p>

<p>Note that in the case of MBR partitioning, deleting an
extended partition also deletes any logical partitions it
contains.</p>

<p>part-disk part-disk device parttype</p>

<p>This command is simply a combination of
&quot;part-init&quot; followed by &quot;part- add&quot; to
create a single primary partition covering the whole
disk.</p>

<p>&quot;parttype&quot; is the partition table type,
usually &quot;mbr&quot; or &quot;gpt&quot;, but other
possible values are described in &quot;part-init&quot;.</p>

<p>part-get-bootable part-get-bootable device partnum</p>

<p>This command returns true if the partition
&quot;partnum&quot; on &quot;device&quot; has the bootable
flag set.</p>

<p>See also &quot;part-set-bootable&quot;.</p>

<p>part-get-mbr-id part-get-mbr-id device partnum</p>

<p>Returns the MBR type byte (also known as the ID byte)
from the numbered partition &quot;partnum&quot;.</p>

<p>Note that only MBR (old DOS-style) partitions have type
bytes. You will get undefined results for other partition
table types (see &quot;part- get-parttype&quot;).</p>

<p>part-get-parttype part-get-parttype device</p>

<p>This command examines the partition table on
&quot;device&quot; and returns the partition table type
(format) being used.</p>

<p>Common return values include: &quot;msdos&quot; (a
DOS/Windows style MBR partition table), &quot;gpt&quot; (a
GPT/EFI-style partition table). Other values are possible,
although unusual. See &quot;part-init&quot; for a full
list.</p>

<p>part-init part-init device parttype</p>

<p>This creates an empty partition table on
&quot;device&quot; of one of the partition types listed
below. Usually &quot;parttype&quot; should be either
&quot;msdos&quot; or &quot;gpt&quot; (for large disks).</p>

<p>Initially there are no partitions. Following this, you
should call &quot;part-add&quot; for each partition
required.</p>

<p>Possible values for &quot;parttype&quot; are:</p>

<p>efi gpt Intel EFI / GPT partition table.</p>

<p>This is recommended for &gt;= 2 TB partitions that will
be accessed from Linux and Intel-based Mac OS X. It also has
limited backwards compatibility with the &quot;mbr&quot;
format.</p>

<p>mbr msdos The standard PC &quot;Master Boot Record&quot;
(MBR) format used by MS-DOS and Windows. This partition type
will only work for device sizes up to 2 TB. For large disks
we recommend using &quot;gpt&quot;.</p>

<p>Other partition table types that may work but are not
supported include:</p>

<p>aix AIX disk labels.</p>

<p>amiga rdb Amiga &quot;Rigid Disk Block&quot; format.</p>

<p>bsd BSD disk labels.</p>

<p>dasd DASD, used on IBM mainframes.</p>

<p>dvh MIPS/SGI volumes.</p>

<p>mac Old Mac partition format. Modern Macs use
&quot;gpt&quot;.</p>

<p>pc98 NEC PC-98 format, common in Japan apparently.</p>

<p>sun Sun disk labels.</p>

<p>part-list part-list device</p>

<p>This command parses the partition table on
&quot;device&quot; and returns the list of partitions
found.</p>

<p>The fields in the returned structure are:</p>

<p>part_num Partition number, counting from 1.</p>

<p>part_start Start of the partition in bytes. To get
sectors you have to divide by the devices sector size, see
&quot;blockdev-getss&quot;.</p>

<p>part_end End of the partition in bytes.</p>

<p>part_size Size of the partition in bytes.</p>

<p>part-set-bootable part-set-bootable device partnum
true|false</p>

<p>This sets the bootable flag on partition numbered
&quot;partnum&quot; on device &quot;device&quot;. Note that
partitions are numbered from 1.</p>

<p>The bootable flag is used by some operating systems
(notably Windows) to determine which partition to boot from.
It is by no means universally recognized.</p>

<p>part-set-mbr-id part-set-mbr-id device partnum
idbyte</p>

<p>Sets the MBR type byte (also known as the ID byte) of
the numbered partition &quot;partnum&quot; to
&quot;idbyte&quot;. Note that the type bytes quoted in most
documentation are in fact hexadecimal numbers, but usually
documented without any leading &quot;0x&quot; which might be
confusing.</p>

<p>Note that only MBR (old DOS-style) partitions have type
bytes. You will get undefined results for other partition
table types (see &quot;part- get-parttype&quot;).</p>

<p>part-set-name part-set-name device partnum name</p>

<p>This sets the partition name on partition numbered
&quot;partnum&quot; on device &quot;device&quot;. Note that
partitions are numbered from 1.</p>

<p>The partition name can only be set on certain types of
partition table. This works on &quot;gpt&quot; but not on
&quot;mbr&quot; partitions.</p>

<p>part-to-dev part-to-dev partition</p>

<p>This function takes a partition name (eg.
&quot;/dev/sdb1&quot;) and removes the partition number,
returning the device name (eg. &quot;/dev/sdb&quot;).</p>

<p>The named partition must exist, for example as a string
returned from &quot;list-partitions&quot;.</p>

<p>See also &quot;part-to-partnum&quot;.</p>

<p>part-to-partnum part-to-partnum partition</p>

<p>This function takes a partition name (eg.
&quot;/dev/sdb1&quot;) and returns the partition number (eg.
1).</p>

<p>The named partition must exist, for example as a string
returned from &quot;list-partitions&quot;.</p>

<p>See also &quot;part-to-dev&quot;.</p>

<p>ping-daemon ping-daemon</p>

<p>This is a test probe into the guestfs daemon running
inside the qemu subprocess. Calling this function checks
that the daemon responds to the ping message, without
affecting the daemon or attached block device(s) in any
other way.</p>

<p>pread pread path count offset</p>

<p>This command lets you read part of a file. It reads
&quot;count&quot; bytes of the file, starting at
&quot;offset&quot;, from file &quot;path&quot;.</p>

<p>This may read fewer bytes than requested. For further
details see the pread(2) system call.</p>

<p>See also &quot;pwrite&quot;,
&quot;pread-device&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>pread-device pread-device device count offset</p>

<p>This command lets you read part of a file. It reads
&quot;count&quot; bytes of &quot;device&quot;, starting at
&quot;offset&quot;.</p>

<p>This may read fewer bytes than requested. For further
details see the pread(2) system call.</p>

<p>See also &quot;pread&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>pvcreate pvcreate device</p>

<p>This creates an LVM physical volume on the named
&quot;device&quot;, where &quot;device&quot; should usually
be a partition name such as &quot;/dev/sda1&quot;.</p>

<p>pvremove pvremove device</p>

<p>This wipes a physical volume &quot;device&quot; so that
LVM will no longer recognise it.</p>

<p>The implementation uses the &quot;pvremove&quot; command
which refuses to wipe physical volumes that contain any
volume groups, so you have to remove those first.</p>

<p>pvresize pvresize device</p>

<p>This resizes (expands or shrinks) an existing LVM
physical volume to match the new size of the underlying
device.</p>

<p>pvresize-size pvresize-size device size</p>

<p>This command is the same as &quot;pvresize&quot; except
that it allows you to specify the new size (in bytes)
explicitly.</p>

<p>pvs pvs</p>

<p>List all the physical volumes detected. This is the
equivalent of the pvs(8) command.</p>

<p>This returns a list of just the device names that
contain PVs (eg. &quot;/dev/sda2&quot;).</p>

<p>See also &quot;pvs-full&quot;.</p>

<p>pvs-full pvs-full</p>

<p>List all the physical volumes detected. This is the
equivalent of the pvs(8) command. The &quot;full&quot;
version includes all fields.</p>

<p>pvuuid pvuuid device</p>

<p>This command returns the UUID of the LVM PV
&quot;device&quot;.</p>

<p>pwrite pwrite path content offset</p>

<p>This command writes to part of a file. It writes the
data buffer &quot;content&quot; to the file &quot;path&quot;
starting at offset &quot;offset&quot;.</p>

<p>This command implements the pwrite(2) system call, and
like that system call it may not write the full data
requested. The return value is the number of bytes that were
actually written to the file. This could even be 0, although
short writes are unlikely for regular files in ordinary
circumstances.</p>

<p>See also &quot;pread&quot;,
&quot;pwrite-device&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>pwrite-device pwrite-device device content offset</p>

<p>This command writes to part of a device. It writes the
data buffer &quot;content&quot; to &quot;device&quot;
starting at offset &quot;offset&quot;.</p>

<p>This command implements the pwrite(2) system call, and
like that system call it may not write the full data
requested (although short writes to disk devices and
partitions are probably impossible with standard Linux
kernels).</p>

<p>See also &quot;pwrite&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>read-file read-file path</p>

<p>This calls returns the contents of the file
&quot;path&quot; as a buffer.</p>

<p>Unlike &quot;cat&quot;, this function can correctly
handle files that contain embedded ASCII NUL characters.
However unlike &quot;download&quot;, this function is
limited in the total size of file that can be handled.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>read-lines read-lines path</p>

<p>Return the contents of the file named
&quot;path&quot;.</p>

<p>The file contents are returned as a list of lines.
Trailing &quot;LF&quot; and &quot;CRLF&quot; character
sequences are not returned.</p>

<p>Note that this function cannot correctly handle binary
files (specifically, files containing &quot; &quot;
character which is treated as end of line). For those you
need to use the &quot;read-file&quot; function which has a
more complex interface.</p>

<p>readdir readdir dir</p>

<p>This returns the list of directory entries in directory
&quot;dir&quot;.</p>

<p>All entries in the directory are returned, including
&quot;.&quot; and &quot;..&quot;. The entries are not
sorted, but returned in the same order as the underlying
filesystem.</p>

<p>Also this call returns basic file type information about
each file. The &quot;ftyp&quot; field will contain one of
the following characters:</p>

<p>b Block special</p>

<p>c Char special</p>

<p>d Directory</p>

<p>f FIFO (named pipe)</p>

<p>l Symbolic link</p>

<p>r Regular file</p>

<p>s Socket</p>

<p>u Unknown file type</p>

<p>? The readdir(3) call returned a &quot;d_type&quot;
field with an unexpected value</p>

<p>This function is primarily intended for use by programs.
To get a simple list of names, use &quot;ls&quot;. To get a
printable directory for human consumption, use
&quot;ll&quot;.</p>

<p>readlink readlink path</p>

<p>This command reads the target of a symbolic link.</p>

<p>readlinklist readlinklist path &rsquo;names
...&rsquo;</p>

<p>This call allows you to do a &quot;readlink&quot;
operation on multiple files, where all files are in the
directory &quot;path&quot;. &quot;names&quot; is the list of
files from this directory.</p>

<p>On return you get a list of strings, with a one-to-one
correspondence to the &quot;names&quot; list. Each string is
the value of the symbolic link.</p>

<p>If the readlink(2) operation fails on any name, then the
corresponding result string is the empty string
&quot;&quot;. However the whole operation is completed even
if there were readlink(2) errors, and so you can call this
function with names where you dont know if they are symbolic
links already (albeit slightly less efficient).</p>

<p>This call is intended for programs that want to
efficiently list a directory contents without making many
round-trips. Very long directory listings might cause the
protocol message size to be exceeded, causing this call to
fail. The caller must split up such requests into smaller
groups of names.</p>

<p>realpath realpath path</p>

<p>Return the canonicalized absolute pathname of
&quot;path&quot;. The returned path has no &quot;.&quot;,
&quot;..&quot; or symbolic link path elements.</p>

<p>removexattr removexattr xattr path</p>

<p>This call removes the extended attribute named
&quot;xattr&quot; of the file &quot;path&quot;.</p>

<p>See also: &quot;lremovexattr&quot;, attr(5).</p>

<p>resize2fs resize2fs device</p>

<p>This resizes an ext2, ext3 or ext4 filesystem to match
the size of the underlying device.</p>

<p>Note: It is sometimes required that you run
&quot;e2fsck-f&quot; on the &quot;device&quot; before
calling this command. For unknown reasons
&quot;resize2fs&quot; sometimes gives an error about this
and sometimes not. In any case, it is always safe to call
&quot;e2fsck-f&quot; before calling this function.</p>

<p>resize2fs-M resize2fs-M device</p>

<p>This command is the same as &quot;resize2fs&quot;, but
the filesystem is resized to its minimum size. This works
like the -M option to the &quot;resize2fs&quot; command.</p>

<p>To get the resulting size of the filesystem you should
call &quot;tune2fs-l&quot; and read the &quot;Block
size&quot; and &quot;Block count&quot; values. These two
numbers, multiplied together, give the resulting size of the
minimal filesystem in bytes.</p>

<p>resize2fs-size resize2fs-size device size</p>

<p>This command is the same as &quot;resize2fs&quot; except
that it allows you to specify the new size (in bytes)
explicitly.</p>

<p>rm rm path</p>

<p>Remove the single file &quot;path&quot;.</p>

<p>rm-rf rm-rf path</p>

<p>Remove the file or directory &quot;path&quot;,
recursively removing the contents if its a directory. This
is like the &quot;rm -rf&quot; shell command.</p>

<p>rmdir rmdir path</p>

<p>Remove the single directory &quot;path&quot;.</p>

<p>rmmountpoint rmmountpoint exemptpath</p>

<p>This calls removes a mountpoint that was previously
created with &quot;mkmountpoint&quot;. See
&quot;mkmountpoint&quot; for full details.</p>

<p>scrub-device scrub-device device</p>

<p>This command writes patterns over &quot;device&quot; to
make data retrieval more difficult.</p>

<p>It is an interface to the scrub(1) program. See that
manual page for more details.</p>

<p>scrub-file scrub-file file</p>

<p>This command writes patterns over a file to make data
retrieval more difficult.</p>

<p>The file is removed after scrubbing.</p>

<p>It is an interface to the scrub(1) program. See that
manual page for more details.</p>

<p>scrub-freespace scrub-freespace dir</p>

<p>This command creates the directory &quot;dir&quot; and
then fills it with files until the filesystem is full, and
scrubs the files as for &quot;scrub-file&quot;, and deletes
them. The intention is to scrub any free space on the
partition containing &quot;dir&quot;.</p>

<p>It is an interface to the scrub(1) program. See that
manual page for more details.</p>

<p>set-append append set-append append</p>

<p>This function is used to add additional options to the
guest kernel command line.</p>

<p>The default is &quot;NULL&quot; unless overridden by
setting &quot;LIBGUESTFS_APPEND&quot; environment
variable.</p>

<p>Setting &quot;append&quot; to &quot;NULL&quot; means no
additional options are passed (libguestfs always adds a few
of its own).</p>

<p>set-attach-method attach-method set-attach-method
attachmethod</p>

<p>Set the method that libguestfs uses to connect to the
back end guestfsd daemon. Possible methods are:</p>

<p>&quot;appliance&quot; Launch an appliance and connect to
it. This is the ordinary method and the default.</p>

<p>&quot;unix:path&quot; Connect to the Unix domain socket
path.</p>

<p>This method lets you connect to an existing daemon or
(using virtio-serial) to a live guest. For more information,
see &quot;ATTACHING TO RUNNING DAEMONS&quot; in
guestfs(3).</p>

<p>set-autosync autosync set-autosync true|false</p>

<p>If &quot;autosync&quot; is true, this enables autosync.
Libguestfs will make a best effort attempt to make
filesystems consistent and synchronized when the handle is
closed (also if the program exits without closing
handles).</p>

<p>This is enabled by default (since libguestfs 1.5.24,
previously it was disabled by default).</p>

<p>set-direct direct set-direct true|false</p>

<p>If the direct appliance mode flag is enabled, then stdin
and stdout are passed directly through to the appliance once
it is launched.</p>

<p>One consequence of this is that log messages arent
caught by the library and handled by
&quot;set-log-message-callback&quot;, but go straight to
stdout.</p>

<p>You probably dont want to use this unless you know what
you are doing.</p>

<p>The default is disabled.</p>

<p>set-e2label set-e2label device label</p>

<p>This sets the ext2/3/4 filesystem label of the
filesystem on &quot;device&quot; to &quot;label&quot;.
Filesystem labels are limited to 16 characters.</p>

<p>You can use either &quot;tune2fs-l&quot; or
&quot;get-e2label&quot; to return the existing label on a
filesystem.</p>

<p>set-e2uuid set-e2uuid device uuid</p>

<p>This sets the ext2/3/4 filesystem UUID of the filesystem
on &quot;device&quot; to &quot;uuid&quot;. The format of the
UUID and alternatives such as &quot;clear&quot;,
&quot;random&quot; and &quot;time&quot; are described in the
tune2fs(8) manpage.</p>

<p>You can use either &quot;tune2fs-l&quot; or
&quot;get-e2uuid&quot; to return the existing UUID of a
filesystem.</p>

<p>set-memsize memsize set-memsize memsize</p>

<p>This sets the memory size in megabytes allocated to the
qemu subprocess. This only has any effect if called before
&quot;launch&quot;.</p>

<p>You can also change this by setting the environment
variable &quot;LIBGUESTFS_MEMSIZE&quot; before the handle is
created.</p>

<p>For more information on the architecture of libguestfs,
see guestfs(3).</p>

<p>set-network network set-network true|false</p>

<p>If &quot;network&quot; is true, then the network is
enabled in the libguestfs appliance. The default is
false.</p>

<p>This affects whether commands are able to access the
network (see &quot;RUNNING COMMANDS&quot; in
guestfs(3)).</p>

<p>You must call this before calling &quot;launch&quot;,
otherwise it has no effect.</p>

<p>set-path path set-path searchpath</p>

<p>Set the path that libguestfs searches for kernel and
initrd.img.</p>

<p>The default is &quot;$libdir/guestfs&quot; unless
overridden by setting &quot;LIBGUESTFS_PATH&quot;
environment variable.</p>

<p>Setting &quot;path&quot; to &quot;NULL&quot; restores
the default path.</p>

<p>set-pgroup pgroup set-pgroup true|false</p>

<p>If &quot;pgroup&quot; is true, child processes are
placed into their own process group.</p>

<p>The practical upshot of this is that signals like
&quot;SIGINT&quot; (from users pressing &quot;^C&quot;) wont
be received by the child process.</p>

<p>The default for this flag is false, because usually you
want &quot;^C&quot; to kill the subprocess. Guestfish sets
this flag to true when used interactively, so that
&quot;^C&quot; can cancel long-running commands gracefully
(see &quot;user-cancel&quot;).</p>

<p>set-qemu qemu set-qemu qemu</p>

<p>Set the qemu binary that we will use.</p>

<p>The default is chosen when the library was compiled by
the configure script.</p>

<p>You can also override this by setting the
&quot;LIBGUESTFS_QEMU&quot; environment variable.</p>

<p>Setting &quot;qemu&quot; to &quot;NULL&quot; restores
the default qemu binary.</p>

<p>Note that you should call this function as early as
possible after creating the handle. This is because some
pre-launch operations depend on testing qemu features (by
running &quot;qemu -help&quot;). If the qemu binary changes,
we dont retest features, and so you might see inconsistent
results. Using the environment variable
&quot;LIBGUESTFS_QEMU&quot; is safest of all since that
picks the qemu binary at the same time as the handle is
created.</p>

<p>set-recovery-proc recovery-proc set-recovery-proc
true|false</p>

<p>If this is called with the parameter &quot;false&quot;
then &quot;launch&quot; does not create a recovery process.
The purpose of the recovery process is to stop runaway qemu
processes in the case where the main program aborts
abruptly.</p>

<p>This only has any effect if called before
&quot;launch&quot;, and the default is true.</p>

<p>About the only time when you would want to disable this
is if the main process will fork itself into the background
(&quot;daemonize&quot; itself). In this case the recovery
process thinks that the main program has disappeared and so
kills qemu, which is not very helpful.</p>

<p>set-selinux selinux set-selinux true|false</p>

<p>This sets the selinux flag that is passed to the
appliance at boot time. The default is &quot;selinux=0&quot;
(disabled).</p>

<p>Note that if SELinux is enabled, it is always in
Permissive mode (&quot;enforcing=0&quot;).</p>

<p>For more information on the architecture of libguestfs,
see guestfs(3).</p>

<p>set-smp smp set-smp smp</p>

<p>Change the number of virtual CPUs assigned to the
appliance. The default is 1. Increasing this may improve
performance, though often it has no effect.</p>

<p>This function must be called before
&quot;launch&quot;.</p>

<p>set-trace trace set-trace true|false</p>

<p>If the command trace flag is set to 1, then libguestfs
calls, parameters and return values are traced.</p>

<p>If you want to trace C API calls into libguestfs (and
other libraries) then possibly a better way is to use the
external ltrace(1) command.</p>

<p>Command traces are disabled unless the environment
variable &quot;LIBGUESTFS_TRACE&quot; is defined and set to
1.</p>

<p>Trace messages are normally sent to &quot;stderr&quot;,
unless you register a callback to send them somewhere else
(see &quot;set-event-callback&quot;).</p>

<p>set-verbose verbose set-verbose true|false</p>

<p>If &quot;verbose&quot; is true, this turns on verbose
messages.</p>

<p>Verbose messages are disabled unless the environment
variable &quot;LIBGUESTFS_DEBUG&quot; is defined and set to
1.</p>

<p>Verbose messages are normally sent to
&quot;stderr&quot;, unless you register a callback to send
them somewhere else (see
&quot;set-event-callback&quot;).</p>

<p>setcon setcon context</p>

<p>This sets the SELinux security context of the daemon to
the string &quot;context&quot;.</p>

<p>See the documentation about SELINUX in guestfs(3).</p>

<p>setxattr setxattr xattr val vallen path</p>

<p>This call sets the extended attribute named
&quot;xattr&quot; of the file &quot;path&quot; to the value
&quot;val&quot; (of length &quot;vallen&quot;). The value is
arbitrary 8 bit data.</p>

<p>See also: &quot;lsetxattr&quot;, attr(5).</p>

<p>sfdisk sfdisk device cyls heads sectors &rsquo;lines
...&rsquo;</p>

<p>This is a direct interface to the sfdisk(8) program for
creating partitions on block devices.</p>

<p>&quot;device&quot; should be a block device, for example
&quot;/dev/sda&quot;.</p>

<p>&quot;cyls&quot;, &quot;heads&quot; and
&quot;sectors&quot; are the number of cylinders, heads and
sectors on the device, which are passed directly to sfdisk
as the -C, -H and -S parameters. If you pass 0 for any of
these, then the corresponding parameter is omitted. Usually
for large disks, you can just pass 0 for these, but for
small (floppy-sized) disks, sfdisk (or rather, the kernel)
cannot work out the right geometry and you will need to tell
it.</p>

<p>&quot;lines&quot; is a list of lines that we feed to
&quot;sfdisk&quot;. For more information refer to the
sfdisk(8) manpage.</p>

<p>To create a single partition occupying the whole disk,
you would pass &quot;lines&quot; as a single element list,
when the single element being the string &quot;,&quot;
(comma).</p>

<p>See also: &quot;sfdisk-l&quot;, &quot;sfdisk-N&quot;,
&quot;part-init&quot;</p>

<p>This function is deprecated. In new code, use the
&quot;part_add&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>sfdiskM sfdiskM device &rsquo;lines ...&rsquo;</p>

<p>This is a simplified interface to the &quot;sfdisk&quot;
command, where partition sizes are specified in megabytes
only (rounded to the nearest cylinder) and you dont need to
specify the cyls, heads and sectors parameters which were
rarely if ever used anyway.</p>

<p>See also: &quot;sfdisk&quot;, the sfdisk(8) manpage and
&quot;part-disk&quot;</p>

<p>This function is deprecated. In new code, use the
&quot;part_add&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>sfdisk-N sfdisk-N device partnum cyls heads sectors
line</p>

<p>This runs sfdisk(8) option to modify just the single
partition &quot;n&quot; (note: &quot;n&quot; counts from
1).</p>

<p>For other parameters, see &quot;sfdisk&quot;. You should
usually pass 0 for the cyls/heads/sectors parameters.</p>

<p>See also: &quot;part-add&quot;</p>

<p>This function is deprecated. In new code, use the
&quot;part_add&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>sfdisk-disk-geometry sfdisk-disk-geometry device</p>

<p>This displays the disk geometry of &quot;device&quot;
read from the partition table. Especially in the case where
the underlying block device has been resized, this can be
different from the kernels idea of the geometry (see
&quot;sfdisk-kernel-geometry&quot;).</p>

<p>The result is in human-readable format, and not designed
to be parsed.</p>

<p>sfdisk-kernel-geometry sfdisk-kernel-geometry device</p>

<p>This displays the kernel s idea of the geometry of
&quot;device&quot;.</p>

<p>The result is in human-readable format, and not designed
to be parsed.</p>

<p>sfdisk-l sfdisk-l device</p>

<p>This displays the partition table on &quot;device&quot;,
in the human-readable output of the sfdisk(8) command. It is
not intended to be parsed.</p>

<p>See also: &quot;part-list&quot;</p>

<p>This function is deprecated. In new code, use the
&quot;part_list&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>sh sh command</p>

<p>This call runs a command from the guest filesystem via
the guests &quot;/bin/sh&quot;.</p>

<p>This is like &quot;command&quot;, but passes the command
to:</p>

<p>/bin/sh -c &quot;command&quot;</p>

<p>Depending on the guest s shell, this usually results in
wildcards being expanded, shell expressions being
interpolated and so on.</p>

<p>All the provisos about &quot;command&quot; apply to this
call.</p>

<p>sh-lines sh-lines command</p>

<p>This is the same as &quot;sh&quot;, but splits the
result into a list of lines.</p>

<p>See also: &quot;command-lines&quot;</p>

<p>sleep sleep secs</p>

<p>Sleep for &quot;secs&quot; seconds.</p>

<p>stat stat path</p>

<p>Returns file information for the given
&quot;path&quot;.</p>

<p>This is the same as the stat(2) system call.</p>

<p>statvfs statvfs path</p>

<p>Returns file system statistics for any mounted file
system. &quot;path&quot; should be a file or directory in
the mounted file system (typically it is the mount point
itself, but it doesnt need to be).</p>

<p>This is the same as the statvfs(2) system call.</p>

<p>strings strings path</p>

<p>This runs the strings(1) command on a file and returns
the list of printable strings found.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>strings-e strings-e encoding path</p>

<p>This is like the &quot;strings&quot; command, but allows
you to specify the encoding of strings that are looked for
in the source file &quot;path&quot;.</p>

<p>Allowed encodings are:</p>

<p>s Single 7-bit-byte characters like ASCII and the
ASCII-compatible parts of ISO-8859-X (this is what
&quot;strings&quot; uses).</p>

<p>S Single 8-bit-byte characters.</p>

<p>b 16-bit big endian strings such as those encoded in
UTF-16BE or UCS-2BE.</p>

<p>l (lower case letter L) 16-bit little endian such as
UTF-16LE and UCS-2LE. This is useful for examining binaries
in Windows guests.</p>

<p>B 32-bit big endian such as UCS-4BE.</p>

<p>L 32-bit little endian such as UCS-4LE.</p>

<p>The returned strings are transcoded to UTF-8.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>swapoff-device swapoff-device device</p>

<p>This command disables the libguestfs appliance swap
device or partition named &quot;device&quot;. See
&quot;swapon-device&quot;.</p>

<p>swapoff-file swapoff-file file</p>

<p>This command disables the libguestfs appliance swap on
file.</p>

<p>swapoff-label swapoff-label label</p>

<p>This command disables the libguestfs appliance swap on
labeled swap partition.</p>

<p>swapoff-uuid swapoff-uuid uuid</p>

<p>This command disables the libguestfs appliance swap
partition with the given UUID.</p>

<p>swapon-device swapon-device device</p>

<p>This command enables the libguestfs appliance to use the
swap device or partition named &quot;device&quot;. The
increased memory is made available for all commands, for
example those run using &quot;command&quot; or
&quot;sh&quot;.</p>

<p>Note that you should not swap to existing guest swap
partitions unless you know what you are doing. They may
contain hibernation information, or other information that
the guest doesnt want you to trash. You also risk leaking
information about the host to the guest this way. Instead,
attach a new host device to the guest and swap on that.</p>

<p>swapon-file swapon-file file</p>

<p>This command enables swap to a file. See
&quot;swapon-device&quot; for other notes.</p>

<p>swapon-label swapon-label label</p>

<p>This command enables swap to a labeled swap partition.
See &quot;swapon- device&quot; for other notes.</p>

<p>swapon-uuid swapon-uuid uuid</p>

<p>This command enables swap to a swap partition with the
given UUID. See &quot;swapon-device&quot; for other
notes.</p>

<p>sync sync</p>

<p>This syncs the disk, so that any writes are flushed
through to the underlying disk image.</p>

<p>You should always call this if you have modified a disk
image, before closing the handle.</p>

<p>tail tail path</p>

<p>This command returns up to the last 10 lines of a file
as a list of strings.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>tail-n tail-n nrlines path</p>

<p>If the parameter &quot;nrlines&quot; is a positive
number, this returns the last &quot;nrlines&quot; lines of
the file &quot;path&quot;.</p>

<p>If the parameter &quot;nrlines&quot; is a negative
number, this returns lines from the file &quot;path&quot;,
starting with the &quot;-nrlines&quot;th line.</p>

<p>If the parameter &quot;nrlines&quot; is zero, this
returns an empty list.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>tar-in tar-in (tarfile|-) directory</p>

<p>This command uploads and unpacks local file
&quot;tarfile&quot; (an uncompressed tar file) into
&quot;directory&quot;.</p>

<p>To upload a compressed tarball, use &quot;tgz-in&quot;
or &quot;txz-in&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>tar-out tar-out directory (tarfile|-)</p>

<p>This command packs the contents of &quot;directory&quot;
and downloads it to local file &quot;tarfile&quot;.</p>

<p>To download a compressed tarball, use
&quot;tgz-out&quot; or &quot;txz-out&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>tgz-in tgz-in (tarball|-) directory</p>

<p>This command uploads and unpacks local file
&quot;tarball&quot; (a gzip compressed tar file) into
&quot;directory&quot;.</p>

<p>To upload an uncompressed tarball, use
&quot;tar-in&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>tgz-out tgz-out directory (tarball|-)</p>

<p>This command packs the contents of &quot;directory&quot;
and downloads it to local file &quot;tarball&quot;.</p>

<p>To download an uncompressed tarball, use
&quot;tar-out&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>touch touch path</p>

<p>Touch acts like the touch(1) command. It can be used to
update the timestamps on a file, or, if the file does not
exist, to create a new zero-length file.</p>

<p>This command only works on regular files, and will fail
on other file types such as directories, symbolic links,
block special etc.</p>

<p>truncate truncate path</p>

<p>This command truncates &quot;path&quot; to a zero-length
file. The file must exist already.</p>

<p>truncate-size truncate-size path size</p>

<p>This command truncates &quot;path&quot; to size
&quot;size&quot; bytes. The file must exist already.</p>

<p>If the current file size is less than &quot;size&quot;
then the file is extended to the required size with zero
bytes. This creates a sparse file (ie. disk blocks are not
allocated for the file until you write to it). To create a
non-sparse file of zeroes, use &quot;fallocate64&quot;
instead.</p>

<p>tune2fs tune2fs device [force:true|false]
[maxmountcount:N] [mountcount:N] [errorbehavior:..]
[group:N] [intervalbetweenchecks:N]
[reservedblockspercentage:N] [lastmounteddirectory:..]
[reservedblockscount:N] [user:N]</p>

<p>This call allows you to adjust various filesystem
parameters of an ext2/ext3/ext4 filesystem called
&quot;device&quot;.</p>

<p>The optional parameters are:</p>

<p>&quot;force&quot; Force tune2fs to complete the
operation even in the face of errors. This is the same as
the tune2fs &quot;-f&quot; option.</p>

<p>&quot;maxmountcount&quot; Set the number of mounts after
which the filesystem is checked by e2fsck(8). If this is 0
then the number of mounts is disregarded. This is the same
as the tune2fs &quot;-c&quot; option.</p>

<p>&quot;mountcount&quot; Set the number of times the
filesystem has been mounted. This is the same as the tune2fs
&quot;-C&quot; option.</p>

<p>&quot;errorbehavior&quot; Change the behavior of the
kernel code when errors are detected. Possible values
currently are: &quot;continue&quot;, &quot;remount-ro&quot;,
&quot;panic&quot;. In practice these options don t really
make any difference, particularly for write errors.</p>

<p>This is the same as the tune2fs &quot;-e&quot;
option.</p>

<p>&quot;group&quot; Set the group which can use reserved
filesystem blocks. This is the same as the tune2fs
&quot;-g&quot; option except that it can only be specified
as a number.</p>

<p>&quot;intervalbetweenchecks&quot; Adjust the maximal
time between two filesystem checks (in seconds). If the
option is passed as 0 then time-dependent checking is
disabled.</p>

<p>This is the same as the tune2fs &quot;-i&quot;
option.</p>

<p>&quot;reservedblockspercentage&quot; Set the percentage
of the filesystem which may only be allocated by privileged
processes. This is the same as the tune2fs &quot;-m&quot;
option.</p>

<p>&quot;lastmounteddirectory&quot; Set the last mounted
directory. This is the same as the tune2fs &quot;-M&quot;
option.</p>

<p>&quot;reservedblockscount&quot; Set the number of
reserved filesystem blocks. This is the same as the tune2fs
&quot;-r&quot; option. &quot;user&quot; Set the user who can
use the reserved filesystem blocks. This is the same as the
tune2fs &quot;-u&quot; option except that it can only be
specified as a number.</p>

<p>To get the current values of filesystem parameters, see
&quot;tune2fs-l&quot;. For precise details of how tune2fs
works, see the tune2fs(8) man page.</p>

<p>This command has one or more optional arguments. See
&quot;OPTIONAL ARGUMENTS&quot;.</p>

<p>tune2fs-l tune2fs-l device</p>

<p>This returns the contents of the ext2, ext3 or ext4
filesystem superblock on &quot;device&quot;.</p>

<p>It is the same as running &quot;tune2fs -l device&quot;.
See tune2fs(8) manpage for more details. The list of fields
returned isn t clearly defined, and depends on both the
version of &quot;tune2fs&quot; that libguestfs was built
against, and the filesystem itself.</p>

<p>txz-in txz-in (tarball|-) directory</p>

<p>This command uploads and unpacks local file
&quot;tarball&quot; (an xz compressed tar file) into
&quot;directory&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>txz-out txz-out directory (tarball|-)</p>

<p>This command packs the contents of &quot;directory&quot;
and downloads it to local file &quot;tarball&quot; (as an xz
compressed tar archive).</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>umask umask mask</p>

<p>This function sets the mask used for creating new files
and device nodes to &quot;mask &amp; 0777&quot;.</p>

<p>Typical umask values would be 022 which creates new
files with permissions like &quot;-rw-r--r--&quot; or
&quot;-rwxr-xr-x&quot;, and 002 which creates new files with
permissions like &quot;-rw-rw-r--&quot; or
&quot;-rwxrwxr-x&quot;.</p>

<p>The default umask is 022. This is important because it
means that directories and device nodes will be created with
0644 or 0755 mode even if you specify 0777.</p>

<p>See also &quot;get-umask&quot;, umask(2),
&quot;mknod&quot;, &quot;mkdir&quot;.</p>

<p>This call returns the previous umask.</p>

<p>umount unmount umount pathordevice</p>

<p>This unmounts the given filesystem. The filesystem may
be specified either by its mountpoint (path) or the device
which contains the filesystem.</p>

<p>umount-all unmount-all umount-all</p>

<p>This unmounts all mounted filesystems.</p>

<p>Some internal mounts are not unmounted by this call.</p>

<p>upload upload (filename|-) remotefilename</p>

<p>Upload local file &quot;filename&quot; to
&quot;remotefilename&quot; on the filesystem.</p>

<p>&quot;filename&quot; can also be a named pipe.</p>

<p>See also &quot;download&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>upload-offset upload-offset (filename|-) remotefilename
offset</p>

<p>Upload local file &quot;filename&quot; to
&quot;remotefilename&quot; on the filesystem.</p>

<p>&quot;remotefilename&quot; is overwritten starting at
the byte &quot;offset&quot; specified. The intention is to
overwrite parts of existing files or devices, although if a
non-existant file is specified then it is created with a
&quot;hole&quot; before &quot;offset&quot;. The size of the
data written is implicit in the size of the source
&quot;filename&quot;.</p>

<p>Note that there is no limit on the amount of data that
can be uploaded with this call, unlike with
&quot;pwrite&quot;, and this call always writes the full
amount unless an error occurs.</p>

<p>See also &quot;upload&quot;, &quot;pwrite&quot;.</p>

<p>Use &quot;-&quot; instead of a filename to read/write
from stdin/stdout.</p>

<p>utimens utimens path atsecs atnsecs mtsecs mtnsecs</p>

<p>This command sets the timestamps of a file with
nanosecond precision.</p>

<p>&quot;atsecs, atnsecs&quot; are the last access time
(atime) in secs and nanoseconds from the epoch.</p>

<p>&quot;mtsecs, mtnsecs&quot; are the last modification
time (mtime) in secs and nanoseconds from the epoch.</p>

<p>If the *nsecs field contains the special value
&quot;-1&quot; then the corresponding timestamp is set to
the current time. (The *secs field is ignored in this
case).</p>

<p>If the *nsecs field contains the special value
&quot;-2&quot; then the corresponding timestamp is left
unchanged. (The *secs field is ignored in this case).</p>

<p>version version</p>

<p>Return the libguestfs version number that the program is
linked against.</p>

<p>Note that because of dynamic linking this is not
necessarily the version of libguestfs that you compiled
against. You can compile the program, and then at runtime
dynamically link against a completely different
&quot;libguestfs.so&quot; library.</p>

<p>This call was added in version 1.0.58. In previous
versions of libguestfs there was no way to get the version
number. From C code you can use dynamic linker functions to
find out if this symbol exists (if it doesnt, then its an
earlier version).</p>

<p>The call returns a structure with four elements. The
first three (&quot;major&quot;, &quot;minor&quot; and
&quot;release&quot;) are numbers and correspond to the usual
version triplet. The fourth element (&quot;extra&quot;) is a
string and is normally empty, but may be used for
distro-specific information.</p>

<p>To construct the original version string:
&quot;$major.$minor.$release$extra&quot;</p>

<p>See also: &quot;LIBGUESTFS VERSION NUMBERS&quot; in
guestfs(3).</p>

<p>Note: Dont use this call to test for availability of
features. In enterprise distributions we backport features
from later versions into earlier versions, making this an
unreliable way to test for features. Use
&quot;available&quot; instead.</p>

<p>vfs-label vfs-label device</p>

<p>This returns the filesystem label of the filesystem on
&quot;device&quot;.</p>

<p>If the filesystem is unlabeled, this returns the empty
string.</p>

<p>To find a filesystem from the label, use
&quot;findfs-label&quot;.</p>

<p>vfs-type vfs-type device</p>

<p>This command gets the filesystem type corresponding to
the filesystem on &quot;device&quot;.</p>

<p>For most filesystems, the result is the name of the
Linux VFS module which would be used to mount this
filesystem if you mounted it without specifying the
filesystem type. For example a string such as
&quot;ext3&quot; or &quot;ntfs&quot;.</p>

<p>vfs-uuid vfs-uuid device</p>

<p>This returns the filesystem UUID of the filesystem on
&quot;device&quot;.</p>

<p>If the filesystem does not have a UUID, this returns the
empty string.</p>

<p>To find a filesystem from the UUID, use
&quot;findfs-uuid&quot;.</p>

<p>vg-activate vg-activate true|false &rsquo;volgroups
...&rsquo;</p>

<p>This command activates or (if &quot;activate&quot; is
false) deactivates all logical volumes in the listed volume
groups &quot;volgroups&quot;.</p>

<p>This command is the same as running &quot;vgchange -a
y|n volgroups...&quot;</p>

<p>Note that if &quot;volgroups&quot; is an empty list then
all volume groups are activated or deactivated.</p>

<p>vg-activate-all vg-activate-all true|false</p>

<p>This command activates or (if &quot;activate&quot; is
false) deactivates all logical volumes in all volume
groups.</p>

<p>This command is the same as running &quot;vgchange -a
y|n&quot;</p>

<p>vgcreate vgcreate volgroup &rsquo;physvols
...&rsquo;</p>

<p>This creates an LVM volume group called
&quot;volgroup&quot; from the non-empty list of physical
volumes &quot;physvols&quot;.</p>

<p>vglvuuids vglvuuids vgname</p>

<p>Given a VG called &quot;vgname&quot;, this returns the
UUIDs of all the logical volumes created in this volume
group.</p>

<p>You can use this along with &quot;lvs&quot; and
&quot;lvuuid&quot; calls to associate logical volumes and
volume groups.</p>

<p>See also &quot;vgpvuuids&quot;.</p>

<p>vgpvuuids vgpvuuids vgname</p>

<p>Given a VG called &quot;vgname&quot;, this returns the
UUIDs of all the physical volumes that this volume group
resides on.</p>

<p>You can use this along with &quot;pvs&quot; and
&quot;pvuuid&quot; calls to associate physical volumes and
volume groups.</p>

<p>See also &quot;vglvuuids&quot;.</p>

<p>vgremove vgremove vgname</p>

<p>Remove an LVM volume group &quot;vgname&quot;, (for
example &quot;VG&quot;).</p>

<p>This also forcibly removes all logical volumes in the
volume group (if any).</p>

<p>vgrename vgrename volgroup newvolgroup</p>

<p>Rename a volume group &quot;volgroup&quot; with the new
name &quot;newvolgroup&quot;.</p>

<p>vgs vgs</p>

<p>List all the volumes groups detected. This is the
equivalent of the vgs(8) command.</p>

<p>This returns a list of just the volume group names that
were detected (eg. &quot;VolGroup00&quot;).</p>

<p>See also &quot;vgs-full&quot;.</p>

<p>vgs-full vgs-full</p>

<p>List all the volumes groups detected. This is the
equivalent of the vgs(8) command. The &quot;full&quot;
version includes all fields.</p>

<p>vgscan vgscan</p>

<p>This rescans all block devices and rebuilds the list of
LVM physical volumes, volume groups and logical volumes.</p>

<p>vguuid vguuid vgname</p>

<p>This command returns the UUID of the LVM VG named
&quot;vgname&quot;.</p>

<p>wc-c wc-c path</p>

<p>This command counts the characters in a file, using the
&quot;wc -c&quot; external command.</p>

<p>wc-l wc-l path</p>

<p>This command counts the lines in a file, using the
&quot;wc -l&quot; external command.</p>

<p>wc-w wc-w path</p>

<p>This command counts the words in a file, using the
&quot;wc -w&quot; external command.</p>

<p>write write path content</p>

<p>This call creates a file called &quot;path&quot;. The
content of the file is the string &quot;content&quot; (which
can contain any 8 bit data).</p>

<p>See also &quot;write-append&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>write-append write-append path content</p>

<p>This call appends &quot;content&quot; to the end of file
&quot;path&quot;. If &quot;path&quot; does not exist, then a
new file is created.</p>

<p>See also &quot;write&quot;.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>write-file write-file path content size</p>

<p>This call creates a file called &quot;path&quot;. The
contents of the file is the string &quot;content&quot;
(which can contain any 8 bit data), with length
&quot;size&quot;.</p>

<p>As a special case, if &quot;size&quot; is 0 then the
length is calculated using &quot;strlen&quot; (so in this
case the content cannot contain embedded ASCII NULs).</p>

<p>NB. Owing to a bug, writing content containing ASCII NUL
characters does not work, even if the length is
specified.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>This function is deprecated. In new code, use the
&quot;write&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>zegrep zegrep regex path</p>

<p>This calls the external &quot;zegrep&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>zegrepi zegrepi regex path</p>

<p>This calls the external &quot;zegrep -i&quot; program
and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>zero zero device</p>

<p>This command writes zeroes over the first few blocks of
&quot;device&quot;.</p>

<p>How many blocks are zeroed isnt specified (but its not
enough to securely wipe the device). It should be sufficient
to remove any partition tables, filesystem superblocks and
so on.</p>

<p>If blocks are already zero, then this command avoids
writing zeroes. This prevents the underlying device from
becoming non-sparse or growing unnecessarily.</p>

<p>See also: &quot;zero-device&quot;,
&quot;scrub-device&quot;, &quot;is-zero-device&quot;</p>

<p>zero-device zero-device device</p>

<p>This command writes zeroes over the entire
&quot;device&quot;. Compare with &quot;zero&quot; which just
zeroes the first few blocks of a device.</p>

<p>If blocks are already zero, then this command avoids
writing zeroes. This prevents the underlying device from
becoming non-sparse or growing unnecessarily.</p>

<p>zerofree zerofree device</p>

<p>This runs the zerofree program on &quot;device&quot;.
This program claims to zero unused inodes and disk blocks on
an ext2/3 filesystem, thus making it possible to compress
the filesystem more effectively.</p>

<p>You should not run this program if the filesystem is
mounted.</p>

<p>It is possible that using this program can damage the
filesystem or data on the filesystem.</p>

<p>zfgrep zfgrep pattern path</p>

<p>This calls the external &quot;zfgrep&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>zfgrepi zfgrepi pattern path</p>

<p>This calls the external &quot;zfgrep -i&quot; program
and returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>zfile zfile meth path</p>

<p>This command runs &quot;file&quot; after first
decompressing &quot;path&quot; using &quot;method&quot;.</p>

<p>&quot;method&quot; must be one of &quot;gzip&quot;,
&quot;compress&quot; or &quot;bzip2&quot;.</p>

<p>Since 1.0.63, use &quot;file&quot; instead which can now
process compressed files.</p>

<p>This function is deprecated. In new code, use the
&quot;file&quot; call instead.</p>

<p>Deprecated functions will not be removed from the API,
but the fact that they are deprecated indicates that there
are problems with correct use of these functions.</p>

<p>zgrep zgrep regex path</p>

<p>This calls the external &quot;zgrep&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>zgrepi zgrepi regex path</p>

<p>This calls the external &quot;zgrep -i&quot; program and
returns the matching lines.</p>

<p>Because of the message protocol, there is a transfer
limit of somewhere between 2MB and 4MB. See &quot;PROTOCOL
LIMITS&quot; in guestfs(3).</p>

<p>EXIT STATUS guestfish returns 0 if the commands
completed without error, or 1 if there was an error.</p>

<p>ENVIRONMENT VARIABLES EDITOR The &quot;edit&quot;
command uses $EDITOR as the editor. If not set, it uses
&quot;vi&quot;.</p>

<p>FEBOOTSTRAP_KERNEL FEBOOTSTRAP_MODULES These two
environment variables allow the kernel that libguestfs uses
in the appliance to be selected. If $FEBOOTSTRAP_KERNEL is
not set, then the most recent host kernel is chosen. For
more information about kernel selection, see
febootstrap-supermin-helper(8). This feature is only
available in febootstrap 3.8.</p>

<p>GUESTFISH_DISPLAY_IMAGE The &quot;display&quot; command
uses $GUESTFISH_DISPLAY_IMAGE to display images. If not set,
it uses display(1).</p>

<p>GUESTFISH_PID Used with the --remote option to specify
the remote guestfish process to control. See section
&quot;REMOTE CONTROL GUESTFISH OVER A SOCKET&quot;.</p>

<p>HEXEDITOR The &quot;hexedit&quot; command uses
$HEXEDITOR as the external hex editor. If not set, then an
error message is printed.</p>

<p>HOME If compiled with GNU readline support, various
files in the home directory can be used. See
&quot;FILES&quot;.</p>

<p>LIBGUESTFS_APPEND Pass additional options to the guest
kernel.</p>

<p>LIBGUESTFS_DEBUG Set &quot;LIBGUESTFS_DEBUG=1&quot; to
enable verbose messages. This has the same effect as using
the -v option.</p>

<p>LIBGUESTFS_MEMSIZE Set the memory allocated to the qemu
process, in megabytes. For example:</p>

<p>LIBGUESTFS_MEMSIZE=700</p>

<p>LIBGUESTFS_PATH Set the path that guestfish uses to
search for kernel and initrd.img. See the discussion of
paths in guestfs(3).</p>

<p>LIBGUESTFS_QEMU Set the default qemu binary that
libguestfs uses. If not set, then the qemu which was found
at compile time by the configure script is used.</p>

<p>LIBGUESTFS_TRACE Set &quot;LIBGUESTFS_TRACE=1&quot; to
enable command traces.</p>

<p>PAGER The &quot;more&quot; command uses $PAGER as the
pager. If not set, it uses &quot;more&quot;.</p>

<p>TMPDIR Location of temporary directory, defaults to
&quot;/tmp&quot; except for the cached supermin appliance
which defaults to &quot;/var/tmp&quot;.</p>

<p>If libguestfs was compiled to use the supermin appliance
then the real appliance is cached in this directory, shared
between all handles belonging to the same EUID. You can use
$TMPDIR to configure another directory to use in case
&quot;/var/tmp&quot; is not large enough.</p>

<p>FILES $HOME/.libguestfs-tools.rc
/etc/libguestfs-tools.conf This configuration file controls
the default read-only or read- write mode (--ro or
--rw).</p>

<p>See &quot;OPENING DISKS FOR READ AND WRITE&quot;.</p>

<p>$HOME/.guestfish If compiled with GNU readline support,
then the command history is saved in this file.</p>

<p>$HOME/.inputrc /etc/inputrc If compiled with GNU
readline support, then these files can be used to configure
readline. For further information, please see
&quot;INITIALIZATION FILE&quot; in readline(3).</p>

<p>To write rules which only apply to guestfish, use:</p>

<p>$if guestfish ... $endif</p>

<p>Variables that you can set in inputrc that change the
behaviour of guestfish in useful ways include:</p>

<p>completion-ignore-case (default: on) By default,
guestfish will ignore case when tab-completing paths on the
disk. Use:</p>

<p>set completion-ignore-case off</p>

<p>to make guestfish case sensitive.</p>

<p>test1.img test2.img (etc) When using the -N or --new
option, the prepared disk or filesystem will be created in
the file &quot;test1.img&quot; in the current directory. The
second use of -N will use &quot;test2.img&quot; and so on.
Any existing file with the same name will be
overwritten.</p>

<p>SEE ALSO guestfs(3), &lt;http://libguestfs.org/&gt;,
virt-alignment-scan(1), virt-cat(1), virt-copy-in(1),
virt-copy-out(1), virt-df(1), virt-edit(1),
virt-filesystems(1), virt-inspector(1),
virt-list-filesystems(1), virt-list-partitions(1),
virt-ls(1), virt-make-fs(1), virt-rescue(1), virt-resize(1),
virt-sparsify(1), virt-sysprep(1), virt-tar(1),
virt-tar-in(1), virt-tar-out(1), virt-win-reg(1),
display(1), hexedit(1), febootstrap-supermin-helper(8).</p>

<p>AUTHORS Richard W.M. Jones (&quot;rjones at redhat dot
com&quot;)</p>

<p>COPYRIGHT Copyright (C) 2009-2012 Red Hat Inc.
&lt;http://libguestfs.org/&gt;</p>

<p>This program is free software; you can redistribute it
and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later
version.</p>

<p>This program is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more
details.</p>

<p>You should have received a copy of the GNU General
Public License along with this program; if not, write to the
Free Software Foundation, Inc., 51 Franklin Street, Fifth
Floor, Boston, MA 02110-1301 USA.</p>

<p>libguestfs-1.16.19 2012-04-18 guestfish(1)</p>
<hr>
</body>
</html>
