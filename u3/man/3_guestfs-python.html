<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Fri Nov 18 04:21:50 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>guestfs-python(3) Virtualization Support
guestfs-python(3)</p>

<p>NAME guestfs-python - How to use libguestfs from
Python</p>

<p>SYNOPSIS import guestfs g = guestfs.GuestFS ()
g.add_drive_opts (&quot;disk.img&quot;,
format=&quot;raw&quot;, readonly=1) g.launch ()</p>

<p>DESCRIPTION This manual page documents how to call
libguestfs from the Python programming language. This page
just documents the differences from the C API and gives some
examples. If you are not familiar with using libguestfs, you
also need to read guestfs(3).</p>

<p>EXCEPTIONS Errors from libguestfs functions are mapped
into &quot;RuntimeException&quot; with a single string
argument which is the error message.</p>

<p>MORE DOCUMENTATION Type:</p>

<p>$ python &gt;&gt;&gt; import guestfs &gt;&gt;&gt; help
(guestfs)</p>

<p>EXAMPLE 1: CREATE A DISK IMAGE # Example showing how to
create a disk image.</p>

<p>import os import guestfs</p>

<p>output = &quot;disk.img&quot;</p>

<p>g = guestfs.GuestFS ()</p>

<p># Create a raw-format sparse disk image, 512 MB in size.
f = open (output, &quot;w&quot;) f.truncate (512 * 1024 *
1024) f.close ()</p>

<p># Set the trace flag so that we can see each libguestfs
call. g.set_trace (1)</p>

<p># Set the autosync flag so that the disk will be
synchronized # automatically when the libguestfs handle is
closed. g.set_autosync (1)</p>

<p># Attach the disk image to libguestfs. g.add_drive_opts
(output, format = &quot;raw&quot;, readonly = 0)</p>

<p># Run the libguestfs back-end. g.launch ()</p>

<p># Get the list of devices. Because we only added one
drive # above, we expect that this list should contain a
single # element. devices = g.list_devices () assert (len
(devices) == 1)</p>

<p># Partition the disk as one single MBR partition.
g.part_disk (devices[0], &quot;mbr&quot;)</p>

<p># Get the list of partitions. We expect a single
element, which # is the partition we have just created.
partitions = g.list_partitions () assert (len (partitions)
== 1)</p>

<p># Create a filesystem on the partition. g.mkfs
(&quot;ext4&quot;, partitions[0])</p>

<p># Now mount the filesystem so that we can add files.
g.mount_options (&quot;&quot;, partitions[0],
&quot;/&quot;)</p>

<p># Create some files and directories. g.touch
(&quot;/empty&quot;) message = &quot;Hello, world0 g.write
(&quot;/hello&quot;, message) g.mkdir (&quot;/foo&quot;)</p>

<p># This one uploads the local file /etc/resolv.conf into
# the disk image. g.upload (&quot;/etc/resolv.conf&quot;,
&quot;/foo/resolv.conf&quot;)</p>

<p># Because &rsquo;autosync&rsquo; was set (above) we can
just close the handle # and the disk contents will be
synchronized. You can also do # this manually by calling
g.umount_all and g.sync. g.close ()</p>

<p>EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE #
Example showing how to inspect a virtual machine disk.</p>

<p>import sys import guestfs</p>

<p>assert (len (sys.argv) == 2) disk = sys.argv[1]</p>

<p>g = guestfs.GuestFS ()</p>

<p># Attach the disk image read-only to libguestfs.
g.add_drive_opts (disk, readonly=1)</p>

<p># Run the libguestfs back-end. g.launch ()</p>

<p># Ask libguestfs to inspect for operating systems. roots
= g.inspect_os () if len (roots) == 0: raise (Error
(&quot;inspect_vm: no operating systems found&quot;))</p>

<p>for root in roots: print &quot;Root device: %s&quot; %
root</p>

<p># Print basic information about the operating system.
print &quot; Product name: %s&quot; %
(g.inspect_get_product_name (root)) print &quot; Version:
%d.%d&quot; % (g.inspect_get_major_version (root),
g.inspect_get_minor_version (root)) print &quot; Type:
%s&quot; % (g.inspect_get_type (root)) print &quot; Distro:
%s&quot; % (g.inspect_get_distro (root))</p>

<p># Mount up the disks, like guestfish -i. # # Sort keys
by length, shortest first, so that we end up # mounting the
filesystems in the correct order. mps =
g.inspect_get_mountpoints (root) def compare (a, b): if
len(a[0]) &gt; len(b[0]): return 1 elif len(a[0]) ==
len(b[0]): return 0 else: return -1 mps.sort (compare) for
mp_dev in mps: try: g.mount_ro (mp_dev[1], mp_dev[0]) except
RuntimeError as msg: print &quot;%s (ignored)&quot; %
msg</p>

<p># If /etc/issue.net file exists, print up to 3 lines.
filename = &quot;/etc/issue.net&quot; if g.is_file
(filename): print &quot;--- %s ---&quot; % filename lines =
g.head_n (3, filename) for line in lines: print line</p>

<p># Unmount everything. g.umount_all ()</p>

<p>SEE ALSO guestfs(3), guestfs-examples(3),
guestfs-erlang(3), guestfs-java(3), guestfs-ocaml(3),
guestfs-perl(3), guestfs-recipes(1), guestfs-ruby(3),
&lt;http://libguestfs.org/&gt;.</p>

<p>AUTHORS Richard W.M. Jones (&quot;rjones at redhat dot
com&quot;)</p>

<p>COPYRIGHT Copyright (C) 2010 Red Hat Inc.
&lt;http://libguestfs.org/&gt;</p>

<p>The examples in this manual page may be freely copied,
modified and distributed without any restrictions.</p>

<p>This library is free software; you can redistribute it
and/or modify it under the terms of the GNU Lesser General
Public License as published by the Free Software Foundation;
either version 2 of the License, or (at your option) any
later version.</p>

<p>This library is distributed in the hope that it will be
useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU Lesser General Public License for more
details.</p>

<p>You should have received a copy of the GNU Lesser
General Public License along with this library; if not,
write to the Free Software Foundation, Inc., 51 Franklin
Street, Fifth Floor, Boston, MA 02110-1301 USA</p>

<p>libguestfs-1.16.19 2012-04-18 guestfs-python(3)</p>
<hr>
</body>
</html>
