<!-- Creator     : groff version 1.18.1.4 -->
<!-- CreationDate: Fri Nov 18 05:14:51 2016 -->
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta name="Content-Style" content="text/css">
<title></title>
</head>
<body>

<hr>

<p>STAP-SERVER(8) STAP-SERVER(8)</p>

<p>NAME stap-server - systemtap server management</p>

<p>SYNOPSIS [ service ] stap-server { start | stop |
restart | condrestart | try-restart | force-reload | status
} [ options ]</p>

<p>DESCRIPTION A systemtap compile server listens for
connections from stap clients on a secure SSL network port
and accepts requests to run the stap front end. Each server
advertises its presence and configuration on the local
network using mDNS (avahi) allowing for automatic detection
by clients.</p>

<p>The stap-server script aims to provide:</p>

<p>&middot; management of systemtap compile servers as a
service.</p>

<p>&middot; convenient control over configured servers and
individual (ad-hoc) servers.</p>

<p>ARGUMENTS One of the actions below must be
specified:</p>

<p>start Start servers. The specified servers are started.
If no server is specified, the configured servers are
started. If no servers are configured, a server for the
kernel release and architecture of the host is started. If a
specified server is already started, this action will be
ignored for that server. If a server fails to start, this
action fails.</p>

<p>stop Stop server(s). The specified servers are stopped.
If no server is specified, all currently running servers are
stopped. If a specified server is not running, this action
will be successful for that server. If a server fails to
stop, this action fails.</p>

<p>restart Stop and restart servers. The specified servers
are stopped and restarted. If no server is specified, all
currently running servers are stopped and restarted. If no
servers are running, this action behaves like start.</p>

<p>condrestart Stop and restart servers. The specified
servers are stopped and restarted. If a specified server is
not running, it is not started. If no server is specified,
all currently running servers are stopped and restarted. If
no servers are running, none will be started.</p>

<p>try-restart This action is identical to condrestart.</p>

<p>force-reload Stop all running servers, reload config
files and restart the service as if start was specified.</p>

<p>status Print information about running servers.
Information about the specified server(s) will be printed.
If no server is specified, information about all running
servers will be printed.</p>

<p>OPTIONS The following options are used to provide
additional configuration and to specify servers to be
managed:</p>

<p>-c configfile This option specifies a global
configuration file in addition to the default global
configuration file described below. This file will be
processed after the default global configuration file. If
the -c option is specified more than once, the last configu-
ration file specified will be used.</p>

<p>-a architecture This option specifies the target
architecture of the server and is analogous to the -a option
of stap. See the stap(1) manual page for more details. The
default architecture is the archi- tecture of the host.</p>

<p>-r kernel-release This option specifies the target
kernel release of the server and is analogous to the -r
option of stap. See the stap(1) man- ual page for more
details. The default release is that of the currently
running kernel.</p>

<p>-I path This option specifies an additional path to be
searched by the server(s) for tapsets and is analogous to
the -I option of stap. See the stap(1) manual page for more
details.</p>

<p>-R path This option specifies the location of the
systemtap runtime to be used by the server(s) and is
analogous to the -R option of stap. See the stap(1) manual
page for more details.</p>

<p>-B options This option specifies options to be passed to
make when building systemtap modules and is analogous to the
-B option of stap. See the stap(1) manual page for more
details.</p>

<p>-i This option is a shortcut which specifies one server
for each kernel release installed in /lib/modules/. Previous
-I, -R, -B and -u options will be applied to each server,
however previous -a options will be ignored and the default
architecture will be used.</p>

<p>-n nickname This option allows the specification of a
server configuration by nickname. When -n is specified, a
currently running server with the given nickname will be
searched for. If no currently running server with the given
nickname is found, a server con- figuration with the given
nickname will be searched for in
/usr/etc/stap-server/conf.d/*.conf, or the path configured
in /usr/etc/sysconfig/stap-server or the config file
specified by the -c option. If a server configuration for
the given nickname is found, the -a, -r, -I, -R, -B and -u
options for that server will be used as if they were
specified on the command line. If no configuration with the
given nickname is found, and the action is start (or an
action behaving like start (see ARGU- MENTS), the server
will be started with the given nickname. If no configuration
with the given nickname is found, and the action is not
start (or an action behaving like start), it is an error. If
a nickname is not specified for a server which is being
started, its nickname will be its process id.</p>

<p>-p pid This option allows the specification of a server
configuration by process id. When -p is specified, a
currently running server with the given process id will be
searched for. If no such server is found, it is an error. If
a server with the given procss id is found, the -a, -r, -I,
-R, -B and -u options for that server will be used as if
they were specified on the com- mand line.</p>

<p>-u user-name Each systemtap compile server is normally
run by the user name stap-server (for the initscript) or as
the user invoking stap- server, unless otherwise configured
(see FILES). This option specifies the user name used to run
the server(s). The user name specified must be a member of
the group stap-server.</p>

<p>CONFIGURATION Configuration files allow us to:</p>

<p>&middot; specify global configuration of logging, server
configuration files, status files and other global
parameters.</p>

<p>&middot; specify which servers are to be started by
default.</p>

<p>Global Configuration The Global Configuration file
(/usr/etc/sysconfig/stap-server) contains variable
assignments used to configure the overall operation of the
service. Each line beginning with a # character is ignored.
All other lines must be of the form VARIABLE=VALUE. This is
not a shell script. The entire contents of the line after
the = will be assigned as-is to the variable.</p>

<p>The following variables may be assigned:</p>

<p>CONFIG_PATH Specifies the absolute path of the directory
containing the default server configurations (default:
/usr/etc/stap-server/conf.d/).</p>

<p>STAT_PATH Specifies the absolute path of the running
server status direc- tory (default:
/usr/var/run/stap-server/).</p>

<p>LOG_FILE Specifies the absolute path of the log file
(default: /usr/var/log/stap-server.log).</p>

<p>STAP_USER Specifies the userid which will be used to run
the server(s) (default: for the initscript stap-server,
otherwise the user running stap-server).</p>

<p>Individual Server Configuration Each server
configuration file configures a server to be started when no
server is specified for the start action, or an action
behaving like the start action (see ARGUMENTS). Each
configuration file contains variable assignments used to
configure an individual server.</p>

<p>Each line beginning with a # character is ignored. All
other lines must be of the form VARIABLE=VALUE. This is not
a shell script. The entire contents of the line after the =
will be assigned as-is to the variable.</p>

<p>Each configuration file must have a filename suffix of
.conf. The default location of these files is
/usr/etc/stap-server/conf.d/, but this can be overridden in
the global configuration file using the -c option (see
OPTIONS).</p>

<p>The following variables may be assigned:</p>

<p>ARCH Specifies the target architecture for this server
and corre- sponds to the -a option (see OPTIONS). If ARCH is
not set, the architecture of the host will be used.</p>

<p>RELEASE Specifies the kernel release for this server and
corresponds to the -r option (see OPTIONS). If RELEASE is
not set, the release of the kernel running on the host will
be used.</p>

<p>BUILD Specifies options to be passed to the make process
used by sys- temtap to build kernel modules. This an array
variable with each element corresponding to a -B option (see
OPTIONS). Using the form BUILD=STRING clears the array and
sets the first ele- ment to STRING. Using the form
BUILD+=STRING adds STRING as an additional element to the
array.</p>

<p>INCLUDE Specifies a list of directories to be searched
by the server for tapsets. This an array variable with each
element corresponding to an -I option (see OPTIONS). Using
the form INCLUDE=PATH clears the array and sets the first
element to PATH. Using the form INCLUDE+=PATH adds PATH as
an additional element to the array.</p>

<p>RUNTIME Specifies the directory which contains the
systemtap runtime code to be used by this server and
corresponds to the -R option (see OPTIONS).</p>

<p>USER Specifies the user name to be used to run this
server and corre- sponds to the -u option (see OPTIONS).</p>

<p>NICKNAME Specifies the nickname to be used to refer to
this server and corresponds to the -n option (see
OPTIONS).</p>

<p>SERVER AUTHENTICAION The security of the SSL network
connection between the client and server depends on the
proper management of server certificates.</p>

<p>The trustworthiness of a given systemtap server can not
be determined automatically without a trusted certificate
authority issuing systemtap server certificates. This is not
practical in everyday use and so, clients must authenticate
servers against their own database of trusted server
certificates. In this context, establishing a given server
as trusted by a given client means adding that
server&rsquo;s certificate to the client&rsquo;s database of
trusted servers.</p>

<p>For the stap-server initscript, on the local host, this
is handled automatically. When the systemtap-server package
is installed, the server&rsquo;s certificate for the default
user (stap-server) is automati- cally generated and
installed. This means that servers started by the
stap-server initscript, with the default user, are
automatically trusted by clients on the local host.</p>

<p>In order to use a server running on another host, that
server&rsquo;s cer- tificate must be installed on the
client&rsquo;s host. See the --trust-servers option in the
stap(1) manual page for more details.</p>

<p>EXAMPLES See the stapex(3stap) manual page for a
collection of sample systemtap scripts.</p>

<p>To start the configured servers, or the default server,
if none are configured:</p>

<p>$ [ service ] stap-server start</p>

<p>To start a server for each kernel installed in
/lib/modules:</p>

<p>$ [ service ] stap-server start -i</p>

<p>To obtain information about the running server(s):</p>

<p>$ [ service ] stap-server status</p>

<p>To start a server like another one, except targeting a
different archi- tecture, by referencing the first
server&rsquo;s nickname:</p>

<p>$ [ service ] stap-server start -n NICKNAME -a ARCH</p>

<p>To stop one of the servers by referencing its process id
(obtained by running stap-server status):</p>

<p>$ [ service ] stap-server stop -p PID</p>

<p>To stop all running servers:</p>

<p>$ [ service ] stap-server stop</p>

<p>SAFETY AND SECURITY Systemtap is an administrative tool.
It exposes kernel internal data structures and potentially
private user information. See the stap(1) manual page for
additional information on safety and security.</p>

<p>As a network server, stap-server should be activated
with care in order to limit the potential effects of bugs or
mischevious users. Consider the following prophylactic
measures.</p>

<p>1 Run stap-server as an unprivileged user, never as
root.</p>

<p>When invoked as a service (i.e. service stap-server
...), each server is run, by default, as the user
stap-server. When invoked directly (i.e. stap-server ...),
each server is run, by default, as the invoking user. In
each case, another user may be selected by using the -u
option on invocation, by specifying STAP_USER=username in
the global configuration file or by speci- fying
USER=username in an individual server configuration file.
The invoking user must have authority to run processes as
another user. See CONFIGURATION.</p>

<p>The selected user must have write access to the server
log file (default: /usr/var/log/stap-server.log). The
location of the server log file may be changed by setting
LOG_FILE=path in the global configuration file. See
CONFIGURATION.</p>

<p>The selected user must have read/write access to the
directory containing the server status files (default:
/usr/var/run/stap-server/). The location of the server
status files may be changed by setting STAT_PATH=path in the
global configuration file. See CONFIGURATION.</p>

<p>The selected user must have read/write access to the
uprobes.ko build directory and its files (default:
/usr/share/system- tap/runtime/uprobes/).</p>

<p>Neither form of stap-server will run if the selected
user is root.</p>

<p>2 Run stap-server with resource limits that impose
maximum cpu time, file size, memory consumption, in order to
bound the effects of processing excessively large or bogus
inputs.</p>

<p>When the user running the servers is stap-server, each
server is run with limits equivalent to</p>

<p>ulimit -f 50000 -s 1000 -t 60 -u 20 -v 500000</p>

<p>otherwise, no limits are imposed.</p>

<p>3 Run stap-server with a TMPDIR environment variable
that points to a separate and/or quota-enforced directory,
in order to pre- vent filling up of important
filesystems.</p>

<p>The default TMPDIR is /tmp/.</p>

<p>4 Activate network firewalls to limit stap client
connections to relatively trustworthy networks.</p>

<p>For automatic selection of servers by clients, avahi
must be installed on both the server and client hosts and
mDNS messages must be allowed through the firewall.</p>

<p>The systemtap server and its related utilities use the
Secure Socket Layer (SSL) as implemented by Network Security
Services (NSS) for net- work security. The NSS tool certutil
is used for the generation of cer- tificates. The related
certificate databases must be protected in order to maintain
the security of the system. Use of the utilities provided
will help to ensure that the proper protection is
maintained. The sys- temtap client will check for proper
access permissions before making use of any certificate
database.</p>

<p>FILES /usr/etc/sysconfig/stap-server/ Global
configuration file.</p>

<p>/usr/etc/stap-server/conf.d/*.conf Configuration files
for default servers.</p>

<p>/usr/var/run/stap-server/ Default location of status
files for running servers.</p>

<p>/usr/var/log/stap-server.log Default log file.</p>

<p>/usr/share/systemtap/runtime/uprobes/ Location of the
uprobes.ko build directory.</p>

<p>/lib/modules/ Location of installed kernels.</p>

<p>SEE ALSO stap(1), staprun(8), stapprobes(3stap),
stapfuncs(3stap), stappaths(7), stapex(3stap), avahi,
ulimit(1), NSS, certutil</p>

<p>BUGS Use the Bugzilla link of the project web page or
our mailing list. http://sources.redhat.com/systemtap/,
&lt;systemtap@sources.redhat.com&gt;.</p>

<p>STAP-SERVER(8)</p>
<hr>
</body>
</html>
